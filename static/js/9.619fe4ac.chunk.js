(this["webpackJsonpfirst-example"]=this["webpackJsonpfirst-example"]||[]).push([[9,90,143,165],{1178:function(e,t,a){"use strict";a.r(t),a.d(t,"DrawGraphicTool",(function(){return et})),a.d(t,"DrawOperation",(function(){return q.a})),a.d(t,"GraphicMoveTool",(function(){return ti})),a.d(t,"GraphicReshapeTool",(function(){return mi})),a.d(t,"GraphicTransformTool",(function(){return zi})),a.d(t,"ExtentTransformTool",(function(){return Nn}));var i=a(9),n=a(2),r=a(3),o=a(5),c=a(6),s=a(0),l=a(64),u=a(14),h=a(71),d=a(119),p=a(4),f=a(25),b=a(1),v=a(16),g=a(13),y=a(8),m=a(192),O=a(153),j=a(17),_=a(37),M=a(313),w=a(85),k=a(895),S={main:new _.a([255,127,0]),selected:new _.a([255,255,255]),staged:new _.a([12,207,255]),outline:new _.a([0,0,0,.5]),selectedOutline:new _.a([255,255,255])},x=.3;function E(e,t){var a=e.clone();return a.a*=t,a}function D(e,t){var a=e.clone(),i=Object(M.b)(a);i.s*=t;var n=Object(M.e)(i);return a.r=n.r,a.g=n.g,a.b=n.b,a}function G(e,t){if(t)for(var a in t)e[a]=t[a]}var A=function e(t){Object(n.a)(this,e),this.color=S.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,G(this,t)},R=function(){function e(t){Object(n.a)(this,e),this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=S.main,this.outlineColor=S.outline,this.renderOccluded=16,this.hoverOutlineColor=S.selectedOutline,G(this,t)}return Object(r.a)(e,[{key:"apply",value:function(e,t){var a=this[e];t.setParameterValues({color:U(a),transparent:"color"!==e||a.a<1,renderOccluded:this.renderOccluded})}}]),e}(),P=function(){function e(t){Object(n.a)(this,e),this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=E(S.main,.5),this.hoverColor=S.main,this.renderOccluded=2,this.minSquaredEdgeLength=900,G(this,t)}return Object(r.a)(e,[{key:"apply",value:function(e,t){var a=this[e];t.setParameterValues({color:U(a),transparent:a.a<1,renderOccluded:this.renderOccluded})}}]),e}(),C=function e(t){Object(n.a)(this,e),this.vertex=new R({color:S.main,outlineColor:S.outline}),this.edge=new R({color:D(E(S.main,2/3),.5),outlineColor:E(S.outline,.5),size:8,collisionPadding:8}),this.selected=new R({color:S.selected,outlineColor:S.outline}),this.edgeOffset=new P,G(this,t)},T=function(){function e(t){Object(n.a)(this,e),this.color=S.selected,this.width=1.5,this.stipplePattern=Object(k.a)([5,5]),this.stippleOffColor=S.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=S.selected,this.renderOccluded=4,G(this,t)}return Object(r.a)(e,[{key:"apply",value:function(e){e.color=U(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=U(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=U(this.innerColor),e.renderOccluded=this.renderOccluded}}]),e}(),z=function(){function e(t){Object(n.a)(this,e),this.color=S.selected,this.size=4,this.outlineSize=1,this.outlineColor=S.outline,this.shape="square",G(this,t)}return Object(r.a)(e,[{key:"apply",value:function(e){e.color=U(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=U(this.outlineColor),e.primitive=this.shape}}]),e}(),I=function(){function e(t){Object(n.a)(this,e),this.innerColor=S.selected,this.innerWidth=1,this.glowColor=S.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=x,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=S.main,G(this,t)}return Object(r.a)(e,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a={glowColor:_.a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:_.a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=a:e.laserlineStyle=a}}]),e}(),V=function e(t){Object(n.a)(this,e),this.outline=new T({color:S.outline,renderOccluded:8,stippleOffColor:S.selected,stipplePattern:Object(k.a)([5,5]),width:1.5,innerWidth:0}),this.staged=new T({color:S.selected,renderOccluded:8,innerColor:S.staged,stippleOffColor:S.outline,stipplePattern:Object(k.a)([5,5]),width:1.5}),this.shadowStyle=new I({globalAlpha:x,glowColor:S.main,glowFalloff:8,glowWidth:8,innerColor:S.selected,innerWidth:1}),G(this,t)},H=function e(t){Object(n.a)(this,e),this.outline=new z({color:S.selected,outlineColor:S.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new I({globalAlpha:x,glowColor:S.main,glowFalloff:1.5,glowWidth:6,innerColor:S.selected,innerWidth:1,radius:2}),G(this,t)},L=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this)).extensionType=2,G(Object(j.a)(i),e),i}return a}(T),F=function e(t){Object(n.a)(this,e),this.lineGraphics=new V,this.pointGraphics=new H,this.heightPlane=new I({globalAlpha:x,glowColor:S.main,glowFalloff:8,glowWidth:8,innerColor:S.selected,innerWidth:1}),this.heightBox=new I({globalAlpha:x,glowColor:S.main,glowFalloff:8,glowWidth:8,innerColor:S.selected,innerWidth:0,heightFillColor:S.main}),this.zVerticalLine=new L({color:E(S.main,.5),falloff:2,innerColor:E(S.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,G(this,t)};function U(e){return Object(w.d)(_.a.toUnitRGBA(e))}var B=new(function(){function e(t){Object(n.a)(this,e),this.visualElements=new F,this.reshapeManipulators=new C,this.zManipulator=new A,G(this,t)}return Object(r.a)(e,[{key:"colorToVec4",value:function(e){return U(e)}}]),e}()),q=a(558),Z=a(504),N=a(15),W=a(11),Y=a(22),X=a(77),Q=a(272),K=a(108),J=a(163),$=a(213),ee=a(415),te=a(34),ae=a(288),ie=function(){function e(t){Object(n.a)(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return Object(r.a)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"resources",get:function(){return Object(p.k)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){this.resourceFactory.recreateGeometry?Object(p.j)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?Object(p.j)(this._resources)&&this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e;this._destroyResources();var t=this.resourceFactory.createResources();this._resources={layerView:new ne({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();var a=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;a&&a.registerDrapeSource(this._resources.layerView)}},{key:"_destroyResources",value:function(){var e;if(!Object(p.j)(this._resources)){this.ensureRenderGeometriesRemoved();var t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}}},{key:"_syncGeometriesToRenderer",value:function(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}},{key:"ensureRenderGeometriesRemoved",value:function(){var e;!Object(p.j)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}},{key:"ensureRenderGeometriesAdded",value:function(){Object(p.j)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}]),e}(),ne=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).drapeSourceType=1,i.updatePolicy=1,i}return a}(Object(ae.a)(te.a));Object(s.a)([Object(b.b)({constructOnly:!0})],ne.prototype,"view",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],ne.prototype,"drapeSourceType",void 0),ne=Object(s.a)([Object(y.a)("DrapedVisualElementLayerView")],ne);var re=a(557),oe=a(607),ce=a(522),se=a(842),le=a(217),ue=a(823),he=a(342),de=function(){function e(t){var a=this;Object(n.a)(this,e),this.view=null,this._attachmentOrigin=Object($.g)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new h.a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(Q.c)(1,0,1,1),this._innerWidth=0,this._innerColor=Object(Q.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new oe.a({view:t.view,createResources:function(e){return a.createResources(e)},recreateGeometry:function(e,t){return e.geometries.length=0,a.recreateGeometry(t,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this.drapedResources=new ie({view:t.view,createResources:function(){return a.createDrapedResources()},recreateGeometry:function(e){e.geometries=a.createRenderGeometriesDraped(e.material),a.attachmentOriginChanged()}});var i=!0;for(var r in this._laserline=new re.a({view:t.view}),t)r in this?"attached"===r?i=t[r]:this[r]=t[r]:console.error("Cannot set unknown property",r);this.attached=i}return Object(r.a)(e,[{key:"destroy",value:function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}},{key:"isDraped",get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}},{key:"laserlineAttached",get:function(){return this.attached&&this.visible&&Object(p.k)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}},{key:"attached",get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)}},{key:"updateAttached",value:function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(X.g)(e,this._color)||(Object(X.c)(this._color,e),this.updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){Object(X.g)(e,this._innerColor)||(Object(X.c)(this._innerColor,e),this.updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=Object(p.k)(e)!==Object(p.k)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&Object(X.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(Q.a)(e):null,this.updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(p.k)(e)&&(this._laserline.style=e)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"attachmentOrigin",get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=Object(p.k)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(W.w)(be,0,0,0);var t,a=0,i=Object(N.a)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value,r=n.vertexAttributes.get("position"),o=n.indices.get("position"),c=Object(p.s)(this.resources.resources).material.isClosed(r.data,o);Object(le.a)(r,o,c,fe)&&(Object(W.f)(be,be,fe),a++)}}catch(s){i.e(s)}finally{i.f()}return 0===a?null:(Object(W.e)(be,be,1/a),this.view.renderCoordsHelper.fromRenderCoords(be,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}},{key:"updateMaterial",value:function(){Object(p.k)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),Object(p.k)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}},{key:"isClosed",get:function(){return Object(p.k)(this.geometry)&&"polygon"===this.geometry.type}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}},{key:"normalizedRenderOccluded",get:function(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}},{key:"recreateGeometry",value:function(e,t,a){var i,n=this.createRenderGeometries(),r=Object(N.a)(n);try{for(r.s();!(i=r.n()).done;){var o=i.value;e.addGeometry(o,t),a.push(o)}}catch(c){r.e(c)}finally{r.f()}this.attachmentOriginChanged()}},{key:"attachmentOriginChanged",value:function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}},{key:"createResources",value:function(e){var t=new he.a(this.materialParameters),a=[];return this.recreateGeometry(e,t,a),{material:t,geometries:a,forEach:function(e){e(t),a.forEach(e)}}}},{key:"createDrapedResources",value:function(){var e=new he.a(this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}},{key:"createRenderGeometriesDraped",value:function(e){var t=this.geometry;if(Object(p.j)(t))return[];var a,i=Object(se.c)(t,this.view.basemapTerrain.spatialReference),n=[],r=Object(N.a)(i.lines);try{for(r.s();!(a=r.n()).done;){var o=a.value.position,c={attributeData:{position:o},removeDuplicateStartEnd:this.isClosed?1:0},s=new ue.a(Object(se.a)(c),e),l=Object(J.h)(pe);Object(J.k)(l,o),Object(X.l)(s.boundingSphere,.5*(l[0]+l[3]),.5*(l[1]+l[4]),0,.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]))),n.push(s)}}catch(u){r.e(u)}finally{r.f()}return n}},{key:"calculateMapBounds",value:function(e){if(Object(p.j)(this.resources.resources))return!1;var t,a=this.view.renderCoordsHelper,i=Object(N.a)(this.resources.resources.geometries);try{for(i.s();!(t=i.n()).done;){var n=t.value.vertexAttributes.get("position"),r=new Float64Array(n.data.length);Object(K.m)(n.data,a.spatialReference,0,r,this.view.spatialReference,0,n.data.length/3),Object(J.k)(e,r)}}catch(o){i.e(o)}finally{i.f()}return!0}},{key:"createRenderGeometries",value:function(){var e,t=this.geometry;if(Object(p.j)(t))return[];var a,i=Object(se.b)(t,this.view.elevationProvider,this.view.renderCoordsHelper,ce.a.fromElevationInfo(null!=(e=this.elevationInfo)?e:new ee.a({mode:Object(O.d)(t,null)}))),n=[],r=[],o=Object(N.a)(i.lines);try{for(o.s();!(a=o.n()).done;){var c=a.value,s=c.position,l={attributeData:{position:s,mapPosition:c.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0};n.push(Object(se.a)(l)),r.push(s)}}catch(u){o.e(u)}finally{o.f()}return this._laserline.pathVerticalPlane=r,n}}]),e}(),pe=Object(J.f)(),fe=Object(Y.e)(),be=Object(Y.e)(),ve=a(352),ge=a(824),ye=a(269),me=a(100),Oe=a(240),je=a(339),_e=a(270),Me=a(75),we=a(294),ke=a(191),Se=a(901),xe=a(201),Ee=a(231),De=a(216),Ge=a(237),Ae=a(239),Re=a(60),Pe=a(157),Ce=a(238),Te=a(902),ze=a(92),Ie=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get(),i=this.configuration,n=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new Ce.a(e.rctx,n,He)}},{key:"bindPass",value:function(e,t){var a=this.configuration,i=a.screenSizeEnabled,n=a.shadingEnabled,r=e.color,o=e.shadingTint,c=e.shadingDirection;Object(De.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",r),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Ee.a)(this.program,t)),n&&(this.program.setUniform4fv("shadedColor",this.blendColor(Le,o,r)),this.program.setUniform3fv("shadingDirection",c),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),i&&Object(Se.b)(this.program,e,t)}},{key:"bindDraw",value:function(e){Object(De.d)(this.program,e),Object(De.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(xe.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"blendColor",value:function(e,t,a){var i=1-t[3],n=t[3]+a[3]*i;return 0===n?(e[3]=n,e):(e[0]=(t[0]*t[3]+a[0]*a[3]*i)/n,e[1]=(t[1]*t[3]+a[1]*a[3]*i)/n,e[2]=(t[2]*t[3]+a[2]*a[3]*i)/n,e[3]=a[3],e)}},{key:"setPipelineState",value:function(e){var t=this.configuration,a=3===e,i=2===e;return Object(ze.f)({blending:0!==t.output&&7!==t.output||!t.transparent?null:a?Pe.f:Object(Pe.a)(e),culling:Object(ze.b)(t.cullFace),depthTest:{func:i?513:t.shadingEnabled?515:513},depthWrite:a?t.writeDepth&&ze.d:Object(Pe.c)(e),colorWrite:ze.c,polygonOffset:a||i?null:Pe.d})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),a}(Ae.a);Ie.shader=new Ge.a(Te.a,(function(){return a.e(208).then(a.bind(null,1167))}));var Ve=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(){var e;return Object(n.a)(this,a),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.writeDepth=!0,e.screenSizeEnabled=!0,e.shadingEnabled=!0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return a}(Re.a);Object(s.a)([Object(Re.b)({count:8})],Ve.prototype,"output",void 0),Object(s.a)([Object(Re.b)({count:3})],Ve.prototype,"cullFace",void 0),Object(s.a)([Object(Re.b)()],Ve.prototype,"slicePlaneEnabled",void 0),Object(s.a)([Object(Re.b)()],Ve.prototype,"transparent",void 0),Object(s.a)([Object(Re.b)()],Ve.prototype,"writeDepth",void 0),Object(s.a)([Object(Re.b)()],Ve.prototype,"screenSizeEnabled",void 0),Object(s.a)([Object(Re.b)()],Ve.prototype,"shadingEnabled",void 0),Object(s.a)([Object(Re.b)({count:4})],Ve.prototype,"transparencyPassType",void 0),Object(s.a)([Object(Re.b)()],Ve.prototype,"multipassTerrainEnabled",void 0),Object(s.a)([Object(Re.b)()],Ve.prototype,"cullAboveGround",void 0);var He=new Map([["position",0],["normal",1],["offset",2]]),Le=Object(w.e)(),Fe=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e,Be)).supportsEdges=!0,i.techniqueConfig=new Ve,i._vertexAttributeLocations=He,i}return Object(r.a)(a,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,a,i,n,r,o){var c=this;if(this.params.screenSizeEnabled){var s=e.vertexAttributes.get("offset"),l={applyToVertex:function(e,t,a,n){var r=Object(W.w)(Ze,s.data[3*n+0],s.data[3*n+1],s.data[3*n+2]),o=Object(W.w)(Ne,e,t,a);return Object(W.e)(r,r,c.params.screenSize*i.camera.computeRenderPixelSizeAt(r)),Object(W.f)(o,o,r),[o[0],o[1],o[2]]},applyToAabb:function(e){var t=Object(J.d)(e,Ze);return Object(J.v)(e,c.params.screenSize*i.camera.computeRenderPixelSizeAt(t))}};Object(ke.f)(e,t,i,n,r,l,o)}else Object(ke.f)(e,t,i,n,r,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new Ue(e):void 0}},{key:"createBufferWriter",value:function(){return new qe(this.params.screenSizeEnabled)}}]),a}(_e.a),Ue=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).updateParameters(),i}return Object(r.a)(a,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(Ie,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){if(4===this._output)return 3===e;var t=3;return this._technique.configuration.transparent&&(t=this._technique.configuration.writeDepth?5:8),e===t}},{key:"ensureParameters",value:function(e){this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}}]),a}(je.a),Be=Object(i.a)({color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(W.r)(Object(Y.e)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0},_e.b),qe=function(){function e(t){Object(n.a)(this,e),this.screenSizeEnabled=t;var a=Object(Oe.a)().vec3f("position").vec3f("normal");this.screenSizeEnabled&&a.vec3f("offset"),this.vertexBufferLayout=a}return Object(r.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,a,i){if(Object(we.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,a,i),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");var n=t.vertexAttributes.get("offset"),r=t.indices.get("offset");Object(Me.a)(3===n.size);var o=a.getField("offset",me.u);if(!o)throw new Error("unable to acquire view for offset");Object(we.e)(r,n.data,e.invTranspTransformation,o,i)}}}]),e}(),Ze=Object(Y.e)(),Ne=Object(Y.e)(),We=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).view=null,i._renderOccluded=4,i._vertices=null,i._spatialReference=null,i._color=B.colorToVec4(B.reshapeManipulators.vertex.color),i._size=B.reshapeManipulators.vertex.size,i._outlineColor=B.colorToVec4(B.reshapeManipulators.vertex.outlineColor),i._outlineSize=B.reshapeManipulators.vertex.outlineSize,i._elevationInfo=null,i.applyProps(e),i}return Object(r.a)(a,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){Object(X.g)(e,this._color)||(Object(X.c)(this._color,e),this.updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this.updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object(X.g)(e,this._outlineColor)||(Object(X.c)(this._outlineColor,e),this.updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"vertexMaterialParameters",get:function(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}},{key:"vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}},{key:"updateMaterial",value:function(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}},{key:"updateOutlineMaterial",value:function(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}},{key:"createRenderGeometries",value:function(){var e=this.vertices;if(Object(p.j)(e)||0===e.length)return[];for(var t=Object(ge.c)(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ce.a.fromElevationInfo(this.elevationInfo)),a=[],i=t.numVertices,n=t.position,r=0;r<i;++r){var o=Object(W.w)(Ye,n[3*r+0],n[3*r+1],n[3*r+2]),c=Xe(.5,o),s=Xe(.5,o);a.push({vertexGeometry:c,vertexOutlineGeometry:s})}return a}},{key:"createGeometries",value:function(e){var t,a=this.createRenderGeometries(),i=Object(N.a)(a);try{for(i.s();!(t=i.n()).done;){var n=t.value,r=n.vertexGeometry,o=n.vertexOutlineGeometry;e.addGeometry(r,this.vertexMaterial),e.addGeometry(o,this.vertexOutlineMaterial)}}catch(c){i.e(c)}finally{i.f()}}},{key:"createExternalResources",value:function(){this.vertexMaterial=new Fe(Object(i.a)(Object(i.a)({},this.vertexMaterialParameters),{},{writeDepth:!0,cullFace:2,screenSizeEnabled:!0})),this.vertexOutlineMaterial=new Fe(Object(i.a)(Object(i.a)({},this.vertexOutlineMaterialParameters),{},{transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}]),a}(ve.a),Ye=Object(Y.e)();function Xe(e,t){return ye.a.createSphereGeometry(e,16,16,{offset:t})}var Qe=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).tracking=!1,i.displaying=!1,i.isDraped=!1,i}return a}(h.a.EventedAccessor);Object(s.a)([Object(b.b)({constructOnly:!0})],Qe.prototype,"graphic",void 0),Object(s.a)([Object(b.b)()],Qe.prototype,"tracking",void 0),Object(s.a)([Object(b.b)()],Qe.prototype,"displaying",void 0),Object(s.a)([Object(b.b)()],Qe.prototype,"isDraped",void 0),Qe=Object(s.a)([Object(y.a)("esri.views.3d.layers.graphics.GraphicState")],Qe);var Ke=a(953),Je=a(553),$e=a(539),et=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).drawOperation=null,i._createGraphic=null,i._createGraphicState=null,i._outlineVisualElement=null,i._verticesVisualElement=null,i._activeVertexVisualElement=null,i.hasZ=!0,i.defaultZ=0,i.elevationInfo=null,i.snapToScene=!1,i.snappingManager=null,i.mode=null,i.geometryType=null,i.type="draw-3d",i}return Object(r.a)(a,[{key:"updating",get:function(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}},{key:"initialize",value:function(){var e=this,t=Object(p.t)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new m.a({elevationInfo:t,listMode:"hide",internal:!0}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new q.a({view:this.view,manipulators:this.manipulators,geometryType:tt(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,sceneDrawSurface:new Z.b(this.view,t,[this._internalGraphicsLayer]),elevationDrawSurface:new Z.a(t,this.defaultZ,this.view,this._internalGraphicsLayer),hasM:!1,elevationInfo:t,snappingManager:this.snappingManager}),this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)})),this.complete()}},{key:"destroy",value:function(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}},{key:"onInputEvent",value:function(e){this.drawOperation.onInputEvent(e)}},{key:"_getCreateGeometry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;var t=this.drawOperation.stagedVertex,a=this.drawOperation.committedVertices,i=a.slice();Object(p.k)(t)&&i.push(this.drawOperation.coordinateHelper.pointToArray(t));var n=Object(p.k)(t)?this.drawOperation.coordinateHelper.pointToArray(t):a.splice(-1)[0],r={regularVertices:null,activeVertex:null,full:null,outline:null},o=i.length,c=this.drawOperation.spatialReference,s="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":r.regularVertices=a,r.activeVertex=n,r.full=this.drawOperation.coordinateHelper.createPointFromArray(i[0]);break;case"polyline":r.regularVertices=a,r.activeVertex=n,o>0&&(r.full=Object(Ke.createPolyline)([i],c,s));break;case"polygon":r.regularVertices=a,r.activeVertex=n,o>0&&(r.full=Object(Ke.createPolygon)([i],c,s,!0));break;case"circle":if(o>0){var l=Object(Je.a)(this.view,i[0]);if(1===o&&e.operationComplete){var u=i[0],h=l.makeMapPoint(u[0]+at*this.view.resolution,u[1]);r.full=Object(Ke.createCircle)([u,h],l,!0)}else 2===o&&(r.full=this.forceUniformSize?Object(Ke.createCircle)(i,l,this.centered):Object(Ke.createEllipse)(i,l,this.centered))}break;case"rectangle":if(o>0){var d=Object(Je.a)(this.view,i[0]);if(1===o&&e.operationComplete){var f=i[0],b=d.makeMapPoint(f[0]+at*this.view.resolution,f[1]);r.full=Object(Ke.createSquare)([f,b],d,!0)}else 2===o&&(r.full=this.forceUniformSize?Object(Ke.createSquare)(i,d,this.centered):Object(Ke.createRectangle)(i,d,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":case"polygon":o>1&&(r.outline=Object(Ke.createPolyline)([i],c,s));break;case"circle":case"rectangle":Object(p.k)(r.full)&&"polygon"===r.full.type&&(r.outline=Object(Ke.createPolygon)(r.full.rings,c,s))}return r}},{key:"_destroyAllVisualisations",value:function(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}},{key:"_destroyCreateGraphic",value:function(){Object(p.k)(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic=Object(p.e)(this._createGraphic)),this._createGraphicState=null,this.handles.remove(it)}},{key:"_destroyOutlineVisualElement",value:function(){this._outlineVisualElement=Object(p.e)(this._outlineVisualElement)}},{key:"_destroyVerticesVisualElement",value:function(){this._verticesVisualElement=Object(p.e)(this._verticesVisualElement)}},{key:"_destroyStagedVerticesVisualElement",value:function(){this._activeVertexVisualElement=Object(p.e)(this._activeVertexVisualElement)}},{key:"_updateCreateGraphic",value:function(){var e=this,t=this._getCreateGeometry();if(Object(p.j)(t))this._destroyAllVisualisations();else{var a=this._internalGraphicsLayer.elevationInfo;Object(p.k)(t.outline)?Object(p.j)(this._outlineVisualElement)?(this._outlineVisualElement=new de({view:this.view,geometry:t.outline,elevationInfo:a,isDraped:Object(p.k)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(O.c)(this.hasZ,a),attached:!1}),B.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),B.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=t.outline:this._destroyOutlineVisualElement(),Object(p.k)(t.regularVertices)?Object(p.j)(this._verticesVisualElement)?(this._verticesVisualElement=new We({view:this.view,spatialReference:this.view.spatialReference,vertices:t.regularVertices,elevationInfo:a,renderOccluded:B.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=t.regularVertices:this._destroyVerticesVisualElement(),Object(p.k)(t.activeVertex)?Object(p.j)(this._activeVertexVisualElement)?(this._activeVertexVisualElement=new We({view:this.view,spatialReference:this.view.spatialReference,vertices:[t.activeVertex],elevationInfo:a,renderOccluded:B.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=B.colorToVec4(B.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0):this._activeVertexVisualElement.vertices=[t.activeVertex]:this._destroyStagedVerticesVisualElement(),Object(p.k)(t.full)?Object(p.j)(this._createGraphic)?(this._createGraphic=new l.a(Object(i.a)({geometry:t.full,symbol:this.createGraphicSymbol,sourceLayer:this._internalGraphicsLayer},this.graphicProperties)),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this._createGraphicState=new Qe({graphic:this._createGraphic}),this.handles.add([this.view.trackGraphicState(this._createGraphicState),Object(f.a)(this._createGraphicState,"isDraped",(function(t){Object(p.k)(e._outlineVisualElement)&&(e._outlineVisualElement.isDraped=t)}))],it),this.notifyChange("createGraphic")):this._createGraphic.geometry=t.full:this._destroyCreateGraphic()}}},{key:"createGraphic",get:function(){return this._createGraphic}},{key:"enabled",set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)}},{key:"centered",set:function(e){this._set("centered",e),this._updateCreateGraphic()}},{key:"forceUniformSize",set:function(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}},{key:"reset",value:function(){}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"redo",value:function(){this.drawOperation.redo()}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"undo",value:function(){this.drawOperation.undo()}},{key:"completeCreateOperation",value:function(){this.drawOperation.complete()}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},{key:"getVertexCoords",value:function(){return this.drawOperation.vertices}},{key:"onVertexAdd",value:function(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}},{key:"onVertexRemove",value:function(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}},{key:"onVertexUpdate",value:function(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}},{key:"onCursorUpdate",value:function(e){this._updateCreateGraphic(),this.emit("cursor-update",e)}},{key:"onComplete",value:function(e){this._updateCreateGraphic();var t=null;if(this.drawOperation.isCompleted){var a=this._getCreateGeometry({operationComplete:!0});Object(p.k)(a)&&(t=new l.a(Object(i.a)({geometry:a.full,symbol:this.createGraphicSymbol,sourceLayer:this._internalGraphicsLayer},this.graphicProperties)))}this.emit("complete",Object(i.a)({graphic:t},e))}}]),a}(Object(d.b)(h.a.EventedMixin($e.a)));function tt(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}Object(s.a)([Object(b.b)()],et.prototype,"drawOperation",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],et.prototype,"updating",null),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],et.prototype,"view",void 0),Object(s.a)([Object(b.b)()],et.prototype,"createGraphicSymbol",void 0),Object(s.a)([Object(b.b)()],et.prototype,"createGraphic",null),Object(s.a)([Object(b.b)({value:!0})],et.prototype,"enabled",null),Object(s.a)([Object(b.b)({value:!0})],et.prototype,"centered",null),Object(s.a)([Object(b.b)({value:!0})],et.prototype,"forceUniformSize",null),Object(s.a)([Object(b.b)({constructOnly:!0})],et.prototype,"graphicProperties",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],et.prototype,"hasZ",void 0),Object(s.a)([Object(b.b)({nonNullable:!0})],et.prototype,"defaultZ",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],et.prototype,"elevationInfo",void 0),Object(s.a)([Object(b.b)()],et.prototype,"snapToScene",void 0),Object(s.a)([Object(b.b)()],et.prototype,"snappingManager",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],et.prototype,"mode",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],et.prototype,"geometryType",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],et.prototype,"type",void 0),et=Object(s.a)([Object(y.a)("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],et);var at=48,it="create-graphic",nt=a(38),rt=a(48),ot=a(128),ct=a(78),st=a(67),lt=a(385),ut=(a(76),a(172)),ht=a(40),dt=a(32),pt=a(93),ft=a(145),bt=a(267),vt=a(104),gt=a(26),yt=a(212),mt=a(97),Ot=a(86),jt=a(59),_t=a(137),Mt=a(363);function wt(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(_t.c)();return kt(e,e.screenToRender(t,Object(dt.b)(st.d.get())),a)}function kt(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(_t.c)(),i=Object(dt.b)(Object(gt.c)(st.d.get(),t));if(i[2]=0,!e.unprojectFromRenderScreen(i,a.origin))return null;var n=Object(dt.b)(Object(gt.c)(st.d.get(),t));n[2]=1;var r=e.unprojectFromRenderScreen(n,st.d.get());return Object(p.j)(r)?null:(Object(W.j)(a.direction,r,a.origin),a)}var St=a(822),xt=a(414),Et=a(425),Dt=a(39),Gt=function(){function e(t){for(var a in Object(n.a)(this,e),this.idHint=0,this.camera=new St.a,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(vt.d)(),this._worldFrame=null,this._renderLocation=Object(Y.e)(),this._renderLocationDirty=!0,this._location=new Dt.a({x:0,y:0,z:0}),this._elevationAlignedLocation=new Dt.a,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new h.a.EventEmitter,this._screenLocation={screenPointArray:Object(dt.f)(),renderScreenPointArray:Object(dt.d)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=t.view.spatialReference,t)this[a]=t[a];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}return Object(r.a)(e,[{key:"destroy",value:function(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}},{key:"renderObjects",get:function(){return this._renderObjects},set:function(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}},{key:"available",get:function(){return this._available},set:function(e){e!==this._available&&(this._available=e,this._updateEngineObject())}},{key:"disableDisplay",value:function(){var e=this;return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(pt.d)((function(){e._noDisplayCount--,0===e._noDisplayCount&&e._updateEngineObject()}))}}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}},{key:"worldSized",get:function(){return this._worldSized},set:function(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}},{key:"modelTransform",get:function(){return this._modelTransform},set:function(e){At(e)&&(this._screenLocationDirty=!0),Object(ct.d)(this._modelTransform,e),this._updateEngineObject()}},{key:"renderLocation",get:function(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(vt.d)()),function(e,t,a){switch(e.viewingMode){case"local":return Object(ct.i)(a),!0;case"global":var i=Object(yt.e)(e.renderCoordsHelper.spatialReference);Object(K.u)(t,0,Ht,0,i.radius),Object(K.c)(Object(ht.g)(Ht[1]),Object(ht.g)(Ht[0]),a)}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation},set:function(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}},{key:"location",get:function(){return this._location},set:function(e){Object(lt.a)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"elevationAlignedLocation",get:function(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation},set:function(e){Object(lt.a)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"_updateElevationAlignedLocation",value:function(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;var e=Object(p.k)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",get:function(){return this._grabbing},set:function(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"hovering",get:function(){return this._hovering},set:function(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"selected",get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,this._updateEngineObject())}},{key:"updateStateEnabled",value:function(e,t){t?this.state|=e:this.state&=~e}},{key:"_setFocused",value:function(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}},{key:"focused",get:function(){return this._focused}},{key:"screenLocation",get:function(){return this.ensureScreenLocation(),this._screenLocation}},{key:"ensureScreenLocation",value:function(){if(this._screenLocationDirty){var e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,At(this._modelTransform)){var t=this._calculateModelTransformOffset(qt);e=Object(W.f)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}}},{key:"applyObjectTransform",get:function(){return this._applyObjectTransform},set:function(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"intersectionDistance",value:function(e,t){if(!this.available)return null;var a=Object(dt.i)(e,Rt),i=this._getCollisionRadius(t),n=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(gt.j)(this.screenLocation.screenPointArray,a)<i*i)return this.screenLocation.renderScreenPointArray[2]+n;break;case"line":var r=this.collisionType.paths,o=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(o,It),s=i*this.screenLocation.pixelSize,l=wt(this.camera,a,Ct);if(Object(p.j)(l))return null;var u,h=Object(N.a)(r);try{for(h.s();!(u=h.n()).done;){var d=u.value;if(0!==d.length)for(var f=Object(W.q)(Ht,d[0],c),b=1;b<d.length;b++){var v=Object(W.q)(Lt,d[b],c),g=Object(Ot.b)(Object(Ot.f)(f,v,Pt),l);if(null!=g&&g<s*s){var y=Object(W.f)(st.d.get(),f,v);Object(W.e)(y,y,.5);var m=Object(dt.a)(st.d.get());return this.camera.projectToRenderScreen(y,m),m[2]+n}Object(W.k)(f,v)}}}catch(ee){h.e(ee)}finally{h.f()}break;case"disc":var O,j=this.collisionType.direction,_=null!=(O=this.collisionType.offset)?O:Y.b,M=this._getWorldToScreenObjectScale(),w=this._calculateObjectTransform(M,It),k=i*this.screenLocation.pixelSize,S=wt(this.camera,a,Ct);if(Object(p.j)(S))return null;var x=Object(ft.f)(Tt,w),E=Object(W.x)(Ut,j,x),D=Object(W.q)(Bt,_,w);Object(jt.g)(D,E,Vt);var G=Ft;if(Object(jt.m)(Vt,S,G)&&Object(W.l)(G,D)<k*k)return this.screenLocation.renderScreenPointArray[2]+n;break;case"ribbon":var A=this.collisionType,R=A.paths,P=A.direction,C=this._getWorldToScreenObjectScale(),T=this._calculateObjectTransform(C,It),z=i*this.camera.computeScreenPixelSizeAt(this.renderLocation),I=wt(this.camera,a,Ct);if(Object(p.j)(I))return null;var V=Object(ft.f)(Tt,T),H=Object(W.x)(Ut,P,V),L=this._calculateModelTransformPosition(Bt);Object(jt.g)(L,H,Vt);var F=Ft;if(!Object(jt.m)(Vt,I,F))break;var U,B=Object(N.a)(R);try{for(B.s();!(U=B.n()).done;){var q=U.value;if(0!==q.length)for(var Z=Object(W.q)(Ht,q[0],T),X=1;X<q.length;X++){var Q=Object(W.q)(Lt,q[X],T),K=Object(Ot.e)(Object(Ot.f)(Z,Q,Pt),F);if(null!=K&&K<z*z){var J=Object(W.f)(st.d.get(),Z,Q);Object(W.e)(J,J,.5);var $=Object(dt.a)(st.d.get());return this.camera.projectToRenderScreen(J,$),$[2]+n}Object(W.k)(Z,Q)}}}catch(ee){B.e(ee)}finally{B.f()}break;default:Object(ut.a)(this.collisionType)}return null}},{key:"attach",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};if(this.view._stage){var a=t.manipulator3D;if(Object(p.j)(a.engineLayerId)){var i=new Et.a({isPickable:!1,updatePolicy:1});this.view._stage.add(i),a.engineLayerId=i.id,this._engineLayer=i}else null!=(e=this.view._stage)&&e.getObject&&(this._engineLayer=this.view._stage.getObject(a.engineLayerId));a.engineLayerReferences=(a.engineLayerReferences||0)+1,this._materialIdReferences=a.materialIdReferences,Object(p.j)(this._materialIdReferences)&&(this._materialIdReferences=new Map,a.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(K.b)(this._location.spatialReference,this.view.spatialReference)||(this.location=new Dt.a({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}}},{key:"detach",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}},t=e.manipulator3D;t.engineLayerReferences--;var a=0===t.engineLayerReferences;a&&(t.engineLayerId=null),this._removeResourcesFromStage(a),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}},{key:"onViewChange",value:function(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"onElevationChange",value:function(e){Object(K.o)(this.location,Zt,e.spatialReference),Object(mt.h)(e.extent,Zt)&&(this.location=this._location)}},{key:"_evaluateElevationAlignment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.location;if(Object(p.j)(this.elevationInfo))return!1;var t=null,a=0,i=Object(p.t)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(p.t)(Object(Mt.b)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":a=Object(p.t)(Object(Mt.b)(this.view.elevationProvider,e,"ground"),0)+i;break;case"relative-to-scene":a=Object(p.t)(Object(Mt.b)(this.view.elevationProvider,e,"scene"),0)+i;break;case"absolute-height":a=i}return(a!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=a,this._elevation.override=t,!0)}},{key:"_updateEngineObject",value:function(){if(this._attached)if(this.available){var e=this._getWorldToScreenObjectScale(),t=It;if(!0===this.autoScaleRenderObjects){var a=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(a,t)}else this._calculateObjectTransform(e,t);var i,n=this._ensureEngineResources().objectsByState,r=(this.focused?2:1)|(this.selected?8:4),o=this._noDisplayCount>0,c=Object(N.a)(n);try{for(c.s();!(i=c.n()).done;){var s=i.value,l=s.stateMask,u=s.objects;if(o){var h,d=Object(N.a)(u);try{for(d.s();!(h=d.n()).done;){h.value.setVisible(!1)}}catch(O){d.e(O)}finally{d.f()}}else{var p=!(0!=(15&l))||(r&l)==(15&l),f=!(0!=(65520&l))||(this.state&l)==(65520&l);if(p&&f){var b,v=Object(N.a)(u);try{for(v.s();!(b=v.n()).done;){var g=b.value;g.setVisible(!0),g.transformation=t}}catch(O){v.e(O)}finally{v.f()}}else{var y,m=Object(N.a)(u);try{for(m.s();!(y=m.n()).done;){y.value.setVisible(!1)}}catch(O){m.e(O)}finally{m.f()}}}}}catch(O){c.e(O)}finally{c.f()}}else this._removeResourcesFromStage()}},{key:"_ensureEngineResources",value:function(){if(Object(p.j)(this._engineResources)){var e=Object(p.s)(this._engineLayer),t=[],a=new Set;this.renderObjects.forEach((function(e){var i=e.material;a.has(i)||(t.push(i),a.add(i))}));var i=new Map;this._renderObjects.forEach((function(e){var t=new xt.a({castShadow:!1});!function(e,t){var a=t.geometry,i=t.material,n=t.transform;Array.isArray(a)?a.forEach((function(t){return e.addGeometry(t,i,n)})):e.addGeometry(a,i,n)}(t,e);var a=e.stateMask||0,n=i.get(a)||[];n.push(t),i.set(a,n)}));var n=[];i.forEach((function(e,t){return n.push({stateMask:t,objects:e})})),this._engineResources={objectsByState:n,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}},{key:"_addResourcesToStage",value:function(){var e=this;if(!this._engineResourcesAddedToStage&&!Object(p.j)(this._engineResources)){var t=this._engineResources,a=t.objectsByState,i=t.layer;t.materials.forEach((function(t){var a=Object(p.s)(e._materialIdReferences),i=a.get(t.id)||0;0===i&&e.view._stage.add(t),a.set(t.id,i+1)})),a.forEach((function(t){var a=t.objects;i.addMany(a),e.view._stage.addMany(a)})),this._engineResourcesAddedToStage=!0}}},{key:"_removeResourcesFromStage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._engineResourcesAddedToStage&&!Object(p.j)(this._engineResources)){var a=this._engineResources,i=a.objectsByState,n=a.layer,r=a.materials;i.forEach((function(t){var a=t.objects;n.removeMany(a),e.view._stage.removeMany(a)})),r.forEach((function(t){var a=Object(p.s)(e._materialIdReferences),i=a.get(t.id);1===i?(e.view._stage.remove(t),a.delete(t.id)):a.set(t.id,i-1)})),t&&this.view._stage.remove(n),this._engineResourcesAddedToStage=!1}}},{key:"_getCollisionRadius",value:function(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}},{key:"_getFocusedSize",value:function(e,t){return e*(t?this.focusMultiplier:1)}},{key:"_getWorldToScreenObjectScale",value:function(){return this._worldSized?1:this.screenLocation.pixelSize}},{key:"_calculateModelTransformPosition",value:function(e){var t=this._getWorldToScreenObjectScale(),a=this._calculateObjectTransform(t,zt);return Object(W.w)(e,a[12],a[13],a[14])}},{key:"_calculateModelTransformOffset",value:function(e){var t=this._calculateModelTransformPosition(e);return Object(W.j)(e,t,this.renderLocation)}},{key:"_calculateObjectTransform",value:function(e,t){return Object(ct.h)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(ct.m)(t,t,this._worldFrame),Object(ct.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(p.k)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}},{key:"test",get:function(){var e=!1;if(Object(p.k)(this._engineResources))for(var t in this._engineResources.objectsByState){var a,i=this._engineResources.objectsByState[t],n=Object(N.a)(i.objects);try{for(n.s();!(a=n.n()).done;){if(a.value.isVisible){e=!0;break}}}catch(r){n.e(r)}finally{n.f()}if(e)break}return{areAnyResourcesVisible:e}}}]),e}();function At(e){return 0!==e[12]||0!==e[13]||0!==e[14]}var Rt=Object(dt.f)(),Pt=Object(Ot.d)(),Ct=Object(_t.c)(),Tt=Object(bt.b)(),zt=Object(vt.d)(),It=Object(vt.d)(),Vt=Object(jt.d)(),Ht=Object(Y.e)(),Lt=Object(Y.e)(),Ft=Object(Y.e)(),Ut=Object(Y.e)(),Bt=Object(Y.e)(),qt=Object(Y.e)(),Zt=new Dt.a({x:0,y:0,z:0,spatialReference:null}),Nt=a(518),Wt=a(536);function Yt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=Object(w.g)(e[0],e[1],e[2],e.length>3?e[3]:1),n=e[3]<1;return a?new Fe({color:i,transparent:n,writeDepth:!0,cullFace:2,renderOccluded:t}):new Wt.a({color:i,transparent:n,writeDepth:!0,cullFace:2,renderOccluded:t})}function Xt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,a=Object(w.g)(e[0],e[1],e[2],4===e.length?e[3]:1);return new Wt.a({color:a,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function Qt(e,t,a,i){var n=Object(W.j)(st.d.get(),e,a),r=Kt(n,Object(W.g)(st.d.get(),i,n),a,st.a.get());Object(ct.a)(r,r);var o=Object(W.q)(st.d.get(),t,r);return Math.atan2(o[1],o[0])}function Kt(e,t,a,i){var n=Object(W.r)(st.d.get(),e),r=Object(W.r)(st.d.get(),t),o=Object(W.g)(st.d.get(),n,r);return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=0,i[4]=r[0],i[5]=r[1],i[6]=r[2],i[7]=0,i[8]=o[0],i[9]=o[1],i[10]=o[2],i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i}function Jt(e,t){var a=e.getViewForGraphic(t);return Object(p.k)(a)&&"computeAttachmentOrigin"in a?a.computeAttachmentOrigin(t,e.spatialReference):null}function $t(e,t,a){var i=Jt(e,a);Object(p.k)(i)?t.elevationAlignedLocation=i:function(e,t){if(Object(p.j)(t))return;var a="mesh"===t.type?t.anchor:Object(Nt.a)(t);Object(p.j)(a)||(e.location=Object(lt.b)(a))}(t,a.geometry)}var ea=a(549),ta=a(490);function aa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(O.e)(e);return"on-the-ground"!==t.mode&&!(Object(p.j)(e.geometry)||!e.geometry.hasZ)}var ia=function(){function e(){Object(n.a)(this,e),this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return Object(r.a)(e,[{key:"update",value:function(e){var t=this;this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,a){if(0===a&&(t.zManipulator=e),e instanceof Gt&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),Object(p.j)(t.firstGrabbedXY)&&e.grabbing&&1===a&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=1,a){case 0:t.grabbingState|=2;break;case 1:t.grabbingState|=4}}))}}]),e}(),na=a(567);function ra(e){var t=e.view,a=e.graphic,i=new Qe({graphic:a}),n=function(e,t){var a=e.view,i=e.graphic,n=new de({view:a,geometry:ca(i)?i.geometry:null,elevationInfo:Object(O.e)(i),attached:!1});B.visualElements.lineGraphics.shadowStyle.apply(n);var r=function(){n.attached=t.displaying};B.visualElements.lineGraphics.outline.apply(n);var o=[t.watch("displaying",r),t.watch("isDraped",(function(e){return n.isDraped=e})),t.on("changed",(function(){return n.geometry=ca(i)?i.geometry:null})),Object(ot.a)(n)];return r(),{visualElement:n,remove:function(){return Object(ot.b)(o).remove()}}}(e,i),r=[n,oa(e,n.visualElement,i),t.maskOccludee(a),t.trackGraphicState(i)];return{visualElement:n.visualElement,remove:function(){return Object(ot.b)(r).remove()}}}function oa(e,t,a){var i=e.graphic,n=e.view,r=[],o=Object(O.e)(i),c="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,s=new ia,l=new na.a({view:n,extensionType:B.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});B.visualElements.pointGraphics.shadowStyle.apply(l);var u=Object(ht.g)(B.visualElements.heightPlaneAngleCutoff),h=new re.a({view:n,attached:!1,angleCutoff:u});B.visualElements.heightPlane.apply(h);var d=1,f=1,b=function(){if(s.update(e),!a.displaying||c&&(a.isDraped||!ca(i)||!i.geometry.hasZ))return t.laserlineEnabled=!1,l.attached=!1,void(h.attached=!1);t.laserlineEnabled=!0;var n=4&s.grabbingState?B.visualElements.laserlineAlphaMultiplier:1;n!==d&&(d=n,B.visualElements.lineGraphics.shadowStyle.apply(t,n),B.visualElements.pointGraphics.shadowStyle.apply(l,n));var r=2&s.grabbingState?B.visualElements.laserlineAlphaMultiplier:1;r!==f&&(f=r,B.visualElements.heightPlane.apply(h,r)),function(e,t){var a=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(p.k)(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(p.k)(a)?(e.setStartEndFromWorldDownAtLocation(a.renderLocation),e.attached=!0):e.attached=!1}(l,s),function(e,t,a,i){if(i.numSelected>0){Object(W.w)(sa,0,0,0);var n=0;e.forEachManipulator((function(e,t){1===t&&e.selected&&e instanceof Gt&&(Object(W.f)(sa,sa,e.renderLocation),n++)})),n>0?(a.heightManifoldTarget=Object(W.e)(sa,sa,1/n),a.attached=!0):a.attached=!1}else{var r=t.attachmentOrigin;Object(p.k)(r)&&e.view.renderCoordsHelper.toRenderCoords(r,sa)?(a.heightManifoldTarget=sa,a.attached=!0):a.attached=!1}}(e,t,h,s)};B.visualElements.zVerticalLine.apply(l),r.push(a.on("changed",b),a.watch("displaying",b),t.events.on("attachment-origin-changed",b),Object(ot.a)(l),Object(ot.a)(h));var v=[],g=function(){Object(ot.b)(v).remove(),v.length=0,e.forEachManipulator((function(e){return v.push(e.events.on("grab-changed",b))})),e.forEachManipulator((function(e){return v.push(e.events.on("select-changed",b))})),b()};return g(),r.push(e.onManipulatorsChanged(g),Object(ot.d)((function(){return Object(ot.b)(v)}))),Object(ot.b)(r)}function ca(e){return Object(p.k)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}var sa=Object(Y.e)(),la=a(503),ua=a(517);function ha(e){var t=e.view,a=e.graphic,i=new Qe({graphic:a}),n=[],r=function(e,t,a){var i=e.view,n=e.graphic,r=new la.a({view:i,geometry:da(n),elevationInfo:Object(O.e)(n),attached:!1});return function(e,t,a,i){var n=function(){return t.attached=a.displaying};(function(e,t,a,i){var n=e.view,r=e.graphic,o=null,c=function(e){Object(p.k)(o)&&(o.remove(),o=null),a.isDraped&&Object(p.k)(e)&&(o=function(e,t,a){var i=e.elevationProvider.spatialReference;Object(K.p)(t,pa,i);var n=pa[0],r=pa[1];return e.elevationProvider.on("elevation-change",(function(e){Object(mt.j)(e.extent,n,r)&&a()}))}(n,e,(function(){t.geometry=e})))},s=function(){var e=da(r);c(e),t.geometry=e};i.push(a.on("changed",s),Object(ot.d)((function(){return o}))),s()})(e,t,a,i),B.visualElements.pointGraphics.outline.apply(t),i.push(Object(f.a)(a,"displaying",n))}(e,r,t,a),a.push(Object(ot.a)(r)),r}(e,i,n);return function(e,t,a,i){var n=e.view,r=e.graphic,o=new na.a({view:n,extensionType:B.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});B.visualElements.zVerticalLine.apply(o);var c=new re.a({view:n,intersectsLineInfinite:!0,attached:!1});B.visualElements.pointGraphics.shadowStyle.apply(c);var s=Object(ht.g)(B.visualElements.heightPlaneAngleCutoff),l=new re.a({view:n,attached:!1,angleCutoff:s});B.visualElements.heightPlane.apply(l);var u=Object(O.e)(e.graphic),h=ce.a.fromElevationInfo(u),d="on-the-ground"===u.mode||!u.offset&&"absolute-height"!==u.mode,f=new ia,b=1,v=1,g=function(){f.update(e);var a=da(r),s=d&&(t.isDraped||Object(p.j)(a)||!a.hasZ),u=!0;if(!s&&Object(p.k)(a)){var g=Object(ua.e)(a,n.elevationProvider,h,n.renderCoordsHelper);Object(W.w)(pa,a.x,a.y,g),Object(K.s)(pa,a.spatialReference,pa,n.renderCoordsHelper.spatialReference),o.setStartEndFromWorldDownAtLocation(pa),c.intersectsWorldUpAtLocation=pa}else u=!1;var y=2&f.grabbingState?B.visualElements.laserlineAlphaMultiplier:1;y!==b&&(b=y,B.visualElements.heightPlane.apply(l,y));var m=Object(J.h)(fa);!s&&t.displaying&&i.calculateMapBounds(m)&&Object(K.s)(Object(J.q)(m,pa),n.spatialReference,pa,n.renderCoordsHelper.spatialReference)?(l.heightManifoldTarget=pa,l.attached=!0):l.attached=!1;var O=4&f.grabbingState?B.visualElements.laserlineAlphaMultiplier:1;O!==v&&(v=O,B.visualElements.pointGraphics.shadowStyle.apply(c,O));var j=u&&t.displaying&&!s;c.attached=j,o.attached=j};a.push(t.watch(["displaying","isDraped"],g),t.on("changed",g)),e.forEachManipulator((function(e){a.push(e.events.on("grab-changed",g))})),a.push(Object(ot.a)(c)),a.push(Object(ot.a)(o)),a.push(Object(ot.a)(l)),g()}(e,i,n,r),n.push(t.trackGraphicState(i)),{visualElement:r,remove:function(){Object(ot.b)(n).remove()}}}function da(e){var t=e.geometry;return Object(p.j)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}var pa=Object(Y.e)(),fa=Object(J.f)();function ba(e){switch(Object(p.s)(e.graphic.geometry).type){case"point":case"mesh":return ha(e);case"polygon":case"polyline":return ra(e);default:return null}}var va=[1,.5,0],ga=70,ya=Math.ceil(ga/3*2),ma=160,Oa=5*Math.PI/12,ja=1*Math.PI/3,_a=function(){function e(){Object(n.a)(this,e),this._available=!0}return Object(r.a)(e,[{key:"location",set:function(e){this.forEachManipulator3D((function(t){return t.location=e}))}},{key:"elevationAlignedLocation",set:function(e){this.forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))}},{key:"elevationInfo",set:function(e){this.forEachManipulator3D((function(t){return t.elevationInfo=e}))}},{key:"renderLocation",get:function(){var e;return this.forEachManipulator3D((function(t){e||(e=t.renderLocation)})),e}},{key:"available",get:function(){return this._available},set:function(e){this._available=e,this.forEachManipulator3D((function(t){return t.available=e}))}},{key:"grabbing",get:function(){return this.someManipulator((function(e){return e.grabbing}))}},{key:"dragging",get:function(){return this.someManipulator((function(e){return e.dragging}))}},{key:"hasManipulator",value:function(e){return this.someManipulator((function(t){return t===e}))}},{key:"someManipulator",value:function(e){var t=!1;return this.forEachManipulator((function(a){!t&&e(a)&&(t=!0)})),t}},{key:"forEachManipulator3D",value:function(e){this.forEachManipulator((function(t,a){t instanceof Gt&&e(t,a)}))}}]),e}(),Ma=a(348),wa=(a(1002),a(845),a(312));function ka(e,t){return xa(e,(function(){return t}))}function Sa(e){return xa(e,(function(e){return e.plane}))}function xa(e,t){var a=Object(Y.e)(),n=Object(Y.e)(),r=!1;return function(o){var c=t(o);if("start"===o.action){var s=Object(dt.i)(o.screenStart,Object(dt.c)(st.c.get())),l=wt(e.state.camera,s,Ta);Object(p.k)(l)&&(r=Object(jt.m)(c,l,a))}if(!r)return null;var u=Object(dt.i)(o.screenEnd,Object(dt.c)(st.c.get())),h=wt(e.state.camera,u,Ta);return Object(p.j)(h)?null:Object(jt.m)(c,h,n)?Object(i.a)(Object(i.a)({},o),{},{renderStart:a,renderEnd:n,plane:c,ray:h}):null}}function Ea(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=null;return function(c){if("start"===c.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(dt.f)(c.screenStart.x,c.screenStart.y),t,a,r),Object(p.k)(o)&&Object(p.k)(n)&&!Object(K.o)(o,o,n)))return null;if(Object(p.j)(o))return null;var s=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(dt.f)(c.screenEnd.x,c.screenEnd.y),t,a,r);return Object(p.k)(s)?Object(p.k)(n)&&!Object(K.o)(s,s,n)?null:Object(i.a)(Object(i.a)({},c),{},{mapStart:o,mapEnd:s}):null}}function Da(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return Ea(e,a,Object(O.g)(t,e,a),i,n)}function Ga(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return Da(e,a,Object(O.e)(t),i,n)}function Aa(e,t,a){var i=null,n=new wa.a;return n.next(ka(e,function(e,t){var a=Pa,i=Ca,n=Object(jt.d)();e.renderCoordsHelper.worldUpAtPosition(t,a);var r=Object(W.g)(n,a,Object(W.j)(i,t,e.state.camera.eye));return Object(W.g)(r,r,a),Object(jt.g)(t,r,n)}(e,t))).next(function(e,t){var a=Object(Y.e)(),i=Object(W.p)(t);e.renderCoordsHelper.worldUpAtPosition(t,a);var n=Object(Y.e)(),r=Object(Y.e)(),o=function(n){return Object(W.j)(n,n,t),Object(Ma.c)(a,n,n),"global"===e.viewingMode&&Object(W.p)(n)*Object(ht.s)(Object(W.h)(a,n))<.001-i&&Object(W.j)(n,Object(W.e)(n,a,.001),t),Object(W.f)(n,n,t),n};return function(e){return e.renderStart=o(Object(W.k)(n,e.renderStart)),e.renderEnd=o(Object(W.k)(r,e.renderEnd)),e}}(e,t)).next(Ra(e,a)).next((function(e){e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,i=e})),function(e){return i=null,n.execute(e),i}}function Ra(e,t){var a=e.renderCoordsHelper;return function(e){var n=a.fromRenderCoords(e.renderStart,t),r=a.fromRenderCoords(e.renderEnd,t);return Object(p.k)(n)&&Object(p.k)(r)?Object(i.a)(Object(i.a)({},e),{},{mapStart:n,mapEnd:r}):null}}var Pa=Object(Y.e)(),Ca=Object(Y.e)(),Ta=Object(_t.c)();function za(e,t,a,i){var n=e.graphic,r=function(e,a){return t({action:e,graphic:n,dxScreen:a.screenDeltaX,dyScreen:a.screenDeltaY})};return a((function(e,t,a){var o=t.next((function(e){return"start"===e.action&&r("start",e),e})).next(Object(wa.g)(n,i)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&r("update",e);break;case"end":r("end",e)}return e}));return a.next(Object(wa.i)(n)).next((function(){r("end",{screenDeltaX:0,screenDeltaY:0})})),o}))}function Ia(e){if(Object(p.j)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;var a=t[0],i=t[1];return Math.atan2(i[1]-a[1],i[0]-a[0])}var Va=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this))._handles=new rt.a,i._arrowManipulatorInfos=new Array,i._opaqueMaterial=i.createMaterial(),i._transparentMaterial=i.createMaterial(.5),i._angle=0,i._scale=1,i._radius=ga,i._updateAfterDrag=!1,i.events=new h.a,i._tool=e.tool,i._view=e.view,null!=e.radius&&(i._radius=e.radius),i._createManipulators(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(r.a)(a,[{key:"orthogonalAvailable",set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}},{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}},{key:"forEachManipulator",value:function(e){this._arrowManipulatorInfos.map((function(t){var a=t.manipulator;return e(a,1)}))}},{key:"createGraphicDragPipeline",value:function(e,t,a){var i=this,n=t.graphic,r=Object(O.e)(n),o=Object(p.s)(n.geometry).spatialReference;return za(t,a,(function(t){return i.createDragPipeline((function(a,i,n,r,o){return t(a,e(a,i,n,r,o),n)}),r,o,n)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t,a,n){var r=this;return Object(ot.b)(this._arrowManipulatorInfos.map((function(o,c){var s=o.manipulator;return Object(wa.e)(s,(function(o,s,l,u,h){var d=s.next((function(e){return Object(i.a)(Object(i.a)({},e),{},{manipulatorType:1})})).next(Object(wa.f)(r._view,o.elevationAlignedLocation)).next(Da(r._view,o.elevationAlignedLocation,t,a,n)).next(Object(wa.d)(o.location,r.angle+(c+1)*Math.PI*.5)).next(Object(wa.c)());e(o,d,l,u,h)}))})))}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}},{key:"_updateManipulators",value:function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}},{key:"_updateArrowManipulator",value:function(e,t){var a=e.manipulator,i=e.transform,n=this._radius/ga,r=54*n,o=r*Math.sqrt(3)/2,c=ye.a.createExtrudedTriangle(o,r/2,r/2,.02);ye.a.transformInPlace(c,Object(ct.q)(st.a.get(),Object(W.w)(st.d.get(),0,-o/3,0))),a.renderObjects=[{geometry:c,material:this._opaqueMaterial,stateMask:2},{geometry:c,material:this._transparentMaterial,stateMask:1}],a.radius=o/3*2*1.2;var s=Object(ct.i)(st.a.get());Object(ct.w)(s,t*Math.PI/2);var l=Object(ct.i)(st.a.get());Object(ct.q)(l,Object(W.w)(st.d.get(),0,100*n,0)),Object(ct.m)(i,s,l)}},{key:"_createManipulators",value:function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}},{key:"_updateManipulatorTransform",value:function(){var e=this.angle,t=Object(ct.i)(st.a.get());Object(ct.c)(t,t,e,Object(Y.g)(0,0,1));var a=Object(ct.u)(st.a.get(),Object(W.w)(st.d.get(),this.displayScale,this.displayScale,this.displayScale)),i=Object(ct.i)(st.a.get());Object(ct.m)(i,a,t);var n,r=Object(N.a)(this._arrowManipulatorInfos);try{for(r.s();!(n=r.n()).done;){var o=n.value,c=Object(ct.m)(st.a.get(),i,o.transform);o.manipulator.modelTransform=c}}catch(s){r.e(s)}finally{r.f()}}},{key:"_createArrowManipulator",value:function(e){var t=this,a=new Gt({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(Y.g)(0,0,1)}}),i={manipulator:a,transform:Object(vt.d)()};return this._updateArrowManipulator(i,e),this._handles.add(a.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),i}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=_.a.toUnitRGBA(S.main);return t[3]*=e,new Wt.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}}}]),a}(_a),Ha=function(){function e(){Object(n.a)(this,e),this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new wa.a,this._enabled=!1}return Object(r.a)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&Object(p.k)(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,a=this.snap(this.lastDragEvent.screenEnd);if(Object(p.k)(a)){var i={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?a:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(i)}}this._enabled=e}},{key:"snap",value:function(e){var t=Object(p.k)(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(p.k)(t)&&Object(p.k)(this.view)&&(t.z=Object(O.g)(t,this.view,this.elevationInfo)),t}},{key:"createDragEventPipelineStep",value:function(e,t){var a=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(a.lastDragEvent="end"!==e.action?Object(i.a)({},e):null,a._enabled){var t=a.snap(e.screenEnd);return Object(p.k)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}]),e}(),La=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this))._handles=new rt.a,i._snapToScene=new Ha,i._discMaterial=i._createMaterial(),i._discMaterialTransparent=i._createMaterial(.5),i._scale=1,i._radius=ga,i._view=e.view,i._tool=e.tool,null!=e.snapToScene&&(i.snapToScene=e.snapToScene),null!=e.radius&&(i._radius=e.radius),i._createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(r.a)(a,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"snapToScene",get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}},{key:"createGraphicDragPipeline",value:function(e,t,a){var i=this,n=t.graphic,r=Object(O.e)(n),o=Object(p.s)(n.geometry).spatialReference;return za(t,a,(function(t){return i.createDragPipeline((function(a,i,n,r,o){return t(a,e(a,i,n,r,o),n)}),r,o,n)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t,a,n){var r=this,o=this._view;return Object(wa.e)(this._manipulator,(function(c,s,l,u,h){var d=s.next(Object(wa.f)(o,c.elevationAlignedLocation)).next(Da(o,c.elevationAlignedLocation,t,a,n)).next(r._snapToScene.createDragEventPipelineStep(o,t),r._snapToScene.next).next((function(e){return Object(i.a)(Object(i.a)({},e),{},{manipulatorType:1})})).next(Object(wa.c)());e(c,d,l,u,h)}))}},{key:"_updateManipulatorTransform",value:function(){var e=Object(ct.u)(st.a.get(),Object(W.w)(st.d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}},{key:"_createManipulator",value:function(){var e=this._view;this._manipulator=new Gt({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(Y.g)(0,0,1)},worldOriented:!0}),this._updateManipulator()}},{key:"_updateManipulator",value:function(){var e=ye.a.createCylinderGeometry(.02,1,128,Object(Y.g)(0,0,1),Object(Y.g)(0,0,0)),t=Object(ct.u)(Object(vt.d)(),Object(Y.g)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/ga*80}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=_.a.toUnitRGBA(S.main);return t[3]*=e,new Wt.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{discManipulator:this._manipulator}}}]),a}(_a),Fa=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this))._handles=new rt.a,i._radius=ga,i.events=new h.a,i._tool=e.tool,i._view=e.view,null!=e.radius&&(i._radius=e.radius),i.createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(r.a)(a,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))}},{key:"forEachManipulator",value:function(e){e(this._manipulator,0)}},{key:"createGraphicDragPipeline",value:function(e,t,a){var i=this,n=Object(p.s)(t.graphic.geometry).spatialReference;return za(t,a,(function(t){return i.createDragPipeline((function(a,i,n,r,o){return t(a,e(a,i,n,r,o),n)}),n)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t){var a=this._view;return Object(wa.e)(this._manipulator,(function(n,r,o,c,s){var l=r.next((function(e){return Object(i.a)(Object(i.a)({},e),{},{manipulatorType:0})})).next(Aa(a,n.renderLocation,t)).next(Object(wa.c)());e(n,l,o,c,s)}))}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}},{key:"updateManipulator",value:function(){var e=this._radius/ga,t=B.zManipulator.height*e,a=B.zManipulator.coneHeight*e,i=B.zManipulator.coneWidth*e,n=B.zManipulator.width*e,r=[Object(Y.g)(0,0,0),Object(Y.g)(0,0,t)],o=ye.a.createTubeGeometry(r,n/2,16,!1),c=ye.a.createConeGeometry(a,i/2,16,!1),s=[Object(Y.g)(0,0,0),Object(Y.g)(0,0,t+a)],l=function(e){var a=Object(vt.d)();return Object(ct.t)(a,a,[0,0,t]),Object(ct.b)(a,a,Math.PI/2),a}(),u=function(e,t){var a=Object(M.a)(B.zManipulator.color,t);return[a.r/255,a.g/255,a.b/255,B.zManipulator.color.a*e]},h=Yt(u(1,.25),1),d=Yt(u(1,0),1),p=Yt(u(.7,0),B.zManipulator.renderOccluded),f=Yt(u(.85,0),B.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:c,transform:l,material:h,stateMask:1},{geometry:o,material:h,stateMask:1},{geometry:c,transform:l,material:d,stateMask:2},{geometry:o,material:d,stateMask:2},{geometry:c,transform:l,material:p,stateMask:1},{geometry:o,material:p,stateMask:1},{geometry:c,transform:l,material:f,stateMask:2},{geometry:o,material:f,stateMask:2}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[s]}}},{key:"createManipulator",value:function(){var e=this,t=new Gt({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var a=e._view.state.camera,i=Ua;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,i);var n=Object(W.n)(a.eye,i),r=a.computeRenderPixelSizeAtDist(n),o=Object(W.j)(Ba,i,a.eye);Object(W.r)(o,o);var c=qa;e._view.renderCoordsHelper.worldUpAtPosition(Ua,c);var s=Math.abs(Object(W.h)(o,c)),l=Object(W.g)(Ba,o,c),u=Object(W.g)(Ba,l,c),h=Object(ht.e)(s,.01,1),d=1-Math.sqrt(1-h*h)/h/a.fullWidth,p=e._radius/ga,f=B.zManipulator.width*p;Object(W.e)(u,Object(W.r)(u,u),(1/d-1)*n+r*f),t[12]-=Ba[0],t[13]-=Ba[1],t[14]-=Ba[2]},this._manipulator=t,this.updateManipulator()}},{key:"test",get:function(){return{manipulator:this._manipulator}}}]),a}(_a),Ua=Object(Y.e)(),Ba=Object(Y.e)(),qa=Object(Y.e)(),Za=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;Object(n.a)(this,a),(i=t.call(this))._handles=new rt.a,i._angleDeferred=null,i._interactive=!0;var r=e.tool,o=e.view,c=e.snapToScene,s=e.radius;return i._view=o,i.xyManipulation=new La({tool:r,view:o,snapToScene:c,radius:s}),i.xyAxisManipulation=new Va({tool:r,view:o,radius:s}),i.zManipulation=new Fa({tool:r,view:o,radius:s}),i.xyManipulation.available=e.xyAvailable,i.xyAxisManipulation.available=e.xyAxisAvailable,i.zManipulation.available=e.zAvailable,i.autoHideXYAxis(),i.forEachManipulator((function(e){i._handles.add(e.events.on("grab-changed",(function(){return i.updateManipulatorInteractivity()})))})),i}return Object(r.a)(a,[{key:"destroy",value:function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}},{key:"createGraphicDragPipeline",value:function(e,t,a){return Object(ot.b)([this.xyManipulation.createGraphicDragPipeline((function(t,a,i,n,r){return e(0,t,a,i,n,r)}),t,a),this.xyAxisManipulation.createGraphicDragPipeline((function(t,a,i,n,r){return e(1,t,a,i,n,r)}),t,a),this.zManipulation.createGraphicDragPipeline((function(t,a,i,n,r){return e(2,t,a,i,n,r)}),t,a)])}},{key:"createDragPipeline",value:function(e,t,a,i){return Object(ot.b)([this.xyManipulation.createDragPipeline((function(t,a,i,n,r){return e(0,t,a,i,n,r)}),t,a,i),this.xyAxisManipulation.createDragPipeline((function(t,a,i,n,r){return e(1,t,a,i,n,r)}),t,a,i),this.zManipulation.createDragPipeline((function(t,a,i,n,r){return e(2,t,a,i,n,r)}),a)])}},{key:"snapToScene",set:function(e){this.xyManipulation.snapToScene=e}},{key:"angle",set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}},{key:"angleDeferred",set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}},{key:"interactive",set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}},{key:"radius",set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}},{key:"displayScale",set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}},{key:"forEachManipulator",value:function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,1)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,1)})),this.zManipulation.forEachManipulator((function(t){return e(t,0)}))}},{key:"xyAxisVisible",get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}},{key:"autoHideXYAxis",value:function(){var e=this,t=this.xyAxisManipulation,a=this.xyManipulation;if(!Object(u.a)("esri-mobile")){var i=[];a.forEachManipulator((function(e){return i.push(e)})),t.forEachManipulator((function(e){return i.push(e)}));for(var n=function(){var a=[];e.xyAxisVisible?Object(p.k)(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator((function(e){return a.push(e.disableDisplay())})),e._handles.remove(Na),e._handles.add(a,Na)},r=0,o=i;r<o.length;r++){var c=o[r];this._handles.add(c.events.on("focus-changed",n))}this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",n)),n()}}},{key:"updateManipulatorInteractivity",value:function(){var e=this,t=this.grabbing;this.forEachManipulator((function(a){a.interactive=!t&&e._interactive||a.grabbing}))}}],[{key:"radiusForSymbol",value:function(e){var t=Object(p.k)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?ya:ga}}]),a}(_a),Na="disable-xy-axis-display",Wa=a(780),Ya=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this))._handles=new rt.a,i._view=e.view,i._tool=e.tool,i._graphicState=e.graphicState,i._createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(r.a)(a,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"createGraphicDragPipeline",value:function(e){var t=this;return za(this._graphicState,e,(function(e){return t.createDragPipeline(e)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e){var t=this._view,a=this._graphicState.graphic,i=Object(p.k)(a.geometry)?a.geometry.spatialReference:null;return Object(wa.e)(this._manipulator,(function(n,r,o,c,s){var l=r.next(function(e,t,a,i){var n=t.toMap(e.screenStart,{include:[a]});return Object(p.k)(n)?Ga(t,a,n,i):null}(s,t,a,i)).next(Object(wa.b)()).next(Object(wa.c)());e(n,l,o,c,s)}))}},{key:"_createManipulator",value:function(){var e=this._view,t=this._graphicState.graphic;this._manipulator=new Wa.a({graphic:t,view:e,selectable:!0,cursor:"move"})}}]),a}(_a),Xa=a(594),Qa=a(344),Ka=a(314),Ja=function e(t){Object(n.a)(this,e),this.allGraphics=t,this.type="graphic-move-start"},$a=function e(t,a,i){Object(n.a)(this,e),this.dx=t,this.dy=a,this.allGraphics=i,this.type="graphic-move"},ei=function e(t){Object(n.a)(this,e),this.allGraphics=t,this.type="graphic-move-stop"},ti=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).graphics=new nt.a,i.enableZ=!0,i.type="move-3d",i._toolHandles=new rt.a,i.snappingPipeline=new ea.a,i}return Object(r.a)(a,[{key:"initialize",value:function(){var e=this;this._toolHandles.add([this.graphics.on("change",(function(){return e._refreshManipulators()}))]),this._refreshManipulators(),this.complete()}},{key:"destroy",value:function(){this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"reset",value:function(){}},{key:"_refreshManipulators",value:function(){var e=this;this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter((function(e){return 0===Object(Xa.a)(e)})).map((function(e){return new ai(e)}));t.length&&(this.createManipulators(t),this.createVisualElements(t),this.handles.add(t.map((function(t){return e.view.trackGraphicState(t.state)}))),this.updateMoveManipulation(t))}},{key:"createManipulators",value:function(e){var t,a=this,n=Object(N.a)(e);try{var r=function(){var n=t.value,r=n.state;n.manipulationXY=new Ya({tool:a,view:a.view,graphicState:r}),n.manipulationXY.forEachManipulator((function(e){return a.handles.add(e.events.on("immediate-click",(function(e){a.emit("immediate-click",Object(i.a)(Object(i.a)({},e),{},{graphic:r.graphic})),e.stopPropagation()})))})),a.handles.add(n.manipulationXY.createDragPipeline((function(t,i,n,r){return a.buildDragEventPipeline(e,0,t,i,n,r)})))};for(n.s();!(t=n.n()).done;)r()}catch(o){n.e(o)}finally{n.f()}this.createMoveManipulation(e)}},{key:"createMoveManipulation",value:function(e){var t=this,a=new Za({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Za.radiusForSymbol(e[0].graphic.symbol):ga});this._moveManipulation=a,a.elevationInfo={mode:"absolute-height",offset:0},a.forEachManipulator((function(e){t.handles.add(e.events.on("immediate-click",(function(n){a.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",Object(i.a)(Object(i.a)({},n),{},{graphic:t.graphics.getItemAt(0)})),n.stopPropagation()})))}));var n,r=function(){return t.updateMoveManipulation(e)},o=Object(N.a)(e);try{for(o.s();!(n=o.n()).done;){var c=n.value;this.handles.add([c.state.on("changed",r),c.state.watch("displaying",r)])}}catch(l){o.e(l)}finally{o.f()}var s=e[e.length-1];this.handles.add(s.state.on("changed",(function(){return t.updateMoveManipulationAngle(s)}))),this.handles.add(a.createDragPipeline((function(a,i,n,r,o){return t.buildDragEventPipeline(e,a,i,n,r,o)}),Object(O.e)(s.graphic),Object(p.s)(s.graphic.geometry).spatialReference,s.graphic)),this.updateMoveManipulationAngle(s)}},{key:"createVisualElements",value:function(e){var t,a=this,i=Object(N.a)(e);try{var n=function(){var i=t.value,n=i.graphic,r=ba({view:a.view,graphic:n,forEachManipulator:function(e){i.manipulationXY.forEachManipulator(e),a._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return Object(ot.c)()}});Object(p.j)(r)||(i.geometryRepresentation=r.visualElement,i.geometryRepresentation instanceof de&&a.handles.add([i.geometryRepresentation.events.on("attachment-origin-changed",(function(){i.state.isDraped||a.updateMoveManipulation(e)})),i.state.watch("isDraped",(function(){return a.updateMoveManipulation(e)}))]),a.handles.add(r))};for(i.s();!(t=i.n()).done;)n()}catch(r){i.e(r)}finally{i.f()}}},{key:"updateMoveManipulationAngle",value:function(e){this._moveManipulation.angleDeferred=function(){return Ia(e.graphic.geometry)}}},{key:"updateMoveManipulation",value:function(e){var t,a=Object($.g)(0,0,0,this.view.spatialReference),i=0,n=!1,r=this._moveManipulation,o=Object(N.a)(e);try{for(o.s();!(t=o.n()).done;){var c=t.value;if(c.state.displaying){var s=c.state.graphic;this.enableZ&&aa(s)&&(n=!0);var l=c.geometryRepresentation instanceof de&&!c.state.isDraped?c.geometryRepresentation.attachmentOrigin:Jt(this.view,s);Object(p.k)(l)&&(a.x+=l.x,a.y+=l.y,a.z+=l.z,i++)}}}catch(u){o.e(u)}finally{o.f()}i>0?(a.x/=i,a.y/=i,a.z/=i,r.location=a,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=n):r.available=!1}},{key:"buildDragEventPipeline",value:function(e,t,a,i,n,r){var o=this,c=[],s=[],l=null,u=null,h=function(){var e,t=Object(N.a)(c);try{for(t.s();!(e=t.n()).done;){e.value.dragging=!1}}catch(a){t.e(a)}finally{t.f()}c.length=0,s.length=0,l=null,u=null,o._moveManipulation.interactive=!0};if(1===e.length&&0===t){var d=e[0].graphic;i=this.buildSnappingPipelineSteps(d,Object(O.e)(d),i,n,r)}var p=i.next((function(t){if("start"===t.action){c.length=0,s.length=0;var i,n=Object(N.a)(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;r.dragging||!r.manipulationXY.hasManipulator(a)&&r.manipulationXY.grabbing||(c.push(r),s.push(r.graphic),r.dragging=!0)}}catch(h){n.e(h)}finally{n.f()}if(0!==s.length&&(o._moveManipulation.interactive=!1,l=Object(wa.h)(s,o.view.state.viewingMode),u=Object(wa.j)(s),o.emit("graphic-move-start",new Ja(s)),o.destroyed))return null}return 0!==s.length?t:null})).next((function(e){return l(e)})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=o.view.toScreen(e.mapStart),a=o.view.toScreen(e.mapEnd),i=a.x-t.x,n=a.y-t.y;if(o.emit("graphic-move",new $a(i,n,s)),o.destroyed)return null}break;case"end":if(o.emit("graphic-move-stop",new ei(s)),o.destroyed)return null;h()}}));return n.next((function(e){return u(e)})).next((function(){if(o.emit("graphic-move-stop",new ei(s)),o.destroyed)return null;h()})),p}},{key:"buildSnappingPipelineSteps",value:function(e,t,a,n,r){var o=this,c=e.geometry;if(Object(p.j)(c)||"point"!==c.type&&"mesh"!==c.type)return a;var s=("point"===c.type?c:c.anchor).clone(),l=new Ka.a({elevationInfo:t,pointer:r,geometry:Qa.a.fromGeometry(s,this.view.viewingMode),visualizer:new ta.a,excludeFeature:e}),u=this.snappingManager;return a.next((function(t){return s.z=Object(O.a)(o.view,s,Object(O.e)(e),{mode:"absolute-height",offset:0}),Object(i.a)(Object(i.a)({},t),{},{snapOrigin:l.coordinateHelper.fromPoint(s)})})).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:l,snappingManager:u,cancel:n,updatingHandles:this.updatingHandles}),this.snappingPipeline.next)}}]),a}(Object(d.b)(h.a.EventedMixin($e.a)));Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],ti.prototype,"view",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],ti.prototype,"graphics",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],ti.prototype,"enableZ",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],ti.prototype,"snappingManager",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],ti.prototype,"type",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],ti.prototype,"updating",null),ti=Object(s.a)([Object(y.a)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],ti);var ai=function(){function e(t){Object(n.a)(this,e),this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Qe({graphic:t})}return Object(r.a)(e,[{key:"graphic",get:function(){return this.state.graphic}}]),e}(),ii=a(406),ni=a(94),ri=a(151),oi=a(597);function ci(e,t,a){var i="on-the-ground"===a.mode?1:0;return new oi.a(e,i,t,0)}function si(e,t,a){var i=Object(Y.e)();if(!e.renderCoordsHelper.toRenderCoords(t,i))return null;var n=li(e,t,Object(jt.r)(a.plane)),r=li(e,t,a.edgeDirection);if(Object(p.j)(n)||Object(p.j)(r))return null;var o=Object(W.g)(Object(Y.e)(),n,r);return Object(jt.g)(i,o,Object(jt.d)())}function li(e,t,a){var i=Object($.g)(t.x+a[0],t.y+a[1],t.z+a[2],t.spatialReference),n=Object(Y.e)(),r=Object(Y.e)();return e.renderCoordsHelper.toRenderCoords(t,n)&&e.renderCoordsHelper.toRenderCoords(i,r)?Object(W.v)(r,n,r):null}function ui(e,t,a){var i=a.projectToRenderScreen(e,Object(dt.d)()),n=a.projectToRenderScreen(t,Object(dt.d)());return Object(W.t)(Object(W.j)(i,i,n))}var hi=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e))._vertexManipulatorMaterial=Yt(B.colorToVec4(B.reshapeManipulators.vertex.color),B.reshapeManipulators.vertex.renderOccluded),i._vertexManipulatorOutlineMaterial=Xt(B.colorToVec4(B.reshapeManipulators.vertex.outlineColor),B.reshapeManipulators.vertex.renderOccluded),i._vertexManipulatorHoverOutlineMaterial=Xt(B.colorToVec4(B.reshapeManipulators.vertex.hoverOutlineColor),B.reshapeManipulators.vertex.renderOccluded),i._edgeManipulatorMaterial=Yt(B.colorToVec4(B.reshapeManipulators.edge.color),B.reshapeManipulators.edge.renderOccluded),i._edgeManipulatorOutlineMaterial=Xt(B.colorToVec4(B.reshapeManipulators.edge.outlineColor),B.reshapeManipulators.edge.renderOccluded),i._edgeOffsetManipulatorMaterial=Yt(B.colorToVec4(B.reshapeManipulators.edgeOffset.color),B.reshapeManipulators.edgeOffset.renderOccluded,!1),i._edgeOffsetManipulatorHoverMaterial=Yt(B.colorToVec4(B.reshapeManipulators.edgeOffset.hoverColor),B.reshapeManipulators.edgeOffset.renderOccluded,!1),i._selectedManipulatorMaterial=Yt(B.colorToVec4(B.reshapeManipulators.selected.color),B.reshapeManipulators.selected.renderOccluded),i._selectedManipulatorOutlineMaterial=Xt(B.colorToVec4(B.reshapeManipulators.selected.outlineColor),B.reshapeManipulators.selected.renderOccluded),i._selectedManipulatorHoverOutlineMaterial=Xt(B.colorToVec4(B.reshapeManipulators.selected.hoverOutlineColor),B.reshapeManipulators.selected.renderOccluded),i._selectedIndex=0,i._vertexManipulatorGeometry=null,i._vertexManipulatorOutlineGeometry=null,i._edgeManipulatorGeometry=null,i._edgeManipulatorOutlineGeometry=null,i._edgeOffsetManipulatorGeometryInside=null,i._edgeOffsetManipulatorGeometryOutside=null,i._manipulatorHandles=new rt.a,i._manipulatorInfos=[],i._editGeometryHelper=null,i._graphicMoveManipulation=null,i._moveManipulation=null,i._numGrabbing=0,i._numDragging=0,i._reshapeEventState=0,i._outlineVisualElement=null,i.tool=null,i.outputGeometry=null,i._snappingPipeline=new ea.a,i._snappingPipelineHandle=new ea.a,i._vertexLaserLineVisualElement=null,i}return Object(r.a)(a,[{key:"initialize",value:function(){var e=this,t=new Qe({graphic:this.graphic});this._graphicState=t,this.handles.add([t.watch("displaying",(function(t){var a,i=Object(N.a)(e._manipulatorInfos);try{for(i.s();!(a=i.n()).done;){a.value.manipulator.available=t}}catch(n){i.e(n)}finally{i.f()}})),this.view.trackGraphicState(t)])}},{key:"destroy",value:function(){this._clear()}},{key:"inputGeometry",get:function(){return Object(p.k)(this._editGeometryHelper)?this._editGeometryHelper.geometry:null},set:function(e){this._recreateEditGeometryAndManipulators(e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZShape",get:function(){return this.tool.enableZShape}},{key:"enableZVertex",get:function(){return this.tool.enableZVertex}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}},{key:"enableMidpoints",get:function(){return this.tool.enableMidpoints}},{key:"enableEdgeOffset",get:function(){return this.tool.enableEdgeOffset}},{key:"removeSelectedVertices",value:function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.handle.type}));this._removeVertices(e)}},{key:"manipulatorSelectionChanged",value:function(){this.emit("manipulators-changed")}},{key:"_clear",value:function(){this._removeManipulators(),this._resetGrabbingDragging(),this._editGeometryHelper=Object(p.e)(this._editGeometryHelper)}},{key:"_removeManipulators",value:function(){this._moveManipulation=Object(p.e)(this._moveManipulation),this._graphicMoveManipulation=Object(p.e)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}},{key:"_resetGrabbingDragging",value:function(){this._numGrabbing=0,this._numDragging=0}},{key:"_createManipulators",value:function(){if(!Object(p.j)(this._editGeometryHelper)){var e,t=Object(O.e)(this.graphic),a=Object(N.a)(this._editGeometryHelper.editGeometry.components);try{for(a.s();!(e=a.n()).done;){var i,n=e.value,r=Object(N.a)(n.vertices);try{for(r.s();!(i=r.n()).done;){var o=i.value;this._createVertexOrEdgeManipulator(o,t)}}catch(u){r.e(u)}finally{r.f()}var c,s=Object(N.a)(n.edges);try{for(s.s();!(c=s.n()).done;){var l=c.value;this._createVertexOrEdgeManipulator(l,t)}}catch(u){s.e(u)}finally{s.f()}}}catch(u){a.e(u)}finally{a.f()}this._createGraphicMoveManipulators(t)}}},{key:"canRedo",get:function(){return Object(p.k)(this._editGeometryHelper)&&this._editGeometryHelper.canRedo}},{key:"canUndo",get:function(){return Object(p.k)(this._editGeometryHelper)&&this._editGeometryHelper.canUndo}},{key:"redo",value:function(){if(Object(p.j)(this._editGeometryHelper))return null;var e=this._editGeometryHelper.redo();return Object(p.k)(e)&&(this.outputGeometry=this._editGeometryHelper.geometry,this._recreateManipulators()),e}},{key:"undo",value:function(){if(Object(p.j)(this._editGeometryHelper))return null;this.emit("undo");var e=this._editGeometryHelper.undo();return Object(p.k)(e)&&(this.outputGeometry=this._editGeometryHelper.geometry,this._recreateManipulators()),e}},{key:"_recreateManipulators",value:function(){this._removeManipulators(),this._resetGrabbingDragging(),this._createManipulators()}},{key:"_recreateEditGeometryAndManipulators",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputGeometry;this._clear(),Object(p.j)(e)||(Object(p.e)(this._editGeometryHelper),this._editGeometryHelper=Qa.a.fromGeometry(e,this.view.viewingMode),this._createManipulators())}},{key:"_perGraphicManipulatorDragAction",value:function(e,t){if("end"!==t.action){var a,i=0,n=[],r=this._manipulatorInfos.some((function(e){return"vertex"===e.handle.type&&e.manipulator.selected})),o=1===e&&r,c=Object(N.a)(this._manipulatorInfos);try{for(c.s();!(a=c.n()).done;){var s=a.value;pi(s)&&(s.manipulator.grabbing||o&&!s.manipulator.selected||n.push(s),i++)}}catch(l){c.e(l)}finally{c.f()}if(0!==n.length)if(this._moveVertices(n,t),n.length===i){if(this._updateEventState(1),this.destroyed)return;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(2),this.destroyed)return;this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"isMultiVertexSelection",value:function(){var e,t=0,a=Object(N.a)(this._manipulatorInfos);try{for(a.s();!(e=a.n()).done;){var i=e.value;pi(i)&&i.manipulator.selected&&t++}}catch(n){a.e(n)}finally{a.f()}return t>1}},{key:"_perVertexManipulatorDragAction",value:function(e){if(this._updateEventState(2),!this.destroyed){var t=e.mapDeltaX,a=e.mapDeltaY,i=e.mapDeltaZ;if(t||a||i){var n,r=[],o=Object(N.a)(this._manipulatorInfos);try{for(o.s();!(n=o.n()).done;){var c=n.value;pi(c)&&(c.manipulator.selected&&!c.manipulator.grabbing||c===e.info)&&r.push(c)}}catch(s){o.e(s)}finally{o.f()}this._moveVertices(r,e,1),this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"_updateEventState",value:function(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}},{key:"_createGraphicMoveManipulators",value:function(e){var t=this;if(this._graphicMoveManipulation=new Ya({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic){var a=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(e,i,n){i.next((function(e){return t._trackNumDragging(e)})).next((function(e){return"start"===e.action&&(a=Object(p.s)(t._editGeometryHelper).createUndoGroup()),e})).next((function(e){t._perGraphicManipulatorDragAction(0,e),"end"===e.action&&(a=Object(p.r)(a))})),n.next(t._cancelDragOperation((function(){return a=Object(p.r)(a)})))})))}else this._graphicMoveManipulation.forEachManipulator((function(e){e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click",Object(i.a)(Object(i.a)({},e),{},{graphic:t.graphic})),e.stopPropagation()}))])})),this._moveManipulation=new Za({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&aa(this.graphic),snapToScene:!1,radius:Za.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((function(e){t.handles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(a){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click",Object(i.a)(Object(i.a)({},a),{},{graphic:t.graphic})),a.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var n=Object(p.s)(this.graphic.geometry).spatialReference;this.handles.add([this._moveManipulation.createDragPipeline((function(a,n,r,o,c){var s=r.next((function(e){return t._trackNumDragging(e)})).next((function(e){var a=t._manipulatorInfos.filter((function(e){return pi(e)&&e.manipulator.selected}));return 1===e.manipulatorType&&1===a.length?Object(i.a)(Object(i.a)({},e),{},{info:a[0],snapOrigin:a[0].handle.pos}):Object(i.a)(Object(i.a)({},e),{},{info:null})})).next(t._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:function(e){return!!e.info},cancel:o,snappingManager:t.tool.snappingManager,snappingContext:new Ka.a({geometry:Object(p.s)(t._editGeometryHelper),elevationInfo:e,pointer:c,excludeFeature:t.graphic,visualizer:new ta.a}),updatingHandles:t.updatingHandles}),t._snappingPipelineHandle.next).next(Object(wa.b)()).next((function(e){return t._perGraphicManipulatorDragAction(1,e),e}));return o.next(t._cancelDragOperation()),s}),e,n,this.graphic),Object(f.a)(this._graphicState,"displaying",(function(){t._updateMoveManipulationPosition()})),this._graphicState.on("changed",(function(){return t._updateMoveManipulationPosition()})),Object(f.a)(this._graphicState,"isDraped",(function(){var e="align-move-manipulation";t._graphicState.isDraped?t.handles.add(t.view.elevationProvider.on("elevation-change",(function(){return t._updateMoveManipulationPosition()})),e):t.handles.remove(e)}))]),this._updateMoveManipulationPosition();var r=ba({view:this.view,graphic:this.graphic,forEachManipulator:function(e){if(!t.destroyed){Object(p.k)(t._graphicMoveManipulation)&&t._graphicMoveManipulation.forEachManipulator(e);var a,i=Object(N.a)(t._manipulatorInfos);try{for(i.s();!(a=i.n()).done;){e(a.value.manipulator,1)}}catch(n){i.e(n)}finally{i.f()}t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});Object(p.k)(r)&&(this._outlineVisualElement=r.visualElement instanceof de?r.visualElement:null),Object(p.k)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(function(){t._graphicState.isDraped||t._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(function(){return t._updateMoveManipulationPosition()}))]),this._manipulatorHandles.add(r)}},{key:"_createEdgeOffsetManipulator",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(O.e)(this.graphic),n=B.reshapeManipulators.edgeOffset,r=n.size/2,o=r+n.collisionPadding;if(Object(p.j)(this._edgeOffsetManipulatorGeometryInside)||Object(p.j)(this._edgeOffsetManipulatorGeometryOutside)){var c=r/o,s=c*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=ye.a.createExtrudedTriangle(s,c/2,c/2,n.height,n.offset),this._edgeOffsetManipulatorGeometryOutside=ye.a.createExtrudedTriangle(-s,c/2,c/2,n.height,-n.offset)}var l=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2}],u=new Gt({view:this.view,renderObjects:l,elevationInfo:"on-the-ground"!==a.mode||Object(ri.h)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:a,worldOriented:!1,focusMultiplier:1,touchMultiplier:1,radius:o,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:Object(Y.g)(0,0,1)},collisionPriority:1}),h=new Gt({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:"default"});h.grabbable=!1;var d={manipulator:u,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,visibilityManipulator:h,elevationInfo:a,visibilityHandle:null},f=function(){Object(p.r)(d.visibilityHandle);(!u.focused&&!h.focused||ui(t._getManipulatorInfoFromHandle(d.handle.left).manipulator.renderLocation,t._getManipulatorInfoFromHandle(d.handle.right).manipulator.renderLocation,t.view.state.camera)<n.minSquaredEdgeLength)&&(u.grabbable=!1,d.visibilityHandle=Object(ot.b)([u.disableDisplay(),{remove:function(){u.grabbable=!0}}]))};this._manipulatorHandles.add([u.events.on("focus-changed",(function(){return f()})),h.events.on("focus-changed",(function(){return f()})),{remove:function(){Object(p.r)(d.visibilityHandle),t.manipulators.remove(d.visibilityManipulator)}}],u),f(),this._updateEdgeOffsetManipulator(d);var b=this._getManipulatorInfoFromHandle(d.handle.left).manipulator.events.on("location-update",(function(){return t._updateEdgeOffsetManipulator(d)})),v=this._getManipulatorInfoFromHandle(d.handle.right).manipulator.events.on("location-update",(function(){return t._updateEdgeOffsetManipulator(d)}));d.locationUpdateHandle=Object(ot.b)([b,v]),this._manipulatorHandles.add(d.locationUpdateHandle,u),this._manipulatorHandles.add(this._watchAndUpdateGrabState(u,!0),u);var g=Object(wa.e)(u,(function(e,i,n){t._clearSelection();var r=t._initializeEdgeOffset(d,a),o=r.step,c=r.cleanup;i.next((function(e){return t._trackNumDragging(e)})).next(Object(wa.f)(t.view,e.elevationAlignedLocation)).next(o).next(Sa(t.view)).next(Ra(t.view,Object(p.s)(t._editGeometryHelper).editGeometry.coordinateHelper.spatialReference)).next(Object(wa.b)()).next(t._applyEdgeOffsetStep(d)).next((function(e){"end"===e.action&&c()})),n.next((function(e){return c(),e})).next(t._cancelDragOperation())}));return this._manipulatorHandles.add(g,u),this._manipulatorHandles.add([u.events.on("immediate-click",(function(e){e.shiftKey||t._clearSelection(),e.stopPropagation()})),h.events.on("immediate-click",(function(e){return t.emit("immediate-click",Object(i.a)(Object(i.a)({},e),{},{graphic:t.graphic}))}))],u),this._manipulatorInfos.push(d),this.manipulators.add(u),this.manipulators.add(h),this.emit("manipulators-changed"),d}},{key:"_updateEdgeOffsetManipulator",value:function(e){this._updateManipulatorPosition(e);var t=Object(p.s)(this._editGeometryHelper).editGeometry.coordinateHelper,a=si(this.view,e.manipulator.elevationAlignedLocation,ci(t,e.handle,Object(p.s)(e.manipulator.elevationInfo))),i=this._getManipulatorInfoFromHandle(e.handle.left).manipulator.renderLocation,n=this._getManipulatorInfoFromHandle(e.handle.right).manipulator.renderLocation,r=Object(p.k)(a)?function(e,t,a){var i=Object(jt.r)(e),n=Object(W.v)(Object(Y.e)(),t,a),r=Object(W.g)(Object(Y.e)(),n,i),o=Object(W.g)(Object(Y.e)(),n,r);return Object(vt.e)(n[0],n[1],n[2],0,r[0],r[1],r[2],0,o[0],o[1],o[2],0,0,0,0,1)}(a,i,n):vt.a;e.manipulator.modelTransform=r,e.visibilityManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.visibilityManipulator.modelTransform=r;var o=Object(W.p)(Object(W.j)(yi,i,n))/2;e.visibilityManipulator.collisionType={type:"line",paths:[[[-o,0,0],[o,0,0]]]}}},{key:"_initializeEdgeOffset",value:function(e,t){var a=this,n=Object(p.s)(this._editGeometryHelper),r=ci(n.editGeometry.coordinateHelper,e.handle,t),o=n.createUndoGroup(),c=si(this.view,e.manipulator.elevationAlignedLocation,r);r.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.left.left),1),r.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.right.right),0);var s,l=function(){return new ni.a({paths:[[e.handle.left.pos,e.handle.right.pos]],spatialReference:Object(p.s)(a._editGeometryHelper).editGeometry.coordinateHelper.spatialReference})},u=new de({view:this.view,isDraped:this._graphicState.isDraped,geometry:l(),elevationInfo:e.elevationInfo,width:B.visualElements.lineGraphics.outline.width,color:B.colorToVec4(S.main),attached:!0}),h=function(){a._cleanEdgeOffsetCollapsedEdges(e),s=Object(p.r)(s)},d=this.on("undo",h);return s=Object(ot.b)([Object(ot.a)(u),this._graphicState.watch("isDraped",(function(e){return u.isDraped=e})),this._graphicState.on("changed",(function(){return u.geometry=l()})),o,d]),{step:function(e){return Object(p.j)(r)||Object(p.j)(c)?(h(),null):Object(i.a)(Object(i.a)({},e),{},{operation:r,plane:c})},cleanup:h}}},{key:"_applyEdgeOffsetStep",value:function(e){var t=this;return function(a){if(t.destroyed||Object(p.j)(a.operation))return a;t._updateEventState(2);var i=a.mapDeltaX,n=a.mapDeltaY,r=a.mapDeltaZ;return(i||n||r)&&(t._offsetEdge(e,a),t.emit("reshape",{type:"reshape",mover:t.graphic})),a}}},{key:"_cleanEdgeOffsetCollapsedEdges",value:function(e){var t,a,i=null==(t=e.handle.left.left)?void 0:t.left,n=e.handle.left,r=null==(a=e.handle.right.right)?void 0:a.right,o=e.handle.right,c=Object(p.s)(this._editGeometryHelper).editGeometry.coordinateHelper,s=1e-6,l=[];i&&c.distance(i.pos,n.pos)<s&&l.push(this._getManipulatorInfoFromHandle(n)),(c.distance(n.pos,o.pos)<s||r&&c.distance(r.pos,o.pos)<s)&&l.push(this._getManipulatorInfoFromHandle(o)),l.length&&this._removeVertices(l)}},{key:"_computeVertexManipulatorSizeAndOutline",value:function(e){var t=e.size/2,a=t+e.collisionPadding;return{size:t/a,outlineSize:(t+e.outlineSize)/a}}},{key:"_createVertexOrEdgeManipulator",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(O.e)(this.graphic);if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,a);if(!this.enableMidpoints)return null}if(Object(p.j)(this._vertexManipulatorGeometry)||Object(p.j)(this._vertexManipulatorOutlineGeometry)){var n=this._computeVertexManipulatorSizeAndOutline(B.reshapeManipulators.vertex),r=n.size,o=n.outlineSize;this._vertexManipulatorGeometry=ye.a.createSphereGeometry(r,16,16),this._vertexManipulatorOutlineGeometry=ye.a.createSphereGeometry(o,16,16)}if(Object(p.j)(this._edgeManipulatorGeometry)||Object(p.j)(this._edgeManipulatorOutlineGeometry)){var c=this._computeVertexManipulatorSizeAndOutline(B.reshapeManipulators.edge),s=c.size,l=c.outlineSize;this._edgeManipulatorGeometry=ye.a.createSphereGeometry(s,16,16),this._edgeManipulatorOutlineGeometry=ye.a.createSphereGeometry(l,16,16)}var u=Object(p.k)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|bi.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|bi.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|bi.Vertex},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}];this.enableMidpoints&&u.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|bi.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|bi.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|bi.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|bi.Edge});var h=new Gt({view:this.view,renderObjects:u,elevationInfo:a,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(h,e,a);var d="edge"===e.type?{manipulator:h,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:h,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(d),this.manipulators.add(h),this._updateManipulatorPosition(d),"edge"===d.type){var f=this._getManipulatorInfoFromHandle(d.handle.left).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(d)})),b=this._getManipulatorInfoFromHandle(d.handle.right).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(d)}));d.locationUpdateHandle=Object(ot.b)([f,b]),this._manipulatorHandles.add(d.locationUpdateHandle,h)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(h,!0),h);var v=Object(wa.e)(h,(function(e,n,r,o){var c=null;n.next((function(e){return t._trackNumDragging(e)})).next((function(e){if("start"===e.action&&(c=Object(p.s)(t._editGeometryHelper).createUndoGroup()),fi(d)){var a=t._splitEdgeManipulator(d);return Object(i.a)(Object(i.a)({},e),{},{info:a,snapOrigin:a.handle.pos})}return Object(i.a)(Object(i.a)({},e),{},{info:d,snapOrigin:d.handle.pos})})).next(Object(wa.f)(t.view,e.elevationAlignedLocation)).next(Ga(t.view,t.graphic,e.elevationAlignedLocation,e.location.spatialReference,t.graphic)).next(t._snappingPipeline.createSnapDragEventPipelineStep({predicate:function(){return!t.isMultiVertexSelection()},cancel:r,snappingManager:t.tool.snappingManager,snappingContext:new Ka.a({geometry:Object(p.s)(t._editGeometryHelper),elevationInfo:a,pointer:o,excludeFeature:t.graphic,visualizer:new ta.a}),updatingHandles:t.updatingHandles}),t._snappingPipeline.next).next(Object(wa.b)()).next((function(e){t._perVertexManipulatorDragAction(e),"end"===e.action&&(c=Object(p.r)(c))})),r.next(t._cancelDragOperation((function(){return c=Object(p.r)(c)})))}));return this._manipulatorHandles.add(v,h),this._manipulatorHandles.add([h.events.on("immediate-click",(function(e){return t._manipulatorClickCallback(e,d)})),h.events.on("select-changed",(function(){d.selectedIndex=++t._selectedIndex,t._updateMoveManipulationPosition()}))],h),this.emit("manipulators-changed"),d}},{key:"_trackNumDragging",value:function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}},{key:"_cancelDragOperation",value:function(e){var t=this;return function(){switch(t._numDragging--,t.undo(),t.outputGeometry=Object(p.k)(t._editGeometryHelper)?t._editGeometryHelper.geometry:null,Object(p.k)(t.tool.snappingManager)&&t.tool.snappingManager.doneSnapping(),t._reshapeEventState){case 0:break;case 1:t.emit("move",{type:"move",dx:0,dy:0,mover:t.graphic});break;case 2:t.emit("reshape",{type:"reshape",mover:t.graphic})}e&&e(),t.destroyed||t._updateEventState(0)}}},{key:"_setTypeSpecificManipulatorSettings",value:function(e,t,a){switch(t.type){case"vertex":e.state=bi.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=B.reshapeManipulators.vertex.size/2+B.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=a,e.interactive=Object(p.k)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=bi.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=B.reshapeManipulators.edge.size/2+B.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==a.mode||Object(ri.h)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:a}}},{key:"_watchAndUpdateGrabState",value:function(e,t){var a=this;return e.events.on("grab-changed",(function(i){if("start"===i.action)t&&a._updateSelection(e),a._numGrabbing++;else if(a._numGrabbing--,a._updateEventState(0),a.destroyed)return;a._moveManipulation.interactive=!a._numGrabbing}))}},{key:"_clearSelection",value:function(){var e,t=Object(N.a)(this._manipulatorInfos);try{for(t.s();!(e=t.n()).done;){var a=e.value;a.manipulator.grabbing||(a.manipulator.selected=!1)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_updateSelection",value:function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}},{key:"_removeManipulator",value:function(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}},{key:"_getManipulatorInfoFromHandle",value:function(e){if(e){var t,a=Object(N.a)(this._manipulatorInfos);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(e===i.handle)return i}}catch(n){a.e(n)}finally{a.f()}}return null}},{key:"_updateManipulatorPosition",value:function(e){if(e){var t=Object(p.s)(this._editGeometryHelper);if("vertex"===e.handle.type)e.manipulator.location=t.editGeometry.coordinateHelper.toPoint(e.handle.pos,gi),e.manipulator.grabbing&&Object(p.k)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var a=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,i=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if(Object(p.k)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){var n=a.location,r=i.location,o=n.x+.5*(r.x-n.x),c=n.y+.5*(r.y-n.y),s=n.hasZ&&r.hasZ?0:void 0;e.manipulator.location=Object($.g)(o,c,s,t.geometry.spatialReference)}else Object(W.i)(yi,a.renderLocation,i.renderLocation,.5),e.manipulator.renderLocation=yi}}}},{key:"_splitEdgeManipulator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,a=Object(p.s)(this._editGeometryHelper),i=Object(p.s)(a.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var n,r=Object(O.e)(this.graphic);this.enableEdgeOffset?(this._removeManipulator(e),n=this._createVertexOrEdgeManipulator(i)):((n=e).handle=i,n.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r)),i.left&&this._createVertexOrEdgeManipulator(i.left),i.right&&this._createVertexOrEdgeManipulator(i.right),this.outputGeometry=a.geometry,this._updateManipulatorPosition(n),this._updateSelection(e.manipulator);var o=this._updateEventState(2),c=a.editGeometry.coordinateHelper.toArray(n.handle.pos),s=a.editGeometry.components.indexOf(i.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:c,componentIndex:s,vertexIndex:Object(p.s)(i.index)}],added:c}),o&&this._updateEventState(0),n}},{key:"_updateMoveManipulationPosition",value:function(){var e,t=this,a=Object(W.w)(yi,0,0,0),i=0,n=!1,r=null,o=null,c=Object(N.a)(this._manipulatorInfos);try{for(c.s();!(e=c.n()).done;){var s=e.value;pi(s)&&(s.manipulator.selected?(i++,Object(W.f)(a,a,s.manipulator.renderLocation),Object(p.j)(r)||s.selectedIndex>r.selectedIndex?(o=r,r=s):(Object(p.j)(o)||s.selectedIndex>o.selectedIndex)&&(o=s)):n=!0)}}catch(v){c.e(v)}finally{c.f()}if(0!==i){var l=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=l,this._moveManipulation.xyAxisManipulation.available=l,this._moveManipulation.zManipulation.available=l&&this.enableZVertex&&aa(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=l&&1!==i}else{var u=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=u,this._moveManipulation.xyAxisManipulation.available=u,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=u,this._moveManipulation.zManipulation.available=u&&this.enableZShape&&aa(this.graphic)}if(0!==i){var h=0;if(Object(p.k)(r)){var d=r.handle.pos,f=Object(p.k)(o)?o.handle.pos:r.handle.left&&r.handle.left.left?r.handle.left.left.pos:null,b=!Object(p.k)(o)&&r.handle.right&&r.handle.right.right?r.handle.right.right.pos:null;f&&b?this._moveManipulation.xyAxisManipulation.available=!1:f?h=di(f,d):b&&(h=di(d,b))}this._moveManipulation.angle=h,this._moveManipulation.radius=ya}else this._moveManipulation.angleDeferred=function(){return Ia(Object(p.s)(t.graphic.geometry))},this._moveManipulation.radius=Za.radiusForSymbol(this.graphic.symbol);0!==i&&n?(Object(W.e)(a,a,1/i),gi.spatialReference=Object(p.s)(this._editGeometryHelper).geometry.spatialReference,gi.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(a,gi),this._moveManipulation.elevationAlignedLocation=gi):Object(p.k)(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(p.k)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:$t(this.view,this._moveManipulation,this.graphic)}},{key:"_removeVertices",value:function(e){var t,a=[],i=Object(p.s)(this._editGeometryHelper),n=Object(N.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("vertex"===r.handle.type&&i.canRemoveVertex()){a.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.right));var o=Object(p.s)(i.removeVertices([r.handle]).removedVertices[0].createdEdge);o&&this._createVertexOrEdgeManipulator(o)}}}catch(l){n.e(l)}finally{n.f()}if(a.length>0){var c=a.map((function(e){var t=i.editGeometry.components.indexOf(e.component);return{coordinates:i.editGeometry.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:Object(p.s)(e.index)}}));this.outputGeometry=i.geometry;var s=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:c.map((function(e){return e.coordinates})),vertices:c}),this.destroyed)return;if(s&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}},{key:"_moveVertices",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===t.action?0:1,i=Object(p.s)(this._editGeometryHelper);i.moveVertices(e.map((function(e){return e.handle})),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,a),this.outputGeometry=i.geometry;var n,r=Object(N.a)(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;this._updateManipulatorPosition(o)}}catch(c){r.e(c)}finally{r.f()}}},{key:"_offsetEdge",value:function(e,t){if(!Object(p.j)(t.operation)){var a=Object(p.s)(this._editGeometryHelper),i=t.operation.clone();i.distance=t.operation.signedDistanceToPoint(t.mapEnd),a.updateVertices([e.handle.left,e.handle.right],i),this.outputGeometry=a.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.left)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.right))}}},{key:"_manipulatorClickCallback",value:function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),fi(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}}]),a}(h.a.EventedMixin(d.a));function di(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function pi(e){return"vertex"===e.handle.type}function fi(e){return"edge"===e.handle.type}Object(s.a)([Object(b.b)({constructOnly:!0})],hi.prototype,"tool",void 0),Object(s.a)([Object(b.b)()],hi.prototype,"inputGeometry",null),Object(s.a)([Object(b.b)()],hi.prototype,"outputGeometry",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],hi.prototype,"updating",null),hi=Object(s.a)([Object(y.a)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],hi);var bi,vi,gi=Object($.g)(0,0,null,null),yi=Object(Y.e)();(vi=bi||(bi={})).Vertex=16,vi.Edge=32;var mi=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e))._handles=new rt.a,i._reshapeOperation=null,i._internalGeometryUpdate=!1,i.enableZShape=!0,i.enableZVertex=!0,i.enableMoveGraphic=!0,i.enableMidpoints=!0,i.enableEdgeOffset=!1,i.type="reshape-3d",i.snappingManager=null,i}return Object(r.a)(a,[{key:"destroy",value:function(){this._handles.removeAll(),this._reshapeOperation=Object(p.e)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}},{key:"updating",get:function(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}},{key:"selectionManagementDisabled",get:function(){return!0}},{key:"_updateGeometry",value:function(){var e=Object(ii.a)(this.graphic);this._reshapeOperation.inputGeometry=Object(p.k)(e)?e.clone():null}},{key:"_updateGraphic",value:function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===Object(ii.b)(this.graphic)){var t=this.watch("graphic.geometry",(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),!0);this._handles.add(t,"onGraphicGeometryChange")}}},{key:"manipulatorSelectionChanged",value:function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}},{key:"_updateGeometryInternally",value:function(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}},{key:"_onReshapeGeometryChanged",value:function(){Object(p.j)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"initialize",value:function(){var e=this;this._reshapeOperation=new hi({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),this._reshapeOperation.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),this._reshapeOperation.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),this._reshapeOperation.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),this._reshapeOperation.on("immediate-click",(function(t){return e.emit("immediate-click",t)})),this.view.on("pointer-down",["Shift"],(function(e){e.stopPropagation()})),Object(f.a)(this,"graphic",(function(){e._updateGraphic()}),!0)]),this.complete()}},{key:"canUndo",get:function(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canUndo)&&e}},{key:"undo",value:function(){Object(p.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(p.k)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"canRedo",get:function(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canRedo)&&e}},{key:"redo",value:function(){Object(p.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(p.k)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"onInputEvent",value:function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}},{key:"reset",value:function(){}},{key:"test",get:function(){return{snappingManager:this.snappingManager}}}]),a}(h.a.EventedMixin($e.a));Object(s.a)([Object(b.b)()],mi.prototype,"_reshapeOperation",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],mi.prototype,"view",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],mi.prototype,"graphic",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],mi.prototype,"enableZShape",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],mi.prototype,"enableZVertex",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],mi.prototype,"enableMoveGraphic",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],mi.prototype,"enableMidpoints",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],mi.prototype,"enableEdgeOffset",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],mi.prototype,"type",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],mi.prototype,"snappingManager",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],mi.prototype,"updating",null),mi=Object(s.a)([Object(y.a)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],mi);var Oi,ji,_i=a(28),Mi=a(123),wi=a(384);(ji=Oi||(Oi={})).ScaleIn=32,ji.ScaleOut=64,ji.RotateLeft=128,ji.RotateRight=256,ji.Unlocked=1024,ji.DelayedFocused=2048,ji.TouchInput=32768;var ki=function(){function e(t){var a=this;Object(n.a)(this,e),this.mode=null,this._handles=new rt.a,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new h.a,this.getFocused=function(){return a.ringManipulator.focused},this.getScale=function(){return Object(p.k)(a._scaleRotateDragData)&&"scale"===a._scaleRotateDragData.mode?a.adapter.scale:1},this.tool=t.tool,this.mode=t.mode,this.adapter=t.adapter,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}return Object(r.a)(e,[{key:"angle",get:function(){return this.adapter.angle}},{key:"scale",get:function(){return this.adapter.scale}},{key:"location",set:function(e){this.ringManipulator.location=e}},{key:"elevationAlignedLocation",set:function(e){this.ringManipulator.elevationAlignedLocation=e}},{key:"grabbing",get:function(){return this.ringManipulator.grabbing}},{key:"interactive",set:function(e){this.ringManipulator.interactive=e}},{key:"destroy",value:function(){Object(p.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}},{key:"startAnimation",value:function(e){var t=this;this.cancelActiveAnimation(),e.start();var a=Object(Mi.a)({update:function(a){var i=a.deltaTime;e.update(i)&&t.cancelActiveAnimation()}});this._activeAnimation=Object(i.a)(Object(i.a)({},e),{},{frameTask:a})}},{key:"cancelActiveAnimation",value:function(){Object(p.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}},{key:"forEachManipulator",value:function(e){e(this.ringManipulator,4)}},{key:"createManipulator",value:function(){var e=this;this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var t=this.ringManipulator,a=this.tool.graphicState.graphic,i=Object(wa.e)(t,(function(t,i,n){e._scaleRotateDragData=null,e.adapter.restart();var r={mode:"none",origin:Object(Y.c)(t.renderLocation),initialAngle:e.adapter.angle,angle:0,angleDir:0,scaleDir:0};e._scaleRotateDragData=r,e.updateDragState();var o=st.d.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,o),i.next(ka(e.tool.view,Object(jt.g)(t.renderLocation,o,Object(jt.d)()))).next((function(t){var i=Object(jt.r)(t.plane),n=Qt(t.renderStart,t.renderEnd,r.origin,i),o=wi.b.shortestSignedDiff(r.angle,n);r.angleDir=Object(ht.e)(r.angleDir+o,-.3,.3),r.angle=n;var c=function(e,t){var a=Object(W.j)(st.d.get(),t.renderStart,e.origin),i=Object(W.j)(st.d.get(),t.renderEnd,e.origin),n=Object(W.p)(a),r=Object(W.p)(i);return 0===n?0:r/n}(r,t),s=c-e.adapter.scale;if(r.scaleDir=Object(ht.e)(r.scaleDir+s,-.2,.2),e.onScaleChanged(),"none"===r.mode){var l=e.mode||function(e,t,a,i){var n=e.renderStart,r=e.renderEnd,o=Si(n,i,st.d.get()),c=Si(r,i,st.d.get());if(Object(W.l)(o,c)<100)return null;var s=Object(W.j)(st.d.get(),n,a),l=Object(W.g)(st.d.get(),s,Object(jt.r)(t)),u=n,h=Object(W.f)(st.d.get(),u,l),d=Si(a,i,st.d.get()),p=o,f=Si(h,i,st.d.get()),b=Object(W.j)(st.d.get(),f,p),v=Object(W.j)(st.d.get(),o,d),g=Object(_t.g)(p,b),y=Object(_t.g)(d,v);return Object(_t.d)(g,c)<Object(_t.d)(y,c)?"rotate":"scale"}(t,t.plane,r.origin,e.tool.view.state.camera);if(Object(p.k)(l)){switch(l){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:a,angle:0}),e.tool.emit("record-undo",{record:e.adapter.createUndoRecord()});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:a,xScale:1,yScale:1}),e.tool.emit("record-undo",{record:e.adapter.createUndoRecord()})}r.mode=l}}switch(r.mode){case"rotate":e.adapter.angle=r.initialAngle+n;break;case"scale":e.adapter.scale=c,e.onScaleChanged()}switch(e.updateDragState(),e.updateManipulatorTransform(),t.action){case"start":case"update":switch(r.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:a,angle:Object(ht.q)(r.angle)});break;case"scale":e.tool.emit("graphic-scale",{graphic:a,xScale:c,yScale:c})}break;case"end":switch(r.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:a,angle:Object(ht.q)(r.angle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:a,xScale:c,yScale:c});break;default:case"none":}}"end"===t.action&&(e.startAnimation(xi(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState())})),n.next((function(){if(e.adapter.cancel(),Object(p.k)(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:a,angle:0});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:a,xScale:1,yScale:1})}e.startAnimation(xi(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState()}}))}));this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",(function(t){"focus"===t.action?e.startAnimation(function(e,t){var a=0,i=null,n=function(){return!1};return{start:function(){i=e.getFocused,e.getFocused=n,a=0,t()},update:function(e){return a+=e,!i()||a>200?1:0},destroy:function(){e.getFocused=i,t()}}}(e,(function(){return e.updateDelayedFocusedState()}))):e.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(function(e){e.stopPropagation()})),Object(f.a)(this.tool.graphicState,"displaying",(function(t){return e.ringManipulator.available=t}))])}},{key:"onScaleChanged",value:function(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}},{key:"updateDelayedFocusedState",value:function(){this.ringManipulator.updateStateEnabled(Oi.DelayedFocused,this.getFocused())}},{key:"updateDragState",value:function(){if(this.ringManipulator.updateStateEnabled(Oi.Unlocked,!(Object(p.k)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(p.k)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Oi.ScaleIn|Oi.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Oi.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Oi.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Oi.RotateLeft|Oi.RotateRight,!1),this.ringManipulator.updateStateEnabled(Oi.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Oi.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Oi.ScaleIn|Oi.ScaleOut|Oi.RotateLeft|Oi.RotateRight,!1)}},{key:"updateManipulatorTransform",value:function(){var e=Object(ct.i)(st.a.get()),t=this.adapter.angle;Object(ct.c)(e,e,t,Object(Y.g)(0,0,1));var a=this.getScale(),i=Object(ct.u)(st.a.get(),Object(W.w)(st.d.get(),a,a,a)),n=Object(ct.i)(st.a.get());Object(ct.m)(n,i,e),this.ringManipulator.modelTransform=n}},{key:"createRingManipulator",value:function(){for(var e=function(e,t,a){for(var i=[],n=Math.ceil(128*(t-e)/(2*Math.PI)),r=0;r<n+1;r++){var o=e+r*(t-e)/n;i.push(Object(Y.g)(a*Math.cos(o),a*Math.sin(o),0))}return i},t=function(t){return e(0,2*Math.PI,t)},a=function(e,t){return ye.a.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]]}(t),e,[],[],!1)},i=t(ma),n=a(i,24),r={left:[],right:[]},o=[],c=0;c<2;c++){var s=c*Math.PI-Math.PI/4,l=Math.PI/2-Oa,u=s+l,h=s+Math.PI/2-l,d=e(u,h,190),p=a(d,9);o.push(d),o.push(e(u,h,201)),r.left.push(p),r.right.push(p);for(var f=0;f<2;f++){var b=0===f,v=Object(vt.d)();if(b){Object(ct.s)(v,v,[1,-1,1]),Object(ct.c)(v,v,-u,[0,0,1]);var g=Math.round(.2*(d.length-1));v[12]=d[g][0],v[13]=d[g][1],v[14]=d[g][2]}else{Object(ct.c)(v,v,h,[0,0,1]);var y=Math.round(.8*(d.length-1));v[12]=d[y][0],v[13]=d[y][1],v[14]=d[y][2]}var m=ye.a.createExtrudedTriangle(60,0,23,.5);ye.a.transformInPlace(m,v),(b?r.left:r.right).push(m)}}for(var j=[],_=0;_<2;_++){var M=_*Math.PI-Math.PI/4,w=Math.PI/2-ja,k=M+w,S=M+Math.PI/2-w,x=e(k,S,213);j.push(a(x,9))}var E=t(190),D=t(213),G=a(E,9),A=a(D,9),R=t(130),P=t(107),C=a(R,9),T=a(P,9),z=this.createMaterial(),I=this.createMaterial(.66),V=this.createMaterial(.5),H=this.createMaterial(.33),L=[{geometry:n,material:z,stateMask:Oi.DelayedFocused},{geometry:n,material:V,stateMask:0}];this.mode&&"scale"!==this.mode||(L=L.concat([{geometry:j,material:z,stateMask:Oi.DelayedFocused|Oi.Unlocked},{geometry:G,material:I,stateMask:Oi.DelayedFocused|Oi.ScaleIn},{geometry:A,material:H,stateMask:Oi.DelayedFocused|Oi.ScaleIn},{geometry:C,material:I,stateMask:Oi.DelayedFocused|Oi.ScaleOut},{geometry:T,material:H,stateMask:Oi.DelayedFocused|Oi.ScaleOut}])),this.mode&&"rotate"!==this.mode||(L=L.concat([{geometry:r.right,material:z,stateMask:Oi.DelayedFocused|Oi.Unlocked},{geometry:r.left,material:z,stateMask:Oi.DelayedFocused|Oi.RotateLeft},{geometry:r.right,material:z,stateMask:Oi.DelayedFocused|Oi.RotateRight}]));var F=[i].concat(o);return new Gt({view:this.tool.view,renderObjects:L,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(O.e)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:F,direction:Object(Y.g)(0,0,1)}})}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[].concat(Object(_i.a)(va),[e]);return new Wt.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{ringManipulator:this.ringManipulator}}}]),e}();function Si(e,t,a){return t.projectToScreen(e,Ei),Object(W.w)(a,Ei[0],Ei[1],0)}function xi(e,t){var a=null,i=1,n=function(){return i};return{start:function(){i=e.getScale(),a=e.getScale,e.getScale=n,t()},update:function(e){return i+=((i+1)/2-i)*Math.min(3*e,1),t(),Math.abs(i-1)<.01?1:0},destroy:function(){e.getScale=a,t()}}}var Ei=Object(dt.f)(),Di=a(273),Gi=a(770);function Ai(e){return Object(p.k)(e.geometry)&&"mesh"===e.geometry.type?function(e){return Object(p.k)(e.transform)?function(e,t){var a=t.clone(),i=null;return{undo:function(t){i=Object(p.k)(e.transform)?e.transform.clone():null,e.transform=a,t.notifyGeometryChanged()},redo:function(t){a=Object(p.k)(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()}}}(e,e.transform):function(e){var t,a=e.vertexAttributes.clonePositional();return{undo:function(i){t=e.vertexAttributes.clonePositional(),e.vertexAttributes=a,i.notifyGeometryChanged()},redo:function(i){a=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,i.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){var t=e.geometry,a=p.o;return{undo:function(e){a=e.geometry,e.geometry=t},redo:function(e){t=e.geometry,e.geometry=a}}}(e)}var Ri=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).angle=0,i.scale=1,i.initialAngle=0,i.previousAngle=0,i.previousScale=1,i}return Object(r.a)(a,[{key:"initialize",value:function(){this.restart()}},{key:"restart",value:function(){var e=this;this.handles.remove(Pi);var t=this.geometry.transform;if(this.scale=1,Object(p.k)(t)){var a=Object(Gi.c)(t.rotation)[2];Math.abs(a)>.999999&&(this.angle=Object(ht.g)(Object(Gi.a)(t.rotation))*Math.sign(a))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(Object(Di.b)((function(){return{angle:e.angle,scale:e.scale}}),(function(t){return e.update(t)})),Pi)}},{key:"cancel",value:function(){this.scale=1,this.angle=this.initialAngle}},{key:"createUndoRecord",value:function(){return Ai(this.graphic)}},{key:"update",value:function(e){var t=e.scale,a=e.angle,i=this.geometry.anchor,n=1===this.viewingMode;t!==this.previousScale&&(this.geometry.scale(t/this.previousScale,{origin:i,geographic:n}),this.previousScale=t,this.graphic.notifyGeometryChanged()),a!==this.previousAngle&&(this.geometry.rotate(0,0,Object(ht.q)(a-this.previousAngle),{origin:i,geographic:n}),this.previousAngle=a,this.graphic.notifyGeometryChanged())}}]),a}(d.a);Object(s.a)([Object(b.b)({constructOnly:!0})],Ri.prototype,"graphic",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],Ri.prototype,"geometry",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],Ri.prototype,"viewingMode",void 0),Object(s.a)([Object(b.b)()],Ri.prototype,"angle",void 0),Object(s.a)([Object(b.b)()],Ri.prototype,"scale",void 0),Ri=Object(s.a)([Object(y.a)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Ri);var Pi="scale-heading-update-key",Ci=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).angle=0,i.scale=1,i.symbol=null,i.initialAngle=0,i}return Object(r.a)(a,[{key:"initialize",value:function(){this.restart()}},{key:"restart",value:function(){var e=this;this.handles.remove(Ti);var t=Object(p.k)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:p.o;if(this.symbol=Object(p.k)(t)?t.clone():null,this.initialSizes=[],Object(p.k)(t)){var a=this.findLayerView();Object(p.k)(a)&&(this.initialSizes=t.symbolLayers.map((function(e){return"object"===e.type?a.getSymbolLayerSize(t,e):null})).toArray())}this.angle=0,Object(p.k)(t)&&t.symbolLayers.some((function(t){return!("object"!==t.type||!Object(p.k)(t.heading))&&(e.angle=-Object(ht.g)(t.heading),!0)})),this.initialAngle=this.angle,this.scale=1,this.handles.add(Object(Di.b)((function(){return{angle:e.angle,scale:e.scale}}),(function(t){return e.updateSymbol(t)})),Ti)}},{key:"cancel",value:function(){this.graphic.symbol=this.symbol}},{key:"createUndoRecord",value:function(){var e=this,t=this.graphic.symbol,a=null;return{undo:function(i){a=i.symbol,i.symbol=t,e.restart()},redo:function(i){t=i.symbol,i.symbol=a,e.restart()}}}},{key:"updateSymbol",value:function(e){var t=this,a=e.scale,i=e.angle,n=this.graphic.symbol;if(!Object(p.j)(this.symbol)&&!Object(p.j)(n)&&"point-3d"===n.type){var r=n.clone(),o=-Object(ht.q)(i-this.initialAngle),c=!1;this.forEachObjectSymbolLayerPair(this.symbol,r,(function(e,i,n){var r=Object(p.t)(e.heading,0)+o;i.heading!==r&&(i.heading=r,c=!0);var s=t.initialSizes[n];if(Object(p.k)(s)&&"width"in s){s.width=t.sizeFilter(s.width),s.height=t.sizeFilter(s.height),s.depth=t.sizeFilter(s.depth);var l=s.width*a;i.width!==l&&(i.width=l,c=!0);var u=s.depth*a;i.depth!==u&&(i.depth=u,c=!0);var h=s.height*a;i.height!==h&&(i.height=h,c=!0)}})),c&&(this.graphic.symbol=r)}}},{key:"forEachObjectSymbolLayerPair",value:function(e,t,a){e.symbolLayers.forEach((function(e,i){var n=t.symbolLayers.getItemAt(i);"object"===e.type&&"object"===n.type&&a(e,n,i)}))}}]),a}(d.a);Object(s.a)([Object(b.b)()],Ci.prototype,"angle",void 0),Object(s.a)([Object(b.b)()],Ci.prototype,"scale",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],Ci.prototype,"graphic",void 0),Object(s.a)([Object(b.b)()],Ci.prototype,"symbol",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],Ci.prototype,"findLayerView",void 0),Object(s.a)([Object(b.b)({constructOnly:!0})],Ci.prototype,"sizeFilter",void 0),Ci=Object(s.a)([Object(y.a)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Ci);var Ti="scale-heading-update-key",zi=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i.type="transform-3d",i.scaleRotate=null,i.snappingPipeline=new ea.a,i}return Object(r.a)(a,[{key:"initialize",value:function(){var e=this;this.graphicState=new Qe({graphic:this.graphic}),this.moveManipulation=new Za({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&aa(this.graphic),radius:Za.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((function(t){return e.handles.add(t.events.on("immediate-click",(function(t){e.emit("immediate-click",Object(i.a)(Object(i.a)({},t),{},{graphic:e.graphicState.graphic})),t.stopPropagation()})))})),this.moveManipulation.elevationInfo=Object(O.e)(this.graphic);var t=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline((function(a,i,n,r,o){return Object(p.k)(t)&&0===a&&(n=n.next(e.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Ka.a({elevationInfo:Object(O.e)(e.graphic),pointer:o,geometry:Qa.a.fromGeometry(new Dt.a({spatialReference:t.spatialReference}),e.view.viewingMode),visualizer:new ta.a,excludeFeature:e.graphic}),snappingManager:e.snappingManager,updatingHandles:e.updatingHandles,cancel:r}),e.snappingPipeline.next)),n}),this.graphicState,(function(t){var a=t.action,i={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(a){case"start":e.emit("graphic-translate-start",i),e.emit("record-undo",{record:e.createGeometryUndoRecord()});break;case"update":e.emit("graphic-translate",i);break;case"end":e.emit("graphic-translate-stop",i)}})),this.moveManipulation.angle=Object(p.k)(this.scaleRotate)?this.scaleRotate.angle:0,this.scaleRotateAdapter=this.createScaleRotateAdapter(),this.handles.add(this.scaleRotateAdapter.watch("angle",(function(){return e.updateMoveAngle()}))),this.enableScaling||this.enableRotation){var a=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new ki({tool:this,mode:a,adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",(function(){return e.onScaleChanged()})))}this.handles.add([ba({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return Object(ot.c)()}}),this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(function(){return e.updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged(),this.updateMoveAngle(),this.forEachManipulator((function(t){t instanceof Gt&&e.handles.add(t.events.on("grab-changed",(function(){return e.updateManipulatorsInteractive()})))})),this.complete()}},{key:"updateManipulatorsInteractive",value:function(){Object(p.j)(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)}},{key:"createScaleRotateAdapter",value:function(){var e=this;return Object(p.k)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Ri({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Ci({graphic:this.graphic,sizeFilter:function(t){return e.enforceNonZeroSize(t)},findLayerView:function(){return e.view.allLayerViews.find((function(t){return t.layer===e.graphic.layer}))}})}},{key:"forEachManipulator",value:function(e){this.moveManipulation.forEachManipulator(e),Object(p.k)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}},{key:"hideManipulatorsForGraphicState",value:function(){var e=this;return this.graphicState.watch("displaying",(function(t){e.forEachManipulator((function(e){return e.available=t})),e.moveManipulation.zManipulation.available=t&&e.enableZ&&aa(e.graphic)}))}},{key:"createGeometryUndoRecord",value:function(){return Ai(this.graphic)}},{key:"destroy",value:function(){this.moveManipulation.destroy(),this.scaleRotate=Object(p.e)(this.scaleRotate),this.scaleRotateAdapter=Object(p.e)(this.scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}},{key:"snapToScene",set:function(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"location",set:function(e){this.moveManipulation.location=e,Object(p.k)(this.scaleRotate)&&(this.scaleRotate.location=e)}},{key:"elevationAlignedLocation",set:function(e){this.moveManipulation.elevationAlignedLocation=e,Object(p.k)(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=e)}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){Object(p.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onHide",value:function(){Object(p.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onScaleChanged",value:function(){if(!Object(p.j)(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}}},{key:"updateMoveAngle",value:function(){"local"===this.view.viewingMode||this.view.scale<1e6?this.moveManipulation.angle=this.scaleRotateAdapter.angle:this.moveManipulation.angle=0}},{key:"onGeometryChanged",value:function(){$t(this.view,this,this.graphic)}},{key:"enforceNonZeroSize",value:function(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)}},{key:"test",get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:Object(p.k)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}}]),a}(Object(d.b)(h.a.EventedMixin($e.a)));Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],zi.prototype,"view",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],zi.prototype,"graphic",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],zi.prototype,"enableZ",void 0),Object(s.a)([Object(b.b)()],zi.prototype,"enableRotation",void 0),Object(s.a)([Object(b.b)()],zi.prototype,"enableScaling",void 0),Object(s.a)([Object(b.b)({value:!1})],zi.prototype,"snapToScene",null),Object(s.a)([Object(b.b)({constructOnly:!0})],zi.prototype,"snappingManager",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],zi.prototype,"type",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],zi.prototype,"updating",null),zi=Object(s.a)([Object(y.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],zi);var Ii=a(61),Vi=a(47),Hi=a(797),Li=(a(24),a(480)),Fi=(Object(u.a)("mac"),Math.cos(Object(ht.g)(45)),Math.cos(Object(ht.g)(5)),[1,.5,0]),Ui=([].concat(Fi,[.7]),[].concat(Fi,[.5]),[].concat(Fi,[1])),Bi=[1,1,1,1],qi=[1,.8,.6,1],Zi=[1,.93,.86,1],Ni=[].concat(Fi,[1]),Wi=[].concat(Fi,[1]),Yi=40,Xi=(ve.a,Object(vt.d)()),Qi=a(571),Ki=a(484),Ji=a(214),$i=a(903),en=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get().build();return new Ce.a(e.rctx,t,Ji.a)}},{key:"bindPass",value:function(e,t){Object(De.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth)}},{key:"bindDraw",value:function(e){Object(De.d)(this.program,e),this.program.rebindTextures()}},{key:"initializePipeline",value:function(){return Object(ze.f)({blending:Object(ze.g)(1,1,771,771),depthTest:{func:513},colorWrite:ze.c})}}]),a}(Ae.a);en.shader=new Ge.a($i.a,(function(){return a.e(209).then(a.bind(null,1168))}));var tn=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){return Object(n.a)(this,a),t.call(this,e,nn)}return Object(r.a)(a,[{key:"intersect",value:function(e,t,a,i,n,r,o){return Object(ke.f)(e,t,i,n,r,void 0,o)}},{key:"createBufferWriter",value:function(){return new Ki.a(Ki.d)}},{key:"getGLMaterial",value:function(e){return 0===e.output?new an(e):void 0}}]),a}(_e.a),an=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e))._technique=new en(i._techniqueRep.constructionContext,null),i.updateParameters(),i}return Object(r.a)(a,[{key:"updateParameters",value:function(){}},{key:"beginSlot",value:function(e){return 8===e}},{key:"bind",value:function(e){this._technique.bindPass(this._material.params,e)}}]),a}(je.a);Object(s.a)([Object(Qi.c)()],an.prototype,"_technique",void 0);var nn=Object(i.a)({backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4},_e.b),rn=(ve.a,a(158)),on=a(574),cn=a(168),sn=a(904),ln=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get(),i=this.configuration,n=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new Ce.a(e.rctx,n,Ji.a)}},{key:"bindPass",value:function(e,t){Object(De.c)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("opacity",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Ee.a)(this.program,t))}},{key:"bindDraw",value:function(e){Object(De.d)(this.program,e),Object(xe.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e,t){var a=this.configuration,i=3===e,n=2===e;return Object(ze.f)({blending:0!==a.output&&7!==a.output||!a.transparent?null:i?un:Object(Pe.a)(e),culling:Object(ze.b)(a.cullFace),depthTest:{func:Object(Pe.b)(e)},depthWrite:i?a.writeDepth&&ze.d:Object(Pe.c)(e),colorWrite:ze.c,stencilWrite:a.sceneHasOcludees?cn.h:null,stencilTest:a.sceneHasOcludees?t?cn.d:cn.c:null,polygonOffset:i||n?null:Object(Pe.g)(a.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),a}(Ae.a);ln.shader=new Ge.a(sn.a,(function(){return a.e(200).then(a.bind(null,1169))}));var un=Object(ze.h)(1,771),hn=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(){var e;return Object(n.a)(this,a),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return a}(Re.a);Object(s.a)([Object(Re.b)({count:8})],hn.prototype,"output",void 0),Object(s.a)([Object(Re.b)({count:3})],hn.prototype,"cullFace",void 0),Object(s.a)([Object(Re.b)()],hn.prototype,"slicePlaneEnabled",void 0),Object(s.a)([Object(Re.b)()],hn.prototype,"transparent",void 0),Object(s.a)([Object(Re.b)()],hn.prototype,"enableOffset",void 0),Object(s.a)([Object(Re.b)()],hn.prototype,"writeDepth",void 0),Object(s.a)([Object(Re.b)()],hn.prototype,"sceneHasOcludees",void 0),Object(s.a)([Object(Re.b)({count:4})],hn.prototype,"transparencyPassType",void 0),Object(s.a)([Object(Re.b)()],hn.prototype,"multipassTerrainEnabled",void 0),Object(s.a)([Object(Re.b)()],hn.prototype,"cullAboveGround",void 0);var dn,pn=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e,bn)).supportsEdges=!0,i.techniqueConfig=new hn,i}return Object(r.a)(a,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<Pe.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,a,i,n,r,o){Object(ke.f)(e,t,i,n,r,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new fn(e):void 0}},{key:"createBufferWriter",value:function(){return new Ki.a(Ki.d)}}]),a}(_e.a),fn=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var r;return Object(n.a)(this,a),(r=t.call(this,Object(i.a)(Object(i.a)({},e),e.material.params))).updateParameters(),r}return Object(r.a)(a,[{key:"updateParameters",value:function(e){var t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(ln,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){return 4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(t)}}]),a}(on.a),bn=Object(i.a)({transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0},_e.b),vn=a(936),gn=a(21),yn=a(20),mn=a(52),On=a(861),jn=dn=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).type="plane",i.position=null,i.heading=0,i.tilt=0,i.width=10,i.height=10,i}return Object(r.a)(a,[{key:"clone",value:function(){return new dn({position:Object(yn.a)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}},{key:"equals",value:function(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(p.k)(this.position)&&Object(p.k)(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}}]),a}(gn.a);Object(s.a)([Object(b.b)({readOnly:!0,json:{read:!1,write:!0}})],jn.prototype,"type",void 0),Object(s.a)([Object(b.b)({type:Dt.a}),Object(On.a)()],jn.prototype,"position",void 0),Object(s.a)([Object(b.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(On.a)(),Object(mn.a)((function(e){return wi.a.normalize(Object(v.i)(e),0,!0)}))],jn.prototype,"heading",void 0),Object(s.a)([Object(b.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(On.a)(),Object(mn.a)((function(e){return wi.a.normalize(Object(v.i)(e),0,!0)}))],jn.prototype,"tilt",void 0),Object(s.a)([Object(b.b)({type:Number,nonNullable:!0}),Object(On.a)()],jn.prototype,"width",void 0),Object(s.a)([Object(b.b)({type:Number,nonNullable:!0}),Object(On.a)()],jn.prototype,"height",void 0);jn=dn=Object(s.a)([Object(y.a)("esri.widgets.Slice.SlicePlane")],jn),g.a.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function _n(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:Object(W.f)(st.d.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:Object(W.f)(st.d.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:Object(W.j)(st.d.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:Object(W.j)(st.d.get(),e.origin,e.basis2),edge:t}}}function Mn(e){var t=Object(W.p)(e.basis1),a=Object(W.p)(e.basis2);return.3*Math.min(t,a)}function wn(e){return Mn(e)}function kn(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Sn(e,t){var a=kn(t),i=a?[Object(Y.g)(1,0,0),Object(Y.g)(0,0,0),Object(Y.g)(0,1,0)]:[Object(Y.g)(1,0,0),Object(Y.g)(-1,0,0)],n=ye.a.createPolylineGeometry(i),r=[].concat(Object(_i.a)(Fi),[1]),o=a?4:1,c=2*o,s=function(e){return e>1?function(e){return new he.a({color:r,width:e,renderOccluded:4})}(e):new vn.a({color:r,renderOccluded:4})},l=[{geometry:n,material:s(o),stateMask:1|Cn},{geometry:n,material:s(c),stateMask:2|Cn},{geometry:n,material:s(1),stateMask:Tn}],u=new Gt({view:e,renderObjects:l,collisionType:{type:"line",paths:[i]},autoScaleRenderObjects:!1,worldSized:!0,radius:a?6:4,idHint:a?1:2});return u.state=Cn,u}function xn(e,t,a){var i=function(i){var n=(i?t:e).slice(0),r=Object(W.j)(st.d.get(),n[0],n[1]);Object(W.r)(r,r);var o=Object(W.j)(st.d.get(),n[n.length-1],n[n.length-2]);if(Object(W.r)(o,o),a.padding>0){var c=Object(W.e)(Object(Y.e)(),o,-a.padding);if(n[n.length-1]=Object(W.f)(c,c,n[n.length-1]),a.bothEnds){var s=Object(W.e)(Object(Y.e)(),r,-a.padding);n[0]=Object(W.f)(s,s,n[0])}}var l=i?a.tipFocusMultiplier:1,u=a.tipLength*(a.focusTipLength?l:1),h=a.tipRadius*l,d=Object(ct.i)(st.a.get());if(a.padding>0){var f=u/4,b=Object(W.w)(st.d.get(),0,f,0),v=1+a.padding/f;Object(ct.t)(d,d,b),Object(ct.s)(d,d,Object(W.w)(st.d.get(),v,v,v)),Object(ct.t)(d,d,Object(W.e)(b,b,-1/v))}var g=Object(ct.i)(Object(vt.d)()),y=Object(Y.g)(0,1,0),m=Object(ct.v)(Object(vt.d)(),Object(Li.g)(st.b.get(),y,o));m[12]=n[n.length-1][0],m[13]=n[n.length-1][1],m[14]=n[n.length-1][2],Object(ct.m)(m,m,d);var O,j,_=[{part:"tube",geometry:En(a.tubeRadius*(i?a.tubeFocusMultiplier:1)+a.padding,a.flat,n),transform:g}];if(Object(p.k)(a.flat)?O=ye.a.createExtrudedTriangle(u,h,h,a.flat.thickness):(O=ye.a.createConeGeometry(u,h,24,!1,!1,!0),j=ye.a.createConeGeometry(u,h,24,!1,!0,!1)),_.push({part:"tip",geometry:O,transform:m}),j&&_.push({part:"cap",geometry:j,transform:m}),a.bothEnds){var M=Object(ct.v)(Object(vt.d)(),Object(Li.g)(st.b.get(),y,r));M[12]=n[0][0],M[13]=n[0][1],M[14]=n[0][2],Object(ct.m)(M,M,d),_.push({part:"tip",geometry:O,transform:M}),j&&_.push({part:"cap",geometry:j,transform:M})}return _};return{normal:i(!1),focused:i(!0)}}function En(e,t,a){var i=[];if(Object(p.k)(t))i.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else for(var n=0;n<12;n++){var r=n/12*2*Math.PI;i.push([Math.cos(r)*e,Math.sin(r)*e])}return ye.a.createPathExtrusionGeometry(i,a,[],[],!1)}function Dn(e,t){var a=Object(W.j)(Object(Y.e)(),e[e.length-1],e[e.length-2]);if(Object(W.r)(a,a),Object(W.e)(a,a,12),Object(W.f)(a,a,e[e.length-1]),t){var i=Object(W.j)(Object(Y.e)(),e[0],e[1]);return Object(W.r)(i,i),Object(W.e)(i,i,12),Object(W.f)(i,i,e[0]),[i].concat(Object(_i.a)(e),[a])}return[].concat(Object(_i.a)(e),[a])}function Gn(e,t){return Object(Ma.b)(t,e.basis2,e.basis1)+Pn}var An=16,Rn=32,Pn=(Object(_t.c)(),Math.PI/2),Cn=16,Tn=32,zn=function(){function e(){Object(n.a)(this,e),this.lastDragEvent=null,this.next=new wa.a,this._enabled=!1}return Object(r.a)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&Object(p.k)(this.lastDragEvent)){var t=Object(i.a)(Object(i.a)({},this.lastDragEvent),{},{action:"update"});e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;return this.lastDragEvent=null,function(t){return e.lastDragEvent="end"!==t.action?Object(i.a)({},t):null,e._enabled&&e.adjustScaleFactors(t),t}}},{key:"adjustScaleFactors",value:function(e){var t=kn(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}},{key:"test",get:function(){var e=this;return{adjustScaleFactors:function(t){return e.adjustScaleFactors(t)}}}}]),e}(),In=a(538),Vn=a(596),Hn=a(598),Ln=a(599),Fn=a(246);function Un(e,t){return qn(e,t,!1)}function Bn(e,t){return qn(e,t,!0)}function qn(e,t,a){if(e instanceof Fn.b){if(e.operation instanceof Vn.a)return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-1:1,i=Object(Y.g)(a*e.dx,a*e.dy,a*e.dz);Object(W.f)(t.origin,t.origin,i)}(e.operation,t,a),!0;if(e.operation instanceof Hn.a)return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-e.angle:e.angle;Object(W.d)(t.basis1,t.basis1,Y.b,a),Object(W.d)(t.basis2,t.basis2,Y.b,a)}(e.operation,t,a),!0;if(e.operation instanceof Ln.a)return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=a?1/e.factor1:e.factor1,n=a?1/e.factor2:e.factor2;Object(W.e)(t.basis1,t.basis1,i),Object(W.e)(t.basis2,t.basis2,n),Zn(t.origin,e.origin,e.axis1,i),Zn(t.origin,e.origin,e.axis2,n)}(e.operation,t,a),!0}return!1}function Zn(e,t,a,i){var n=st.c.get(),r=Object(gt.a)(n,e,t),o=Object(gt.b)(n,a,Object(gt.h)(a,r));Object(gt.p)(e,e,o,i-1)}var Nn=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i._preserveAspectRatio=new zn,i.grabbing=!1,i.inputState=null,i.type="transform-3d",i.handles=new rt.a,i.moveZManipulator=null,i.resizeManipulators=null,i.rotateManipulator=null,i.attachmentOrigin=null,i.outlineVisualElement=null,i.mapBounds=Object(Hi.a)(),i.mapBoundsStart=Object(Hi.a)(),i.displayBounds=Object(Hi.a)(),i.displayBoundsStart=Object(Hi.a)(),i.displayBoundsMarginStart=0,i.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],i}return Object(r.a)(a,[{key:"initialize",value:function(){var e=this;this.graphicState=new Qe({graphic:this.graphic});var t=this.graphic.geometry;this.editGeometryHelper=Qa.a.fromGeometry(t,this.view.viewingMode),this.graphicMoveManipulation=new Ya({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=function(e){var t=0===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)?Yi:0,a=[Object(Y.g)(t,0,-24),Object(Y.g)(t,0,24)],i=Dn(a,!0),n=function(e,t){return xn(a,a,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t})},r=n(0,!1),o=n(2.25,!0),c=new Wt.a({color:Bi,cullFace:2,renderOccluded:16}),s=new Wt.a({color:qi,cullFace:2,renderOccluded:16}),l=new Wt.a({color:Zi,cullFace:2,renderOccluded:16}),u=new Wt.a({color:Wi,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),h=ye.a.createPolylineGeometry([[t,0,0],[t-Yi,0,0]]),d=ye.a.createPolylineGeometry([[t,0,0],[t-Yi,0,0]]),p=new vn.a({color:Ni,renderOccluded:4});return new Gt({view:e,renderObjects:[].concat(Object(_i.a)(r.normal.map((function(e){var t=e.part,a=e.geometry,i=e.transform;return{geometry:a,material:"tip"===t?c:"cap"===t?s:l,transform:i,stateMask:1|An}}))),Object(_i.a)(o.normal.map((function(e){var t=e.geometry,a=e.transform;return{geometry:t,material:u,transform:a,stateMask:1|An}}))),[{geometry:h,material:p,stateMask:1|An|Rn}],Object(_i.a)(r.focused.map((function(e){var t=e.part,a=e.geometry,i=e.transform;return{geometry:a,material:"tip"===t?c:"cap"===t?s:l,transform:i,stateMask:2|An}}))),Object(_i.a)(o.focused.map((function(e){var t=e.geometry,a=e.transform;return{geometry:t,material:u,transform:a,stateMask:2|An}}))),[{geometry:d,material:p,stateMask:2|An|Rn}]),autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[i]},collisionPriority:1,radius:11,state:An})}(this.view,0),this.moveZManipulator.state|=Rn,this.handles.add(this.watch("enableZ",(function(){return e.updateManipulatorAvailability(e.moveZManipulator,0)}))),this.handles.add(this._createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((function(t){var a=Sn(e.view,t);return e.handles.add(e.watch("enableScaling",(function(){return e.updateManipulatorAvailability(a,2)}))),a.events.on("grab-changed",(function(t){return e._onResizeGrab(t)})),e.handles.add(e._createResizeDragPipeline(a,t)),a})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new In.a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACuFBMVEUAAAD/AAD/gAD/VQD/gAD/bQD/gAD/cQD/gAD/dAD/eAD/gAD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fQD/gAD/fQD/fQD/egD/fQD/gAD/fQD/ewD/fQD/gAD/gAD/fQD/fAD/gAD/fgD/fgD/fAD/fgD/fAD/fgD/fAD/fgD/fAD/gAD/fgD/fAD/fQD/fgD/fgD/fQD/fgD/fgD/fQD/fgD/fQD/fQD/fgD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fgD/fgD/gAL/gAT/gAb/gQj/gwr/hAz/hA7/hxH/iBP/iRf/ixn/jBz/jR7/jyP/kCX/kyr/lCz/lS7/li//mTT/mTf/mjn/nDr/nTz/nT//n0H/oEL/oET/oEX/okf/o0r/o0v/pU3/pU//plH/qFL/qFP/qFX/qVb/q1n/rFz/rV3/rl7/rmD/rmH/sGL/s2v/tW3/tW7/tW//tnD/t3L/uHT/unb/unf/unn/vHv/vX3/vX7/v4D/w4n/xIv/xY3/xY3/x4//x5H/x5H/yZP/yJP/yZX/y5f/y5n/zZv/zJv/zZ3/z5//z6D/z6H/0KP/0aT/0qb/06j/06r/1av/1q3/1q//17H/2rb/2rb/2rj/3bz/38D/4MH/38H/4MT/4sX/4sb/48f/4sf/5Mr/5cz/5s3/5s3/59D/59D/6dP/6dT/6dT/6tX/6tb/6tf/69j/69n/7Nn/7dr/7dv/7dz/7t3/7t3/7t7/7+H/8eL/8eP/8uX/8+f/8+j/8+j/9On/9Or/9ez/9ez/9e3/9e3/9+7/9+//9+//+PD/+PD/+PH/+PH/+fL/+fT/+fT/+vX/+vX/+vb/+vb/+/b/+/j/+/j//Pn//Pr//fv//fv//fz//vz//v3//fz//v3//v3//v7///////9yfVyKAAAA53RSTlMAAQIDBgcICQoLERIYGRobKCkqKywtLzAxMjM4OTo+P0BAQUVGR0hPUFFSUlNUWlthYmNlZmdoamtvcHR1dnd4eXx9f4CAgYGCgoODhIWGhoeIiYqLjIyNjo+QkJGSkpOTlJSVlpaXmJiZmZqbnJydnZ6eoqKjo6Skpaanp6ipqqqvsLCxsbKzs7S1tbe3uLi5uru8vL2+wMDBwsTGx8jLzc3O0NDR0dLT1dXW19ja2tvc3N3e3t/f4ODh4uLl5ufn6urr6+zt7u7v8PDx8fLy8/P09fX29vf3+Pn6+vv8/Pz8/f3+/v7EBDCzAAADsUlEQVQYGZXBiUMUZRgH4JfW5fRosegCVoG10lVRgWUNBt39IUKSmAZdYpeVZYdm2Z2VpdGhkZ0WqWVSGVlWdtJNKWaUBZUlpcj7b7TfLDvfN8ssO/M8lEhG9oSppUEtFNKCpX5vdgY5Ms4XCMMkHPCNJZvceeWwVJ7npuTSCjQkpE1MoyRyKjAi7awUGkHWTCQ1I4sS8lTBhjmnkLWUSbDJl0IWXH7Y5nfRMK7pGNKI5Ka5KN65iPlwNZLzp5DZJMQsH/xyHpIrIpPxMLzOvB7C1Y+3dXR2ftHx8qPLYeFUUmRVIaapn/nXBixt289S19ZmxKvKJGkmDC9xxLb2ATYb2NmMOMVkOAOG+t854r9/eZjjz9fA7DQaklYJQwvrutjCJxfDpCKVogpgqP6Oo/5g3c89fYNsOLgUJl7SuTUY7uEhPcyft16/AMAFK7d08pBDy6DS3CTkQdrHMR+vhHTz+xz1YwNUuSQEYFjBhr7FUK3rY91bUJVTxDhIb7D0Kkyau1m3HqoxROSDoamfpYFrYXJZNws99VAUEVEAhmWb2978rPsYR+2D2Y39LDwDRRlRRhhxqi+64e6WF1/b+81amLWycHg+pHA6ZcO2uv0s3AmFhybCvsdY2AmFl6bCvkVHOaIHiilUAgf2sLAE0iyaDQdeYOEOSEHS4MA6Fh6GVEkhOHA7Cy2Q5lIIDqxmYTOkuaTBgftY2AipkmbDgSdZuAtSkErgwC4WroE0i/ywr/oXjjhyPqTJNAEmCx/66BYksoaFDijyKRtSzdpdfzPvRiJ7WXgCCg9lhGG49DhHnFgFa2tYONoIKZxOFIDUzsL3C2Bl4QEWtkNRSkQ+SCsGWXi7BsPV7mHhxJVQFBLRWCi2s27HfMSra2fdK1CNpogApIafWPfBhTBb8inruuqhKCchD4rbjrHu8CPzINW09LLun1uhyiXBrUHx4CBH/dB6CaIuf/YARw3cD5XmJl0BVJsGOebg7m1bd7xziGMGNsDES1FpFVA9cISt/XUvTM5LpSGnw+S6r9nKV1fBLIcMM2BSu+lPjtfbUgOzYpKyqmC2+OkuVn371CLEqcokRTbiVa967r1eFn57d8tN1RjGQyY+WKlruqKxFpYKKc45cMSfQnFc0+HANBcNc9LZsG2yi6wUwZ5wISVwsgYb5oynhDKLkVRxJo0kpwIj0s6kJFK9GhKq9KZScqNyA7AUyB1FNo0pKgvDJFxWOJocSffk+0uCWiikBUum5HvSKYH/AUiSxpA/XUvpAAAAAElFTkSuQmCC",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=function(e,t){var a=new pn({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),i=40,n=27*1.1,r=function(e){var t=new Uint32Array([0,1,2,2,3,0]);return new rn.a([["position",{size:3,data:[i-e,-e,0,i+e,-e,0,i+e,e,0,i-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},o=ye.a.createPolylineGeometry([[0,0,0],[13,0,0]]),c=ye.a.createPolylineGeometry([[0,0,0],[i-n,0,0]]),s=new vn.a({color:Ui,renderOccluded:4}),l=[{geometry:r(27),material:a,stateMask:1|An},{geometry:o,material:s,stateMask:1|An},{geometry:r(n),material:a,stateMask:2|An},{geometry:c,material:s,stateMask:2|An}];return new Gt({view:e,renderObjects:l,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[i,0,0]},collisionPriority:1,radius:13.5,state:An})}(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",(function(){return e.updateManipulatorAvailability(e.rotateManipulator,3)}))),this.rotateManipulator.events.on("grab-changed",(function(t){e._onRotateGrab(t)})),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds(this.mapBounds);var a=ba({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return Object(ot.c)()}});Object(p.k)(a)&&(this.outlineVisualElement=a.visualElement instanceof de?a.visualElement:null),Object(p.k)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(function(){return e.updateDisplayBounds(e.mapBounds)}))),this.handles.add(a),this.handles.add([this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.graphicState.watch("displaying",(function(){return e.updateAllManipulatorAvailability()})),Object(f.a)(this.graphicState,"isDraped",(function(){return e.graphicDrapedChanged()})),this.view.trackGraphicState(this.graphicState)]);var n=this.view.pointsOfInterest;n&&this.handles.add(n.focus.watch("location",(function(){return e.updateDisplayBounds(e.mapBounds)})));var r=function(t){e.handles.add(t.events.on("grab-changed",(function(){e.grabbing=t.grabbing,e.updateAllManipulatorAvailability()})))};this.forEachManipulator(r),this.graphicMoveManipulation.forEachManipulator(r);var o=function(t,a){e.handles.add(t.events.on("immediate-click",(function(t){1===a&&e.emit("immediate-click",Object(i.a)(Object(i.a)({},t),{},{graphic:e.graphic})),t.stopPropagation()})))};this.forEachManipulator(o),this.graphicMoveManipulation.forEachManipulator(o),this.onGeometryChanged(),this.updateAllManipulatorAvailability(),this.complete()}},{key:"graphicDrapedChanged",value:function(){var e=this;this.handles.remove(Wn),this.updateDisplayBounds(this.mapBounds),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(function(t){Object(p.k)(e.attachmentOrigin)&&Object(mt.j)(t.extent,e.attachmentOrigin.x,e.attachmentOrigin.y)&&e.updateDisplayBounds(e.mapBounds)})),Wn)}},{key:"updateAllManipulatorAvailability",value:function(){var e=this;this.forEachManipulator((function(t,a){return e.updateManipulatorAvailability(t,a)}))}},{key:"updateManipulatorAvailability",value:function(e,t){var a=this.graphicState.displaying,i=this.grabbing&&!e.grabbing;e.interactive=!i;var n=this.enableZ&&aa(this.graphic);switch(t){case 3:e.available=a&&this.enableRotation;break;case 2:e.available=a&&(this.enableScaling||this.enableRotation||n),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?Cn:Tn;break;case 0:e.available=a&&n;break;default:e.available=a}}},{key:"forEachManipulator",value:function(e){this.resizeManipulators.forEach((function(t){return e(t,2)})),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}},{key:"destroy",value:function(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryHelper.destroy(),this._set("view",null),this._set("graphic",null)}},{key:"preserveAspectRatio",get:function(){return this._preserveAspectRatio.enabled},set:function(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){this.mapBounds=null,this.displayBounds=null}},{key:"onGeometryChanged",value:function(){this.updateDisplayBounds(this.mapBounds)}},{key:"calculateMapBounds",value:function(){var e=this.graphic.geometry,t=this.editGeometryHelper.editGeometry,a=t.components[0].edges[0],i=Object(gt.a)(st.c.get(),a.left.pos,a.right.pos);Object(gt.f)(i,i);var n=Object(p.t)(Jt(this.view,this.graphic),e.extent.center),r=Xn*this.view.pixelSizeAt(n),o=this.view.spatialReference;o!==e.spatialReference&&(r*=Object(Ii.d)(o)/Object(Ii.d)(e.spatialReference)),function(e,t,a,i){i||(i=Object(Hi.a)());var n=Object(gt.s)(st.c.get(),e[1],-e[0]),r=Object(gt.s)(st.c.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=Object(gt.s)(st.c.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),c=st.c.get();t.components.forEach((function(t){return t.vertices.forEach((function(t){var a=t.pos;Object(gt.s)(c,Object(gt.h)(e,a),Object(gt.h)(n,a)),Object(gt.u)(r,r,c),Object(gt.v)(o,o,c)}))}));var s=1e-6,l=Object(gt.s)(st.c.get(),o[0]-r[0]<s?a/2:0,o[1]-r[1]<s?a/2:0);Object(gt.a)(r,r,l),Object(gt.i)(o,o,l),Object(gt.b)(i.basis1,e,(o[0]-r[0])/2),Object(gt.b)(i.basis2,n,(o[1]-r[1])/2),Object(gt.s)(i.origin,r[0]*e[0]+r[1]*n[0],r[0]*e[1]+r[1]*n[1]),Object(gt.i)(i.origin,i.origin,i.basis1),Object(gt.i)(i.origin,i.origin,i.basis2)}(i,t,r,this.mapBounds)}},{key:"updateDisplayBounds",value:function(e){var t=this.graphic.geometry,a=Object(p.k)(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(p.k)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Jt(this.view,this.graphic);this.attachmentOrigin=Object(p.t)(a,t.extent.center);var i=Object(p.k)(a)?a.z:Object(ua.e)(e.origin,this.view.elevationProvider,ce.a.fromElevationInfo(Object(O.e)(this.graphic)),this.view.renderCoordsHelper),n=Object(Hi.b)(e);Object(W.w)(n.origin,e.origin[0],e.origin[1],i),function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;n||(n=Object(Hi.a)()),t.toRenderCoords(e.origin,a,n.origin);var r=st.d.get();Object(W.f)(r,e.origin,e.basis1),Object(W.f)(r,r,e.basis2),t.toRenderCoords(r,a,r);var o=st.d.get();Object(W.f)(o,e.origin,e.basis1),Object(W.j)(o,o,e.basis2),t.toRenderCoords(o,a,o);var c=st.d.get();Object(W.j)(c,e.origin,e.basis1),Object(W.j)(c,c,e.basis2),t.toRenderCoords(c,a,c);var s=st.d.get();Object(W.j)(s,e.origin,e.basis1),Object(W.f)(s,s,e.basis2),t.toRenderCoords(s,a,s);var l=Object(W.i)(st.d.get(),r,o,.5);Object(W.j)(l,l,n.origin);var u=Object(W.i)(st.d.get(),c,s,.5);Object(W.j)(u,n.origin,u),Object(W.i)(n.basis1,l,u,.5);var h=Object(W.i)(st.d.get(),s,r,.5);Object(W.j)(h,h,n.origin);var d=Object(W.i)(st.d.get(),o,c,.5);Object(W.j)(d,n.origin,d),Object(W.i)(n.basis2,h,d,.5);var p=Object(W.g)(st.d.get(),n.basis1,n.basis2),f=Object(W.g)(p,p,n.basis1);Object(W.r)(f,f),Object(W.e)(n.basis2,f,Object(W.h)(n.basis2,f)),Object(W.e)(n.basis1,n.basis1,1+i/Object(W.p)(n.basis1)),Object(W.e)(n.basis2,n.basis2,1+i/Object(W.p)(n.basis2)),Object(Hi.j)(n)}(n,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin(),this.displayBounds),this.updateManipulators()}},{key:"displayBoundsMargin",value:function(){var e=this.view.pointsOfInterest,t=e?e.focus.location:this.editGeometryHelper.geometry.extent.center;return Yn*this.view.pixelSizeAt(t)}},{key:"_createMoveXYGraphicDragPipeline",value:function(){var e=this;return this.graphicMoveManipulation.createDragPipeline((function(t,a,i){return e.applyGraphicMoveSteps(a,i)}))}},{key:"_createMoveZDragPipeline",value:function(){var e=this,t=this.view,a=this.editGeometryHelper.geometry.spatialReference;return Object(wa.e)(this.moveZManipulator,(function(i,n,r){var o=Object(Y.c)(i.renderLocation),c=n.next(Aa(t,o,a)).next(Object(wa.c)());e.applyGraphicMoveSteps(c,r)}))}},{key:"applyGraphicMoveSteps",value:function(e,t){var a=this,i=e.next((function(e){return"start"===e.action&&(a.inputState={type:"move"},Object(Hi.b)(a.mapBounds,a.mapBoundsStart),a.emit("graphic-translate-start",{graphic:a.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e})).next(Object(wa.b)()).next(this._moveDragUpdateGeometry()).next((function(e){var t={graphic:a.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&a.emit("graphic-translate",t);break;case"end":a.inputState=null,a.emit("graphic-translate-stop",t)}return e}));return t.next((function(){Object(p.k)(a.inputState)&&a.emit("graphic-translate-stop",{graphic:a.graphic,dxScreen:0,dyScreen:0}),a.cancel()})),i}},{key:"_moveDragUpdateGeometry",value:function(){var e=this;return function(t){if(Object(p.j)(e.inputState)||"move"!==e.inputState.type)return t;var a,i=[],n=Object(N.a)(e.editGeometryHelper.editGeometry.components);try{for(n.s();!(a=n.n()).done;){var r=a.value;i.push.apply(i,Object(_i.a)(r.vertices))}}catch(c){n.e(c)}finally{n.f()}var o="start"===t.action?0:1;return Un(e.editGeometryHelper.moveVertices(i,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,o),e.mapBounds),e.graphic.geometry=e.editGeometryHelper.geometry,t}}},{key:"_onResizeGrab",value:function(e){if("start"===e.action){var t=this._calculatePickRay(e.screenPoint);Object(jt.m)(this.displayBounds.plane,t,st.d.get())&&(Object(Hi.b)(this.displayBounds,this.displayBoundsStart),Object(Hi.b)(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin(),this.inputState={type:"resize"})}}},{key:"_createResizeDragPipeline",value:function(e,t){var a=this;return Object(wa.e)(e,(function(e,n,r){Object(p.j)(a.inputState)||(n.next((function(e){return"start"===e.action&&a.emit("graphic-scale-start",{graphic:a.graphic,xScale:1,yScale:1}),e})).next(ka(a.view,a.displayBoundsStart.plane)).next((function(e){return Object(i.a)(Object(i.a)({},e),{},{handle:t})})).next(a._resizeDragRenderPlaneToFactors()).next(a._preserveAspectRatio.createDragEventPipelineStep(),a._preserveAspectRatio.next).next(a._resizeDragUpdateGeometry()).next((function(e){var t={graphic:a.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":a.emit("graphic-scale",t);break;case"end":a.inputState=null,a.emit("graphic-scale-stop",t)}return e})),r.next((function(){Object(p.k)(a.inputState)&&a.emit("graphic-scale-stop",{graphic:a.graphic,xScale:1,yScale:1}),a.cancel()})))}))}},{key:"_resizeDragRenderPlaneToFactors",value:function(){var e=this;return function(t){var a=e.displayBoundsStart,n=t.handle.direction,r=e.displayBoundsMargin(),o=e.displayBoundsMarginStart,c=Object(W.k)(st.d.get(),a.origin);Object(W.c)(c,c,a.basis1,-n[0]),Object(W.c)(c,c,a.basis2,-n[1]);var s=Object(W.j)(st.d.get(),t.renderEnd,c),l=Object(W.j)(st.d.get(),t.renderStart,c),u=kn(t.handle),h=wn(a),d=wn(e.displayBounds)/h,p=function(e,t){if(0===e)return 1;var a=Object(W.p)(t),i=.5*e*Object(W.h)(t,s)/a,n=i<0?-1:1;u&&(i+=(a-.5*e*Object(W.h)(t,l)/a)*n*d);var c=a<1.5*o?1:Qn;return a=Math.max(a-o,Qn),n>0&&(i-=r),n*Math.max(n*(i/a),c)};return Object(i.a)(Object(i.a)({},t),{},{factor1:p(n[0],a.basis1),factor2:p(n[1],a.basis2)})}}},{key:"_resizeDragUpdateGeometry",value:function(){var e=this;return function(t){var a=Object(W.k)(Object(Y.e)(),e.mapBoundsStart.origin);Object(W.c)(a,a,e.mapBoundsStart.basis1,-t.handle.direction[0]),Object(W.c)(a,a,e.mapBoundsStart.basis2,-t.handle.direction[1]);var i=Object(gt.s)(Object(Vi.a)(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);Object(gt.f)(i,i);var n,r=[],o=Object(N.a)(e.editGeometryHelper.editGeometry.components);try{for(o.s();!(n=o.n()).done;){var c=n.value;r.push.apply(r,Object(_i.a)(c.vertices))}}catch(u){o.e(u)}finally{o.f()}var s="start"===t.action?0:1,l=e.editGeometryHelper.scaleVertices(r,e.editGeometryHelper.editGeometry.coordinateHelper.fromXYZ(a),i,t.factor1,t.factor2,s,1);return Object(Hi.b)(e.mapBoundsStart,e.mapBounds),Un(l,e.mapBounds),e.graphic.geometry=e.editGeometryHelper.geometry,t}}},{key:"_onRotateGrab",value:function(e){if("start"===e.action){var t=function(e,t,a,i){var n=t.worldUpAtPosition(e.origin,st.d.get()),r=st.d.get();switch(a){case 1:Object(W.k)(r,n);break;case 2:Object(W.k)(r,e.basis1)}return Object(jt.g)(e.origin,r,i)}(this.displayBounds,this.view.renderCoordsHelper,1,Object(jt.d)()),a=this._calculatePickRay(e.screenPoint);Object(jt.m)(t,a,st.d.get())&&(Object(Hi.b)(this.displayBounds,this.displayBoundsStart),Object(Hi.b)(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}}},{key:"_createRotateDragPipeline",value:function(e){var t=this;return Object(wa.e)(e,(function(e,a,i){var n=t.inputState;Object(p.j)(n)||(a.next((function(e){return"start"===e.action&&t.emit("graphic-rotate-start",{graphic:t.graphic,angle:0}),e})).next(ka(t.view,n.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(n)).next(t._rotateDragUpdateGeometry()).next((function(e){var a={graphic:t.graphic,angle:Object(ht.q)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",a);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",a)}return e})),i.next((function(){Object(p.k)(t.inputState)&&t.emit("graphic-rotate-stop",{graphic:t.graphic,angle:0}),t.cancel()})))}))}},{key:"_rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(a){var n=Object(jt.r)(e.rotatePlane),r=Qt(a.renderStart,a.renderEnd,t.displayBounds.origin,n);return Object(i.a)(Object(i.a)({},a),{},{rotateAxis:n,rotateAngle:r})}}},{key:"_rotateDragUpdateGeometry",value:function(){var e=this;return function(t){var a,i=Object(W.k)(Object(Y.e)(),e.mapBoundsStart.origin),n=[],r=Object(N.a)(e.editGeometryHelper.editGeometry.components);try{for(r.s();!(a=r.n()).done;){var o=a.value;n.push.apply(n,Object(_i.a)(o.vertices))}}catch(l){r.e(l)}finally{r.f()}var c="start"===t.action?0:1,s=e.editGeometryHelper.rotateVertices(n,e.editGeometryHelper.editGeometry.coordinateHelper.fromXYZ(i),t.rotateAngle,c,1);return Object(Hi.b)(e.mapBoundsStart,e.mapBounds),Un(s,e.mapBounds),e.graphic.geometry=e.editGeometryHelper.geometry,t}}},{key:"_calculatePickRay",value:function(e){var t=Object(_t.c)(),a=Object(dt.i)(e);return wt(this.view.state.camera,a,t),Object(W.r)(t.direction,t.direction),t}},{key:"updateManipulators",value:function(){var e=this;if(this.visible){var t=function(e,t){return Kt(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,st.a.get());(function(e,t,a,i){var n=i.worldUpAtPosition(a.origin,st.d.get()),r=_n(a,0),o=Object(ct.i)(st.a.get());Object(ct.r)(o,o,r.edge*Math.PI/2),Object(ct.b)(o,o,-Gn(a,n)),Object(ct.m)(o,t,o),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=r.position})(this.rotateManipulator,t,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,t),this.resizeManipulators.forEach((function(a,i){!function(e,t,a,i){var n=Object(W.p)(i.basis1),r=Object(W.p)(i.basis2),o=Mn(i),c=wn(i),s=Object(W.w)(st.d.get(),0,0,0);Object(W.f)(s,Object(W.e)(st.d.get(),i.basis1,t.direction[0]),Object(W.e)(st.d.get(),i.basis2,t.direction[1])),Object(W.f)(s,i.origin,s);var l=0,u=1;if(kn(t))1===t.direction[0]&&-1===t.direction[1]?l=Pn:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),u=c;else{var h=0!==t.direction[0]?1:2;l=1===h?Pn:0,u=(1===h?r:n)-o}var d=Object(ct.i)(st.a.get());Object(ct.r)(d,d,l),Object(ct.s)(d,d,Object(W.w)(st.d.get(),u,u,u)),Object(ct.m)(d,a,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=s}(a,e.resizeHandles[i],t,e.displayBounds)}))}}},{key:"updateZMoveHandle",value:function(e,t){var a=this.displayBounds,i={basis:a.basis1,direction:-1,position:Object(W.j)(st.d.get(),a.origin,a.basis1),edge:2},n=st.a.get();Object(ct.r)(n,t,i.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=i.position}},{key:"cancel",value:function(){var e=this.editGeometryHelper.editGeometry.lastOperation;Object(p.j)(e)||(this.editGeometryHelper.undo(),this.graphic.geometry=this.editGeometryHelper.geometry,Bn(e,this.mapBounds),this.updateDisplayBounds(this.mapBounds),this.inputState=null)}},{key:"canUndo",get:function(){return this.editGeometryHelper.canUndo}},{key:"undo",value:function(){if(Object(p.k)(this.inputState))this.view.activeTool=null;else if(this.canUndo){var e=this.editGeometryHelper.undo();this.graphic.geometry=this.editGeometryHelper.geometry,Bn(Object(p.s)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}},{key:"canRedo",get:function(){return this.editGeometryHelper.canRedo}},{key:"redo",value:function(){if(this.canRedo){var e=this.editGeometryHelper.redo();this.graphic.geometry=this.editGeometryHelper.geometry,Un(Object(p.s)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}},{key:"test",get:function(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator}}}]),a}(h.a.EventedMixin($e.a));Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],Nn.prototype,"view",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],Nn.prototype,"graphic",void 0),Object(s.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],Nn.prototype,"enableZ",void 0),Object(s.a)([Object(b.b)()],Nn.prototype,"enableRotation",void 0),Object(s.a)([Object(b.b)()],Nn.prototype,"enableScaling",void 0),Object(s.a)([Object(b.b)()],Nn.prototype,"preserveAspectRatio",null),Object(s.a)([Object(b.b)()],Nn.prototype,"grabbing",void 0),Object(s.a)([Object(b.b)()],Nn.prototype,"inputState",void 0),Object(s.a)([Object(b.b)({readOnly:!0})],Nn.prototype,"type",void 0),Nn=Object(s.a)([Object(y.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Nn);var Wn="draped-elevation-changes",Yn=10,Xn=80,Qn=1e-6},719:function(e,t,a){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,a=0,i=0;i<e.length;i++){var n=e[i].size;"number"==typeof n&&(t+=n,a++)}return t/a}(e.stops):t}function r(e,t){if(!t)return e;var a=t.filter((function(e){return"size"===e.type})).map((function(t){var a=t.maxSize,i=t.minSize;return(n(a,e)+n(i,e))/2})),i=0,r=a.length;if(0===r)return e;for(var o=0;o<r;o++)i+=a[o];var c=Math.floor(i/r);return Math.max(c,e)}function o(e){var t=e&&e.renderer,a="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return a;var n="visualVariables"in t?r(a,t.visualVariables):a;if("simple"===t.type)return i(n,t.symbol);if("unique-value"===t.type){var o=n;return t.uniqueValueInfos.forEach((function(e){o=i(o,e.symbol)})),o}if("class-breaks"===t.type){var c=n;return t.classBreakInfos.forEach((function(e){c=i(c,e.symbol)})),c}return t.type,n}a.d(t,"a",(function(){return o}))},734:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return s}));a(76);var i=a(4),n=a(61),r=a(719),o=a(56);function c(e,t,a){var r,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.a;if("2d"===a.type)r=t*a.resolution;else if("3d"===a.type){var s=a.overlayPixelSizeInMapUnits(e),l=a.basemapSpatialReference;r=Object(i.k)(l)&&!l.equals(a.spatialReference)?Object(n.d)(l)/Object(n.d)(a.spatialReference):t*s}var u=e.x-r,h=e.y-r,d=e.x+r,p=e.y+r,f=a.spatialReference;return c.xmin=Math.min(u,d),c.ymin=Math.min(h,p),c.xmax=Math.max(u,d),c.ymax=Math.max(h,p),c.spatialReference=f,c}function s(e,t,a){var n=a.toMap(e);return!Object(i.j)(n)&&c(n,Object(r.a)(),a,l).intersects(t)}var l=new o.a},770:function(e,t,a){"use strict";a.d(t,"a",(function(){return h})),a.d(t,"b",(function(){return d})),a.d(t,"c",(function(){return u})),a.d(t,"d",(function(){return l})),a.d(t,"e",(function(){return c})),a.d(t,"f",(function(){return s}));var i=a(40),n=a(480),r=a(291),o=a(11);function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return[e[0],e[1],e[2],e[3]]}function s(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c();return Object(o.k)(a,e),a[3]=t,a}function l(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c();return Object(n.h)(b,e,d(e)),Object(n.h)(v,t,d(t)),Object(n.f)(b,v,b),p(a,Object(i.q)(Object(n.b)(a,b)))}function u(e){return e}function h(e){return e[3]}function d(e){return Object(i.g)(e[3])}function p(e,t){return e[3]=t,e}var f=[0,0,1,0],b=Object(r.b)(),v=Object(r.b)();c()},780:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var i=a(2),n=a(3),r=a(5),o=a(6),c=a(0),s=a(34),l=a(71),u=a(4),h=a(32),d=a(1),p=(a(14),a(16),a(13),a(8)),f=a(26),b=a(11),v=a(22),g=a(108),y=a(153),m=a(512),O=a(415),j=a(734),_=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).layer=null,n.interactive=!0,n.selectable=!1,n.grabbable=!0,n.dragging=!1,n.cursor=null,n.events=new l.a.EventEmitter,n._circleCollisionCache=null,n._graphicSymbolChangedHandle=null,n._originalSymbol=null,n}return Object(n.a)(a,[{key:"graphic",set:function(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}},{key:"elevationInfo",get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(y.f)(this.graphic),a=e?e.offset:0;return new O.a({mode:t,offset:a})}},{key:"focusedSymbol",set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}},{key:"hovering",set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}},{key:"selected",set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"_focused",get:function(){return this._get("hovering")||this._get("grabbing")}},{key:"destroy",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}},{key:"intersectionDistance",value:function(e){var t=this.graphic;if(!1===t.visible)return null;var a=t.geometry;if(Object(u.j)(a))return null;var i=this._get("focusedSymbol"),n=Object(u.k)(i)?i:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,a,n):this._intersectDistance3D(this.view,e,t)}},{key:"attach",value:function(){this.attachSymbolChanged(),Object(u.k)(this.layer)&&this.layer.add(this.graphic)}},{key:"detach",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(u.k)(this.layer)&&this.layer.remove(this.graphic)}},{key:"attachSymbolChanged",value:function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(function(t){Object(u.k)(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&Object(u.k)(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),!0)}},{key:"detachSymbolChanged",value:function(){Object(u.k)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}},{key:"_updateGraphicSymbol",value:function(){this.graphic.symbol=this._focused&&Object(u.k)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}},{key:"_resetGraphicSymbol",value:function(){this.graphic.symbol=this._originalSymbol}},{key:"_intersectDistance2D",value:function(e,t,a,i){if(i=i||Object(m.h)(a),Object(u.j)(i))return null;var n=this._circleCollisionCache;if("point"!==a.type||"simple-marker"!==i.type)return Object(j.b)(t,a,e)?1:null;if(Object(u.j)(n)||!n.originalPoint.equals(a)){var r=a,o=e.spatialReference;if(Object(g.b)(r.spatialReference,o)){var c=Object(g.k)(r,o);n={originalPoint:r.clone(),mapPoint:c,radiusPx:Object(h.g)(i.size)},this._circleCollisionCache=n}}if(Object(u.k)(n)){var s=Object(h.i)(t,w),l=e.toScreen(n.mapPoint),d=n.radiusPx,p=l.x+Object(h.g)(i.xoffset),b=l.y-Object(h.g)(i.yoffset);return Object(f.j)(s,[p,b])<d*d?1:null}return null}},{key:"_intersectDistance3D",value:function(e,t,a){var i=e.toMap(t,{include:[a]});return i&&Object(g.p)(i,M,e.renderSpatialReference)?Object(b.m)(M,e.state.camera.eye):null}}]),a}(s.a);Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],_.prototype,"graphic",null),Object(c.a)([Object(d.b)({readOnly:!0})],_.prototype,"elevationInfo",null),Object(c.a)([Object(d.b)({constructOnly:!0,nonNullable:!0})],_.prototype,"view",void 0),Object(c.a)([Object(d.b)({value:null})],_.prototype,"focusedSymbol",null),Object(c.a)([Object(d.b)({constructOnly:!0})],_.prototype,"layer",void 0),Object(c.a)([Object(d.b)()],_.prototype,"interactive",void 0),Object(c.a)([Object(d.b)()],_.prototype,"selectable",void 0),Object(c.a)([Object(d.b)()],_.prototype,"grabbable",void 0),Object(c.a)([Object(d.b)({value:!1})],_.prototype,"grabbing",null),Object(c.a)([Object(d.b)()],_.prototype,"dragging",void 0),Object(c.a)([Object(d.b)()],_.prototype,"hovering",null),Object(c.a)([Object(d.b)({value:!1})],_.prototype,"selected",null),Object(c.a)([Object(d.b)()],_.prototype,"cursor",void 0),_=Object(c.a)([Object(p.a)("esri.views.interactive.GraphicManipulator")],_);var M=Object(v.e)(),w=Object(h.f)()},795:function(e,t,a){"use strict";a.r(t),a.d(t,"hydratedAdapter",(function(){return s}));var i=a(56),n=a(232),r=a(39),o=a(99),c=a(94),s={convertToGEGeometry:function(e,t){if(null==t)return null;var a="cache"in t?t.cache._geVersion:void 0;return null==a&&(a=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=a)),a},exportPoint:function(e,t,a){var i=e.hasZ(t),n=e.hasM(t),o=new r.a({x:e.getPointX(t),y:e.getPointY(t),spatialReference:a});return i&&(o.z=e.getPointZ(t)),n&&(o.m=e.getPointM(t)),o.cache._geVersion=t,o},exportPolygon:function(e,t,a){var i=new o.a({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:a});return i.cache._geVersion=t,i},exportPolyline:function(e,t,a){var i=new c.a({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:a});return i.cache._geVersion=t,i},exportMultipoint:function(e,t,a){var i=new n.a({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:a});return i.cache._geVersion=t,i},exportExtent:function(e,t,a){var n=e.hasZ(t),r=e.hasM(t),o=new i.a({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:a});if(n){var c=e.getZExtent(t);o.zmin=c.vmin,o.zmax=c.vmax}if(r){var s=e.getMExtent(t);o.mmin=s.vmin,o.mmax=s.vmax}return o.cache._geVersion=t,o}}},844:function(e,t,a){"use strict";a.r(t),a.d(t,"buffer",(function(){return x})),a.d(t,"clip",(function(){return c})),a.d(t,"contains",(function(){return l})),a.d(t,"convexHull",(function(){return j})),a.d(t,"crosses",(function(){return u})),a.d(t,"cut",(function(){return s})),a.d(t,"densify",(function(){return I})),a.d(t,"difference",(function(){return _})),a.d(t,"disjoint",(function(){return v})),a.d(t,"distance",(function(){return h})),a.d(t,"equals",(function(){return d})),a.d(t,"extendedSpatialReferenceInfo",(function(){return o})),a.d(t,"flipHorizontal",(function(){return C})),a.d(t,"flipVertical",(function(){return T})),a.d(t,"generalize",(function(){return z})),a.d(t,"geodesicArea",(function(){return F})),a.d(t,"geodesicBuffer",(function(){return E})),a.d(t,"geodesicDensify",(function(){return V})),a.d(t,"geodesicLength",(function(){return U})),a.d(t,"intersect",(function(){return w})),a.d(t,"intersects",(function(){return p})),a.d(t,"isSimple",(function(){return m})),a.d(t,"nearestCoordinate",(function(){return D})),a.d(t,"nearestVertex",(function(){return G})),a.d(t,"nearestVertices",(function(){return A})),a.d(t,"offset",(function(){return S})),a.d(t,"overlaps",(function(){return g})),a.d(t,"planarArea",(function(){return H})),a.d(t,"planarLength",(function(){return L})),a.d(t,"relate",(function(){return y})),a.d(t,"rotate",(function(){return P})),a.d(t,"simplify",(function(){return O})),a.d(t,"symmetricDifference",(function(){return M})),a.d(t,"touches",(function(){return f})),a.d(t,"union",(function(){return k})),a.d(t,"within",(function(){return b}));var i=a(769),n=a(795);function r(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function o(e){return i.G.extendedSpatialReferenceInfo(e)}function c(e,t){return i.G.clip(n.hydratedAdapter,r(e),e,t)}function s(e,t){return i.G.cut(n.hydratedAdapter,r(e),e,t)}function l(e,t){return i.G.contains(n.hydratedAdapter,r(e),e,t)}function u(e,t){return i.G.crosses(n.hydratedAdapter,r(e),e,t)}function h(e,t,a){return i.G.distance(n.hydratedAdapter,r(e),e,t,a)}function d(e,t){return i.G.equals(n.hydratedAdapter,r(e),e,t)}function p(e,t){return i.G.intersects(n.hydratedAdapter,r(e),e,t)}function f(e,t){return i.G.touches(n.hydratedAdapter,r(e),e,t)}function b(e,t){return i.G.within(n.hydratedAdapter,r(e),e,t)}function v(e,t){return i.G.disjoint(n.hydratedAdapter,r(e),e,t)}function g(e,t){return i.G.overlaps(n.hydratedAdapter,r(e),e,t)}function y(e,t,a){return i.G.relate(n.hydratedAdapter,r(e),e,t,a)}function m(e){return i.G.isSimple(n.hydratedAdapter,r(e),e)}function O(e){return i.G.simplify(n.hydratedAdapter,r(e),e)}function j(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i.G.convexHull(n.hydratedAdapter,r(e),e,t)}function _(e,t){return i.G.difference(n.hydratedAdapter,r(e),e,t)}function M(e,t){return i.G.symmetricDifference(n.hydratedAdapter,r(e),e,t)}function w(e,t){return i.G.intersect(n.hydratedAdapter,r(e),e,t)}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i.G.union(n.hydratedAdapter,r(e),e,t)}function S(e,t,a,o,c,s){return i.G.offset(n.hydratedAdapter,r(e),e,t,a,o,c,s)}function x(e,t,a){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return i.G.buffer(n.hydratedAdapter,r(e),e,t,a,o)}function E(e,t,a,o,c,s){return i.G.geodesicBuffer(n.hydratedAdapter,r(e),e,t,a,o,c,s)}function D(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return i.G.nearestCoordinate(n.hydratedAdapter,r(e),e,t,a)}function G(e,t){return i.G.nearestVertex(n.hydratedAdapter,r(e),e,t)}function A(e,t,a,o){return i.G.nearestVertices(n.hydratedAdapter,r(e),e,t,a,o)}function R(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function P(e,t,a){var n;if(null==e)throw new Error("Illegal Argument Exception");var r=e.spatialReference;if(null==(a=null!=(n=a)?n:R(e)))throw new Error("Illegal Argument Exception");var o=e.constructor.fromJSON(i.G.rotate(e,t,a));return o.spatialReference=r,o}function C(e,t){var a;if(null==e)throw new Error("Illegal Argument Exception");var n=e.spatialReference;if(null==(t=null!=(a=t)?a:R(e)))throw new Error("Illegal Argument Exception");var r=e.constructor.fromJSON(i.G.flipHorizontal(e,t));return r.spatialReference=n,r}function T(e,t){var a;if(null==e)throw new Error("Illegal Argument Exception");var n=e.spatialReference;if(null==(t=null!=(a=t)?a:R(e)))throw new Error("Illegal Argument Exception");var r=e.constructor.fromJSON(i.G.flipVertical(e,t));return r.spatialReference=n,r}function z(e,t,a,o){return i.G.generalize(n.hydratedAdapter,r(e),e,t,a,o)}function I(e,t,a){return i.G.densify(n.hydratedAdapter,r(e),e,t,a)}function V(e,t,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return i.G.geodesicDensify(n.hydratedAdapter,r(e),e,t,a,o)}function H(e,t){return i.G.planarArea(n.hydratedAdapter,r(e),e,t)}function L(e,t){return i.G.planarLength(n.hydratedAdapter,r(e),e,t)}function F(e,t,a){return i.G.geodesicArea(n.hydratedAdapter,r(e),e,t,a)}function U(e,t,a){return i.G.geodesicLength(n.hydratedAdapter,r(e),e,t,a)}},861:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var i=a(7),n=a.n(i),r=a(10),o=a(9),c=a(15),s=a(4),l=a(561),u=a(35),h=a(540),d=a(173),p=a(138),f=a(1);function b(e){return v[function(e){return e instanceof Blob?e.type:function(e){var t=Object(u.n)(e);return m[t]||g}(e.url)}(e)]||y}var v={},g="text/plain",y=v[g],m={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(var O in m)v[m[O]]=O;var j=a(111);function _(e){var t=Object(s.k)(e)&&e.origins?e.origins:[void 0];return function(a,i){var n,r=function(e,t,a){if(Object(s.k)(e)&&"resource"===e.type)return function(e,t,a){var i=Object(d.b)(t,a);return{type:String,read:function(e,t,a){var n=Object(j.d)(e,t,a);return i.type===String?n:"function"==typeof i.type?new i.type({url:n}):void 0},write:{writer:function(t,n,r,c){if(!c||!c.resources)return"string"==typeof t?void(n[r]=Object(j.e)(t,c)):void(n[r]=t.write({},c));var h=function(e){return Object(s.j)(e)?null:"string"==typeof e?e:e.url}(t),d=h?Object(j.e)(h,Object(o.a)(Object(o.a)({},c),{},{verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),1):null,f=i.type!==String&&(!Object(l.a)(this)||c&&c.origin&&this.originIdOf(a)>Object(p.d)(c.origin));c&&c.portalItem&&Object(s.k)(d)&&!Object(u.s)(d)?f?function(e,t,a,i,n,r,o,c){var s=o.portalItem.resourceFromPath(i),l=k(a,i,o);b(l)===Object(u.n)(s.path)?(w(e,t,s,l,o.resources.toUpdate),n[r]=i):M(e,t,a,i,n,r,o,c)}(this,a,t,d,n,r,c,e):function(e,t,a,i){i.resources.toKeep.push({resource:i.portalItem.resourceFromPath(e)}),t[a]=e}(d,n,r,c):c&&c.portalItem&&(Object(s.j)(d)||Object(s.k)(Object(j.b)(d))||Object(u.t)(d)||f)?M(this,a,t,d,n,r,c,e):n[r]=d}}}}(e,t,a);switch(Object(s.k)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":return{read:j.c.read,write:j.c.write}}}(e,a,i),h=Object(c.a)(t);try{for(h.s();!(n=h.n()).done;){var v=n.value,g=Object(f.c)(a,v,i);for(var y in r)g[y]=r[y]}}catch(m){h.e(m)}finally{h.f()}}}function M(e,t,a,i,n,r,o,c){var l=Object(h.a)(),d=k(a,i,o),p=Object(u.z)(Object(s.i)(c,"prefix"),l),f="".concat(p,".").concat(b(d)),v=o.portalItem.resourceFromPath(f);Object(u.t)(i)&&o.resources.pendingOperations.push(function(e){return S.apply(this,arguments)}(i).then((function(e){v.path="".concat(p,".").concat(b(e)),n[r]=v.itemRelativeUrl})).catch((function(){}))),w(e,t,v,d,o.resources.toAdd),n[r]=v.itemRelativeUrl}function w(e,t,a,i,n){n.push({resource:a,content:i,finish:function(a){!function(e,t,a){"string"==typeof e[t]?e[t]=a.url:e[t].url=a.url}(e,t,a)}})}function k(e,t,a){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(a))],{type:"application/json"})}function S(){return(S=Object(r.a)(n.a.mark((function e(t){var i,r,o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(a.bind(null,63));case 2:return i=e.sent.default,e.next=5,i(t,{responseType:"blob"});case 5:return r=e.sent,o=r.data,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},901:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return c}));var i,n=a(29),r=a(27);function o(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(Object(r.a)(i||(i=Object(n.a)(["float computeRenderPixelSizeAt( vec3 pWorld ){\nvec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\nfloat viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));\nreturn viewDirectionDistance*perScreenPixelRatio;\n}\nvec3 screenSizeScaling(vec3 position, vec3 anchor){\nreturn position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;\n}"]))))}function c(e,t,a){e.setUniform1f("perScreenPixelRatio",a.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}},902:function(e,t,a){"use strict";a.d(t,"a",(function(){return M})),a.d(t,"b",(function(){return _}));var i,n,r,o,c,s,l,u,h,d=a(29),p=a(901),f=a(201),b=a(515),v=a(233),g=a(231),y=a(234),m=a(336),O=a(27),j=a(230);function _(e){var t=new j.a;return t.include(b.a,{linearDepth:!1}),t.include(p.a,{}),t.include(f.a,e),t.fragment.include(m.a),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(Object(O.a)(i||(i=Object(d.a)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&t.vertex.code.add(Object(O.a)(n||(n=Object(d.a)(["vec3 worldNormal = normal;\nvViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;"])))),t.vertex.code.add(Object(O.a)(r||(r=Object(d.a)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),e.multipassTerrainEnabled&&(t.fragment.include(v.a),t.include(g.b,e)),t.fragment.code.add(Object(O.a)(o||(o=Object(d.a)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"")),e.shadingEnabled?t.fragment.code.add(Object(O.a)(c||(c=Object(d.a)(["vec3 viewNormalNorm = normalize(vViewNormal);\nfloat shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\nvec4 finalColor = mix(color, shadedColor, shadingFactor);"])))):t.fragment.code.add(Object(O.a)(s||(s=Object(d.a)(["vec4 finalColor = color;"])))),t.fragment.code.add(Object(O.a)(l||(l=Object(d.a)(["\n      if (finalColor.a < ",") {\n        discard;\n      }\n      ","\n\n      ","\n    }\n    "])),O.a.float(y.c),7===e.output?Object(O.a)(u||(u=Object(d.a)(["gl_FragColor = vec4(finalColor.a);"]))):"",0===e.output?Object(O.a)(h||(h=Object(d.a)(["gl_FragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"")),t}var M=Object.freeze({__proto__:null,build:_})},903:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return s}));var i,n,r=a(29),o=a(27),c=a(230);function s(){var e=new c.a;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(Object(o.a)(i||(i=Object(r.a)(["void main(void) {\nvUV = uv0;\ngl_Position = proj * view * vec4(position, 1.0);\n}"])))),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(Object(o.a)(n||(n=Object(r.a)(["void main() {\nconst float LINE_WIDTH = 1.0;\nvec2 uvScaled = vUV * gridWidth;\nvec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\nvec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\ngrid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\ngrid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\nfloat gridFade = max(grid.x, grid.y);\nfloat gridAlpha = gridColor.a * gridFade;\ngl_FragColor =\nvec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\nvec4(gridColor.rgb, 1.0) * gridAlpha;\n}"])))),e}var l=Object.freeze({__proto__:null,build:s})},904:function(e,t,a){"use strict";a.d(t,"a",(function(){return v})),a.d(t,"b",(function(){return b}));var i,n,r,o=a(29),c=a(201),s=a(515),l=a(233),u=a(231),h=a(234),d=a(336),p=a(27),f=a(230);function b(e){var t=new f.a;return t.include(s.a,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(Object(p.a)(i||(i=Object(o.a)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"")),t.include(c.a,e),e.multipassTerrainEnabled&&(t.fragment.include(l.a),t.include(u.b,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(Object(p.a)(n||(n=Object(o.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",p.a.float(h.b))):(t.fragment.include(d.a),t.fragment.code.add(Object(p.a)(r||(r=Object(o.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ","\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",p.a.float(h.b),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t}var v=Object.freeze({__proto__:null,build:b})},953:function(e,t,a){"use strict";a.r(t),a.d(t,"createCircle",(function(){return M})),a.d(t,"createEllipse",(function(){return w})),a.d(t,"createMultipoint",(function(){return y})),a.d(t,"createPoint",(function(){return g})),a.d(t,"createPolygon",(function(){return O})),a.d(t,"createPolyline",(function(){return m})),a.d(t,"createRectangle",(function(){return _})),a.d(t,"createSquare",(function(){return j})),a.d(t,"makeMapPoint",(function(){return v}));a(76);var i=a(109),n=a(20),r=a(4),o=a(61),c=a(565),s=a(844),l=a(146),u=a(49),h=a(553),d=a(39),p=a(232),f=a(94),b=a(99);function v(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(r.k)(a)?[e,t,a]:[e,t]}function g(e,t){var a=new d.a({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(a.z=e[2]),a}function y(e,t){return new p.a({points:e,spatialReference:t})}function m(e,t,a){var i=new f.a({paths:e,spatialReference:t});return a&&Object(l.i)(i),i}function O(e,t,a){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=Object(n.a)(e);o.forEach((function(e){var t=e[0],a=e[e.length-1];Object(i.c)(t,a)&&1!==e.length||e.push(e[0])}));var c=new b.a({rings:o,spatialReference:t});return c.rings.forEach((function(e){Object(l.g)(e,!1,!1)||e.reverse()})),a&&Object(l.i)(c),r&&c.isSelfIntersecting&&Object(u.j)(t)&&(c=Object(s.simplify)(c)),c}function j(e,t,a){var i=t.mapToLocalMultiple(e),n=[],o={x:i[0].x,y:i[0].y},c=i[1].x,s=i[1].y,l=Math.round(c-o.x),u=Math.round(s-o.y),d=Math.max(Math.abs(l),Math.abs(u));if(a){var p={x:o.x+d,y:o.y+d},f={x:o.x-d,y:o.y-d};n.push(Object(h.b)(p.x,f.y),Object(h.b)(f.x,f.y),Object(h.b)(f.x,p.y),Object(h.b)(p.x,p.y))}else{var b={x:l>0?o.x+d:o.x-d,y:u>0?o.y+d:o.y-d};n.push(Object(h.b)(o.x,o.y),Object(h.b)(b.x,o.y),Object(h.b)(b.x,b.y),Object(h.b)(o.x,b.y))}return O([Object(r.g)(n.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function _(e,t,a){var i=t.mapToLocalMultiple(e);if(1===i.length){var n=48,o=i[0];i=[Object(h.b)(o.x-n,o.y+n),Object(h.b)(o.x+n,o.y-n),Object(h.b)(o.x+n,o.y-n),Object(h.b)(o.x-n,o.y+n)]}var c=[],s={x:i[0].x,y:i[0].y},l={x:i[1].x,y:i[1].y};if(a){var u=Math.round(l.x-s.x),d=Math.round(l.y-s.y);c.push(Object(h.b)(s.x-u,s.y-d),Object(h.b)(l.x,s.y-d),Object(h.b)(l.x,l.y),Object(h.b)(s.x-u,l.y))}else c.push(Object(h.b)(s.x,s.y),Object(h.b)(l.x,s.y),Object(h.b)(l.x,l.y),Object(h.b)(s.x,l.y));return O([Object(r.g)(c.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function M(e,t,a,i){var n=t.mapToLocalMultiple(e),d=null,p=null;if(a)d=n[0],p=n[1];else{var f=n[0],b=n[1],v=Math.round(b.x-f.x),y=Math.round(b.y-f.y),m=Math.max(Math.abs(v),Math.abs(y));d=Object(h.b)(v>0?f.x+m/2:f.x-m/2,y>0?f.y+m/2:f.y-m/2),p=Object(h.b)(Math.abs(v)>Math.abs(y)?d.x-m/2:d.x,Math.abs(v)>Math.abs(y)?d.y:d.y-m/2)}var j=t.localToMap(d),_=t.localToMap(p);if(Object(r.j)(j)||Object(r.j)(_))return null;t.doUnnormalization&&Object(l.j)([[j,_]],t.spatialReference);var M=g(j,t.spatialReference),w=g(_,t.spatialReference),k=Object(o.d)(t.spatialReference),S=0;if(Object(u.j)(t.spatialReference))S=k*Object(s.distance)(M,w,null);else{var x=d.x-p.x,E=d.y-p.y;S=k*Math.sqrt(x*x+E*E)*(i||1)}var D=new c.a({center:M,radius:S,radiusUnit:"meters",spatialReference:t.spatialReference});return O(D.rings,D.spatialReference,!1)}function w(e,t,a){for(var i=t.mapToLocalMultiple(e),n=i[0],o=i[1],c=Math.round(o.x-n.x),s=Math.round(o.y-n.y),l=Object(h.b)(a?n.x:n.x+c/2,a?n.y:n.y+s/2),u=a?c:c/2,d=a?s:s/2,p=[],f=2*Math.PI/60,b=0;b<60;b++){var v=Math.cos(b*f),g=Math.sin(b*f),y=Object(h.b)(u*v+l.x,d*g+l.y);p.push(y)}return p.push(p[0]),O([Object(r.g)(p.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!1)}}}]);
//# sourceMappingURL=9.619fe4ac.chunk.js.map