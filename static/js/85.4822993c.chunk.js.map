{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl.js","../node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl.js","../node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl.js","../node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl.js","../node_modules/@arcgis/core/views/3d/webgl-engine/lib/verticalOffsetUtils.js"],"names":["t","fragment","include","a","uniforms","add","code","e","o","shadowMappingEnabled","shadowMap","bind","bindView","origin","i","l","r","output","receiveShadows","varyings","vertex","n","pbrMode","useCustomDTRExponentForWater","z","this","_transform","h","_transformInverse","g","value","_transformInverseTranspose","_transformTranspose","_transformInverseRotation","s","invalidate","invalidateLazyTransforms","setTransformMatrix","multiplyTransform","original","update","dirty","transform","S","offset","tmpVertex","p","localOrigin","Math","sqrt","T","componentLocalOriginLength","mbs","u","obb","center","halfSize","b","quaternion","m","c","j","x","sphere","v","objectTransform","inverse","_","O","f"],"mappings":"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","file":"static/js/85.4822993c.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{RgbaFloatEncoding as a}from\"../util/RgbaFloatEncoding.glsl.js\";import{glsl as e}from\"../../shaderModules/interfaces.js\";function t(t){t.fragment.include(a),t.fragment.uniforms.add(\"uShadowMapTex\",\"sampler2D\"),t.fragment.uniforms.add(\"uShadowMapNum\",\"int\"),t.fragment.uniforms.add(\"uShadowMapDistance\",\"vec4\"),t.fragment.uniforms.add(\"uShadowMapMatrix\",\"mat4\",4),t.fragment.uniforms.add(\"uDepthHalfPixelSz\",\"float\"),t.fragment.code.add(e`int chooseCascade(float _linearDepth, out mat4 mat) {\nvec4 distance = uShadowMapDistance;\nfloat depth = _linearDepth;\nint i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\nmat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];\nreturn i;\n}\nvec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\nvec4 lv = mat * vec4(_vpos, 1.0);\nlv.xy /= lv.w;\nreturn 0.5 * lv.xyz + vec3(0.5);\n}\nvec2 cascadeCoordinates(int i, vec3 lvpos) {\nreturn vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n}\nfloat readShadowMapDepth(vec2 uv, sampler2D _depthTex) {\nreturn rgba2float(texture2D(_depthTex, uv));\n}\nfloat posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {\nreturn readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;\n}\nfloat filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {\nfloat texSize = 0.5 / halfPixelSize;\nvec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\nfloat s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);\nfloat s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);\nreturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}\nfloat readShadowMap(const in vec3 _vpos, float _linearDepth) {\nmat4 mat;\nint i = chooseCascade(_linearDepth, mat);\nif (i >= uShadowMapNum) { return 0.0; }\nvec3 lvpos = lightSpacePosition(_vpos, mat);\nif (lvpos.z >= 1.0) { return 0.0; }\nif (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\nvec2 uv = cascadeCoordinates(i, lvpos);\nreturn filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);\n}`)}function o(a,e){e.shadowMappingEnabled&&(e.shadowMap.bind(a),e.shadowMap.bindView(a,e.origin))}function i(a,e,t){e.shadowMappingEnabled&&e.shadowMap.bindView(a,t)}function l(a,e){e.shadowMappingEnabled&&e.shadowMap.bindView(a,e.origin)}export{t as ReadShadowMap,o as bindReadShadowMapUniforms,l as bindReadShadowMapView,i as bindReadShadowMapViewCustomOrigin};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{glsl as e}from\"../shaderModules/interfaces.js\";function a(a,r){0===r.output&&r.receiveShadows?(a.varyings.add(\"linearDepth\",\"float\"),a.vertex.code.add(e`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):1===r.output||3===r.output?(a.varyings.add(\"linearDepth\",\"float\"),a.vertex.uniforms.add(\"cameraNearFar\",\"vec2\"),a.vertex.code.add(e`void forwardLinearDepth() {\nlinearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);\n}`)):a.vertex.code.add(e`void forwardLinearDepth() {}`)}export{a as ForwardLinearDepth};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{glsl as e}from\"../../shaderModules/interfaces.js\";function t(t){const a=t.fragment.code;a.add(e`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n{\nreturn ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n}`),a.add(e`float integratedRadiance(float cosTheta2, float roughness)\n{\nreturn (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n}`),a.add(e`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n{\nfloat cosTheta2 = 1.0 - RdotNG * RdotNG;\nfloat intRadTheta = integratedRadiance(cosTheta2, roughness);\nfloat ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\nfloat sky = 2.0 - ground;\nreturn (ground * ambientGround + sky * ambientSky) * 0.5;\n}`)}export{t as AnalyticalSkyModel};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{AnalyticalSkyModel as e}from\"./AnalyticalSkyModel.glsl.js\";import{PiUtils as o}from\"./PiUtils.glsl.js\";import{glsl as t}from\"../../shaderModules/interfaces.js\";function a(a,n){const r=a.fragment.code;a.include(o),3===n.pbrMode||4===n.pbrMode?(r.add(t`\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ${n.useCustomDTRExponentForWater?\"2.2\":\"2.0\"};\n    `),r.add(t`vec3 fresnelReflection(float angle, vec3 f0, float f90) {\nreturn f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n}`),r.add(t`float normalDistributionWater(float NdotH, float roughness)\n{\nfloat r2 = roughness * roughness;\nfloat NdotH2 = NdotH * NdotH;\nfloat denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\nreturn r2 / denom;\n}`),r.add(t`float geometricOcclusionKelemen(float LoH)\n{\nreturn 0.25 / (LoH * LoH);\n}`),r.add(t`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n{\nvec3  F = fresnelReflection(props.VdotH, F0, F0Max);\nfloat dSun = normalDistributionWater(props.NdotH, roughness);\nfloat V = geometricOcclusionKelemen(props.LdotH);\nfloat diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\nfloat strengthSunHaze  = 1.2;\nfloat dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\nreturn ((dSun + dSunHaze) * V) * F;\n}\nvec3 tonemapACES(const vec3 x) {\nreturn (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n}`)):1!==n.pbrMode&&2!==n.pbrMode||(a.include(e),r.add(t`struct PBRShadingInfo\n{\nfloat NdotL;\nfloat NdotV;\nfloat NdotH;\nfloat VdotH;\nfloat LdotH;\nfloat NdotNG;\nfloat RdotNG;\nfloat NdotAmbDir;\nfloat NdotH_Horizon;\nvec3 skyRadianceToSurface;\nvec3 groundRadianceToSurface;\nvec3 skyIrradianceToSurface;\nvec3 groundIrradianceToSurface;\nfloat averageAmbientRadiance;\nfloat ssao;\nvec3 albedoLinear;\nvec3 f0;\nvec3 f90;\nvec3 diffuseColor;\nfloat metalness;\nfloat roughness;\n};`),r.add(t`float normalDistribution(float NdotH, float roughness)\n{\nfloat a = NdotH * roughness;\nfloat b = roughness / (1.0 - NdotH * NdotH + a * a);\nreturn b * b * INV_PI;\n}`),r.add(t`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\nconst vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\nconst vec2 c2 = vec2(-1.04, 1.04);\nvec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\nreturn c2 * a004 + r.zw;\n}`),r.add(t`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\nvec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\nvec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\nvec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\nvec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\nvec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\nvec3 specularComponent = specularColor * indirectSpecular;\nreturn (diffuseComponent + specularComponent);\n}`),r.add(t`float gamutMapChanel(float x, vec2 p){\nreturn (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n}`),r.add(t`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\nvec3 outColor;\nvec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\noutColor.x = gamutMapChanel(inColor.x, p) ;\noutColor.y = gamutMapChanel(inColor.y, p) ;\noutColor.z = gamutMapChanel(inColor.z, p) ;\nreturn outColor;\n}`))}export{a as PhysicallyBasedRendering};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../../core/maybe.js\";import{n as s}from\"../../../../chunks/mat3.js\";import{c as i}from\"../../../../chunks/mat3f64.js\";import{a as r,e,d as o,m as n}from\"../../../../chunks/mat4.js\";import{c as h}from\"../../../../chunks/mat4f64.js\";import{c as a}from\"../../../../chunks/quat.js\";import{a as f}from\"../../../../chunks/quatf64.js\";import{q as l,b as m,f as c}from\"../../../../chunks/vec3.js\";import{c as b}from\"../../../../chunks/vec3f32.js\";import{c as p}from\"../../../../chunks/vec3f64.js\";import{c as u}from\"../../../../chunks/vec4f64.js\";import{c as v}from\"../../../../chunks/sphere.js\";class z{constructor(){this._transform=h(),this._transformInverse=new g({value:this._transform},r,h),this._transformInverseTranspose=new g(this._transformInverse,e,h),this._transformTranspose=new g({value:this._transform},e,h),this._transformInverseRotation=new g({value:this._transform},s,i)}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){o(this._transform,t)}multiplyTransform(t){n(this._transform,this._transform,t)}set(t){o(this._transform,t),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,s){this.setTransformMatrix(t),this.multiplyTransform(s),this.invalidateLazyTransforms()}}class g{constructor(t,s,i){this.original=t,this.update=s,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class S{constructor(t=0){this.offset=t,this.tmpVertex=p()}applyToVertex(t,s,i){const r=t+this.localOrigin[0],e=s+this.localOrigin[1],o=i+this.localOrigin[2],n=this.offset/Math.sqrt(r*r+e*e+o*o);return this.tmpVertex[0]=t+r*n,this.tmpVertex[1]=s+e*n,this.tmpVertex[2]=i+o*n,this.tmpVertex}applyToAabb(t){const s=t[0]+this.localOrigin[0],i=t[1]+this.localOrigin[1],r=t[2]+this.localOrigin[2],e=t[3]+this.localOrigin[0],o=t[4]+this.localOrigin[1],n=t[5]+this.localOrigin[2],h=this.offset/Math.sqrt(s*s+i*i+r*r);t[0]+=s*h,t[1]+=i*h,t[2]+=r*h;const a=this.offset/Math.sqrt(e*e+o*o+n*n);return t[3]+=e*a,t[4]+=o*a,t[5]+=n*a,t}}class T{constructor(t=0){this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=p(),this.mbs=u(),this.obb={center:p(),halfSize:b(),quaternion:null}}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,s,i){const r=t,e=s,o=i+this.componentLocalOriginLength,n=this.offset/Math.sqrt(r*r+e*e+o*o);return this.tmpVertex[0]=t+r*n,this.tmpVertex[1]=s+e*n,this.tmpVertex[2]=i+o*n,this.tmpVertex}applyToAabb(t){const s=t[0],i=t[1],r=t[2]+this.componentLocalOriginLength,e=t[3],o=t[4],n=t[5]+this.componentLocalOriginLength,h=this.offset/Math.sqrt(s*s+i*i+r*r);t[0]+=s*h,t[1]+=i*h,t[2]+=r*h;const a=this.offset/Math.sqrt(e*e+o*o+n*n);return t[3]+=e*a,t[4]+=o*a,t[5]+=n*a,t}applyToMbs(t){const s=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/s;return this.mbs[0]=t[0]+t[0]*i,this.mbs[1]=t[1]+t[1]*i,this.mbs[2]=t[2]+t[2]*i,this.mbs[3]=t[3]+t[3]*this.offset/s,this.mbs}applyToObb(t){const s=t.center,i=this.offset/Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);this.obb.center[0]=s[0]+s[0]*i,this.obb.center[1]=s[1]+s[1]*i,this.obb.center[2]=s[2]+s[2]*i,l(this.obb.halfSize,t.halfSize,t.quaternion),m(this.obb.halfSize,this.obb.halfSize,t.center);const r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,c(this.obb.halfSize,this.obb.halfSize,t.center),a(j,t.quaternion),l(this.obb.halfSize,this.obb.halfSize,j),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=t.quaternion,this.obb}}class q{constructor(t=0){this.offset=t,this.sphere=v(),this.tmpVertex=p()}applyToVertex(t,s,i){const r=this.objectTransform.transform;let e=r[0]*t+r[4]*s+r[8]*i+r[12],o=r[1]*t+r[5]*s+r[9]*i+r[13],n=r[2]*t+r[6]*s+r[10]*i+r[14];const h=this.offset/Math.sqrt(e*e+o*o+n*n);e+=e*h,o+=o*h,n+=n*h;const a=this.objectTransform.inverse;return this.tmpVertex[0]=a[0]*e+a[4]*o+a[8]*n+a[12],this.tmpVertex[1]=a[1]*e+a[5]*o+a[9]*n+a[13],this.tmpVertex[2]=a[2]*e+a[6]*o+a[10]*n+a[14],this.tmpVertex}applyToMinMax(t,s){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);s[0]+=s[0]*r,s[1]+=s[1]*r,s[2]+=s[2]*r}applyToAabb(t){const s=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*s,t[1]+=t[1]*s,t[2]+=t[2]*s;const i=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*i,t[4]+=t[4]*i,t[5]+=t[5]*i,t}applyToBoundingSphere(t){const s=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/s;return this.sphere[0]=t[0]+t[0]*i,this.sphere[1]=t[1]+t[1]*i,this.sphere[2]=t[2]+t[2]*i,this.sphere[3]=t[3]+t[3]*this.offset/s,this.sphere}}const x=new q;function _(s){return t(s)?(x.offset=s,x):null}const y=new T;function M(s){return t(s)?(y.offset=s,y):null}const d=new S;function V(s){return t(s)?(d.offset=s,d):null}const O=\"terrain\",j=f();export{T as I3SVerticalOffsetGlobalViewingMode,z as IntersectorTransform,q as Object3DVerticalOffsetGlobalViewingMode,O as TERRAIN_ID,S as TerrainVerticalOffsetGlobalViewingMode,M as getVerticalOffsetI3S,_ as getVerticalOffsetObject3D,V as getVerticalOffsetTerrain};\n"],"sourceRoot":""}