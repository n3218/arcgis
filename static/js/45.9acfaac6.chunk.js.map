{"version":3,"sources":["../node_modules/@arcgis/core/layers/MapImageLayer.js"],"names":["U","e","alwaysRefetch","dpi","gdbVersion","imageFormat","imageMaxHeight","imageMaxWidth","imageTransparency","isReference","labelsVisible","operationalLayerType","sourceJSON","sublayers","type","url","r","a","signal","this","addResolvingPromise","loadFromPortal","supportedTypes","catch","n","then","_fetchService","Promise","resolve","t","supportedImageFormatTypes","indexOf","i","loaded","o","slice","reverse","flatten","toArray","s","capabilities","operations","supportsExportMap","exportMap","supportsDynamicLayers","h","origin","createSublayersForOrigin","T","p","writeSublayerStructure","forEach","write","push","originOf","some","Object","keys","length","layers","visibleLayers","filter","visible","map","id","pixelRatio","version","clone","shiftCentralMeridian","R","layer","scale","g","extent","width","toJSON","destroy","rotation","spatialReference","l","wkid","JSON","stringify","m","timeExtent","start","end","time","timeInfo","hasLiveData","bbox","xmin","ymin","xmax","ymax","bboxSR","imageSR","size","responseType","query","parsedUrl","createExportImageParameters","f","_ts","Date","now","timestamp","customParameters","token","apiKey","path","dynamicLayers","reject","data","error","returnUpdates","fullExtent","fromJSON","allSublayers","read","ssl","replace","S","P","M","I","E","b","j","O","L","x","w","v","prototype","u","json","origins","service","source","Boolean","enabled","overridePolicy","ignoreOrigin","d","J","c","readOnly","value","N","q","y"],"mappings":"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","file":"static/js/45.9acfaac6.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../request.js\";import t from\"../TimeExtent.js\";import i from\"../core/Error.js\";import{HandleOwnerMixin as o}from\"../core/HandleOwner.js\";import{loadAll as s}from\"../core/loadAll.js\";import{isSome as a}from\"../core/maybe.js\";import{MultiOriginJSONMixin as p}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as n,isAbortError as l}from\"../core/promiseUtils.js\";import{property as m}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import{Integer as c}from\"../core/accessorSupport/ensureType.js\";import\"../core/Logger.js\";import{reader as u}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as y}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"../core/accessorSupport/decorators/writer.js\";import{nameToId as h}from\"../core/accessorSupport/PropertyOrigin.js\";import f from\"../geometry/Extent.js\";import{getScale as g}from\"../geometry/support/scaleUtils.js\";import v from\"./Layer.js\";import{APIKeyMixin as x}from\"./mixins/APIKeyMixin.js\";import{ArcGISMapService as b}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as j}from\"./mixins/ArcGISService.js\";import{BlendLayer as S}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as w}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as O}from\"./mixins/OperationalLayer.js\";import{PortalLayer as L}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as I}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as M}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as E}from\"./mixins/SublayersOwner.js\";import{TemporalLayer as P}from\"./mixins/TemporalLayer.js\";import{url as N}from\"./support/commonProperties.js\";import{ExportImageParameters as R}from\"./support/ExportImageParameters.js\";import J from\"./support/Sublayer.js\";import{shouldWriteSublayerStructure as T}from\"./support/sublayerUtils.js\";let U=class extends(S(P(M(I(E(b(j(O(L(p(x(w(o(v)))))))))))))){constructor(...e){super(...e),this.alwaysRefetch=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat=\"png24\",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType=\"ArcGISMapServiceLayer\",this.sourceJSON=null,this.sublayers=null,this.type=\"map-image\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=a(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(n).then((()=>this._fetchService(r)))),Promise.resolve(this)}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.indexOf(\"PNG32\")>-1?\"png32\":\"png24\"}writeSublayers(e,r,t,i){if(!this.loaded||!e)return;const o=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let s=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=h(i.origin);if(3===e){const e=this.createSublayersForOrigin(\"service\").sublayers;s=T(o,e,2)}else if(e>3){const e=this.createSublayersForOrigin(\"portal-item\");s=T(o,e.sublayers,h(e.origin))}}const a=[],p={writeSublayerStructure:s,...i};let n=s;o.forEach((e=>{const r=e.write({},p);a.push(r),n=n||\"user\"===e.originOf(\"visible\")}));a.some((e=>Object.keys(e).length>1))&&(r.layers=a),n&&(r.visibleLayers=o.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,r,t,i){const o=i&&i.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const s=new R({layer:this,scale:g({extent:e,width:r})*o}),a=s.toJSON();s.destroy();const p=!i||!i.rotation||this.version<10.3?{}:{rotation:-i.rotation},n=e&&e.spatialReference,l=n.wkid||JSON.stringify(n.toJSON());a.dpi*=o;const m={};if(null!=i&&i.timeExtent){const{start:e,end:r}=i.timeExtent.toJSON();m.time=e&&r&&e===r?\"\"+e:`${null==e?\"null\":e},${null==r?\"null\":r}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(m.time=\"null,null\");return{bbox:e&&e.xmin+\",\"+e.ymin+\",\"+e.xmax+\",\"+e.ymax,bboxSR:l,imageSR:l,size:r+\",\"+t,...a,...p,...m}}async fetchImage(e,t,o,s){var a,p;const n={responseType:\"image\",signal:null!=(a=null==s?void 0:s.signal)?a:null,query:{...this.parsedUrl.query,...this.createExportImageParameters(e,t,o,s),f:\"image\",_ts:this.alwaysRefetch?Date.now():null!=(p=null==s?void 0:s.timestamp)?p:null,...this.customParameters,token:this.apiKey}},m=this.parsedUrl.path+\"/export\";if(null!=n.query.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return Promise.reject(new i(\"mapimagelayer:dynamiclayer-not-supported\",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:n.query}));return r(m,n).then((e=>e.data)).catch((e=>{if(l(e))throw e;throw new i(\"mapimagelayer:image-fetch-error\",`Unable to load image: ${m}`,{error:e})}))}async fetchRecomputedExtents(e={}){const i={...e,query:{returnUpdates:!0,f:\"json\"}},{data:o}=await r(this.url,i),{extent:s,fullExtent:a,timeExtent:p}=o,n=s||a;return{fullExtent:n&&f.fromJSON(n),timeExtent:p&&t.fromJSON({start:p[0],end:p[1]})}}loadAll(){return s(this,(e=>{e(this.allSublayers)}))}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:\"service\",url:this.parsedUrl});const{data:t,ssl:i}=await r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});i&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=t,this.read(t,{origin:\"service\",url:this.parsedUrl})}};e([m()],U.prototype,\"alwaysRefetch\",void 0),e([m()],U.prototype,\"dpi\",void 0),e([m()],U.prototype,\"gdbVersion\",void 0),e([m()],U.prototype,\"imageFormat\",void 0),e([u(\"imageFormat\",[\"supportedImageFormatTypes\"])],U.prototype,\"readImageFormat\",null),e([m({json:{origins:{service:{read:{source:\"maxImageHeight\"}}}}})],U.prototype,\"imageMaxHeight\",void 0),e([m({json:{origins:{service:{read:{source:\"maxImageWidth\"}}}}})],U.prototype,\"imageMaxWidth\",void 0),e([m()],U.prototype,\"imageTransparency\",void 0),e([m({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],U.prototype,\"isReference\",void 0),e([m({json:{read:!1,write:!1}})],U.prototype,\"labelsVisible\",void 0),e([m({type:[\"ArcGISMapServiceLayer\"]})],U.prototype,\"operationalLayerType\",void 0),e([m({json:{read:!1,write:!1}})],U.prototype,\"popupEnabled\",void 0),e([m()],U.prototype,\"sourceJSON\",void 0),e([m({json:{write:{ignoreOrigin:!0}}})],U.prototype,\"sublayers\",void 0),e([d(\"sublayers\",{layers:{type:[J]},visibleLayers:{type:[c]}})],U.prototype,\"writeSublayers\",null),e([m({type:[\"show\",\"hide\",\"hide-children\"]})],U.prototype,\"listMode\",void 0),e([m({json:{read:!1},readOnly:!0,value:\"map-image\"})],U.prototype,\"type\",void 0),e([m(N)],U.prototype,\"url\",void 0),U=e([y(\"esri.layers.MapImageLayer\")],U);var q=U;export default q;\n"],"sourceRoot":""}